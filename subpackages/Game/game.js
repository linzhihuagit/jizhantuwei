
	var global = (function () { return this })();	if (!global && typeof GameGlobal !== 'undefined') global = GameGlobal;	var pluginInfoMap = {};	;	global.requirePlugin = global.requirePlugin || function(path) {		    var position = path.indexOf('/');    		var alias = '';    		var pagePath = '';    		if (position !== -1) {    		    alias = path.substr(0, position);    		    pagePath = path.substr(position + 1, path.length);    		}    		else {    		    alias = path;    		}    		if (pluginInfoMap.hasOwnProperty(alias)) {    		    var realPath = '';    		    if (pagePath.length === 0) {    		        realPath =  '__plugin__/' + pluginInfoMap[alias].appid;    		        return require(realPath);    		    } else {    		        realPath = '__plugin__/' + pluginInfoMap[alias].appid + '/' + pagePath;    		        return require(realPath);    		    }    		}    		else {    		    console.error('not found alias: ', alias);    		    throw new Error('Plugin ' + alias + ' is not defined.')    		}	};	define("subpackages/Game/game.js", function(require, module, exports){ 			
"use strict";var t,e;System.register("chunks:///_virtual/BasicBullet.ts",["cc","./GlobalConfig.ts","./GlobalEnum.ts","./EventManager.ts","./EventTypes.ts","./BasicCollider.ts","./CollisionManager.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.v3},function(t){n=t.WeaponCfg},function(t){r=t.GlobalEnum},function(t){o=t.default},function(t){a=t.EventTypes},function(t){h=t.BasicCollider},function(t){l=t.ColliderGroup,c=t.CollisionManager}],execute:function(){var u;e._RF.push({},"1a23a9IqeRJvpGECZ94iCrn","BasicBullet",void 0);var p=i.ccclass;i.property,t("BasicBullet",p("BasicBullet")(u=function(){function t(t,e,i){this._index=0,this.weaponType=0,this.isFinish=!0,this.lineSpd=s(),this.rotSpd=s(),this.scaleSpd=0,this.opacitySpd=0,this.pos=s(),this.rot=s(),this.scale=0,this.opacity=0,this.activeNum=0,this.curt=0,this.animTime=0,this.initRot=s(),this.atkRate=1,this.tmpP=s(),this.tmpR=s(),this.collider=null,this._index=t,this.initRot.set(i),this.weaponType=e,this.rot.set(0,-this.initRot.y,0)}var e=t.prototype;return e.setActive=function(t,e,i,s,n,r,o,a){this.atkRate=s,this.isFinish=!1,this.activeNum=1,this.pos.set(t);var h=57.3*Math.atan2(-e.z,e.x)+this.initRot.y+180;this.rot.set(0,h,0),this.animTime=n,this.scale=o,this.opacity=1,this.lineSpd.set(e),this.rotSpd.set(i),this.setCollider(r,a)},e.init=function(){},e.reset=function(){this.isFinish=!0,this.activeNum=0,this.curt=0,this.resetCollider()},e.update=function(t){this.move(t),this.updateCollider(t)},e.lateUpdate=function(t){this.lateUpdateCollider(t)},e.move=function(t){this.tmpP.set(this.lineSpd).multiplyScalar(t),this.pos.add(this.tmpP),this.curt+=t,this.curt>=this.animTime&&(this.isFinish=!0,this.reset())},e.setCollider=function(t,e){this.collider=new h(l.PlayerBullet,this,!0),this.collider.setRectSize(t),this.collider.setRectPos(this.pos),this.collider.updateGridInfo(!0),this.collider.isCircleCollider=e},e.resetCollider=function(){this.collider&&(this.collider.clearGridInfo(),this.collider.removeFromManager(),this.collider=null)},e.updateCollider=function(t){this.checkEnemys()},e.lateUpdateCollider=function(t){this.collider&&this.collider.lateUpdate(t)},e.checkEnemys=function(){!this.isFinish&&this.collider.checkPosFast(this.pos,this.onCheckColliderCb.bind(this))},e.onCheckColliderCb=function(t,e){if(!this.isFinish){var i=c.allColliderRecs[e];if(i&&t==l.Enemy){var s=i.targetCmp,h=n[this.weaponType].atk*this.atkRate;switch(s.byHit(h),this.weaponType){case r.WeaponType.FireGun:o.emit(a.EffectEvents.show3DTo2DEffect,{t:r.Effect3dType.Effect_jz_fireball_boom,p:this.pos});for(var u=Math.floor(3*Math.random())+1,p=0;p<u;p++)this.tmpP.set(this.pos),this.tmpP.y+=.5,this.tmpP.x+=2*(2*Math.random()-1),this.tmpP.z+=2*(2*Math.random()-1)+2,o.emit(a.EffectEvents.showObjs,r.Effect3dType.fireEffect,{p:this.tmpP})}return this.isFinish=!0,void this.reset()}}},t}())||u),e._RF.pop()}}})),System.register("chunks:///_virtual/BasicCollider.ts",["cc","./CollisionManager.ts"],(function(t){var e,i,s,n,r,o,a;return{setters:[function(t){e=t.cclegacy,i=t.v3,s=t.v2,n=t.Rect},function(t){r=t.CollisionManager,o=t.CollisionTools,a=t.ColliderGroup}],execute:function(){e._RF.push({},"7ad91qaPxVPO5LgJ1DoaZgz","BasicCollider",void 0),i();var h=s();t("BasicCollider",function(){function t(t,e,s){void 0===s&&(s=!1),this.SelfId=0,this.GroupId=a.None,this.isTrigger=!1,this.prePosInfo=[],this.curRectPosArr=[],this.selfRect=new n(0,0,1,1),this.isDirty=!1,this.mapRange={maxX:0,minX:0,maxY:0,minY:0,maxZ:0,minZ:0,x:0,y:0,z:0},this.targetCmp=null,this.isCircleCollider=!1,this.tmpP2=i(),this.stepP=i(),this._tmpP0=i(),this._isColX=!1,this._isColZ=!1,this._isColl=!1,this._outRes=void 0,this.GroupId=t,this.targetCmp=e,this.isTrigger=s,this.init()}var e=t.prototype;return e.setRectPos=function(t){t.x==this.selfRect.center.x&&t.z==this.selfRect.center.y||(this.selfRect.center=h.set(t.x,t.z),this.updatePosRecFromRect(this.selfRect,this.curRectPosArr),this.isDirty=!0)},e.setSinglePoint=function(t){t.x==this.selfRect.center.x&&t.z==this.selfRect.center.y||(this.selfRect.center=h.set(t.x,t.z),this.updatePosRecFromPos(t),this.isDirty=!0)},e.setRectSize=function(t){t.width==this.selfRect.width&&t.height==this.selfRect.height||(this.selfRect.set(this.selfRect.x,this.selfRect.y,t.width,t.height),this.curRectPosArr=[],this.updatePosRecFromRect(this.selfRect,this.curRectPosArr),this.isDirty=!0)},e.clearGridInfo=function(){for(var t=0;t<this.prePosInfo.length;t++)r.clearInfo(this.prePosInfo[t].p,this.GroupId,this.SelfId,this.prePosInfo[t].index)},e.removeFromManager=function(){r.removeColliderByColId(this.SelfId)},e.init=function(){this.SelfId=t._COLLODERINDEX++,r.setColilderByColId(this.SelfId,this);var e=r.mapWpos,i=r.mapSize;this.mapRange={maxX:i.x+e.x,minX:e.x,maxY:i.y+e.y,minY:e.y,maxZ:i.z+e.z,minZ:e.z,x:e.x,y:e.y,z:e.z}},e.updateGridInfo=function(t){if(void 0===t&&(t=!1),this.isDirty||t){this.clearGridInfo();for(var e=0;e<this.curRectPosArr.length;e++)this.prePosInfo[e]||(this.prePosInfo[e]={p:i(),index:-1}),this.prePosInfo[e].index=r.setInfo(this.curRectPosArr[e],this.GroupId,this.SelfId,this.prePosInfo[e].p);this.isDirty=!1}},e.lateUpdate=function(t){this.updateGridInfo()},e.updatePosRecFromRect=function(t,e){for(var s=r.gridSize,n=Math.ceil(t.width/s.x),o=Math.ceil(t.height/s.z),a=0,h=0;h<=n;h++)for(var l=0;l<=o;l++)e[a]||(e[a]=i()),e[a].set(h*s.x,0,l*s.z),e[a].add3f(t.x,0,t.y),a++},e.updatePosRecFromPos=function(t){this.curRectPosArr[0]||(this.curRectPosArr[0]=i()),this.curRectPosArr[0].x=Math.ceil(t.x),this.curRectPosArr[0].y=0,this.curRectPosArr[0].z=Math.ceil(t.z)},e.checkMoveCollision=function(t,e,i){return this._isColl=!1,i.set(t),0!=e.x||0!=e.z?(0!=e.x&&(this._tmpP0.set(t.x+e.x,t.y,t.z),this._isColX=this.checkPosFast(this._tmpP0),i.x=this._isColX?t.x:this._tmpP0.x),0!=e.z&&(this._tmpP0.set(t.x,t.y,t.z+e.z),this._isColZ=this.checkPosFast(this._tmpP0),i.z=this._isColZ?t.z:this._tmpP0.z),this._isColl=this._isColX&&this._isColZ):(this._tmpP0.set(t),this._isColl=this.checkPosFast(this._tmpP0)),this._isColl},e.checkPosFast=function(t,e){for(var i in this._outRes)this._outRes[i]=null;if(this._outRes={},this.setRectPos(t),this.updateGridInfo(),o.impreciseCheckByRect(this.GroupId,this.SelfId,this.curRectPosArr,this._outRes,!0))for(var s in this._outRes)for(var n=this._outRes[s],r=0;r<n.length;r++){var a=n[r];if(o.checkRectByColId(this.selfRect,a,null,this.isCircleCollider,!0))return e&&e(+s,a),!0}return!1},e.checkPosCollistion=function(t,e){for(var i in this._outRes)this._outRes[i]=null;this._outRes={};var s=this._checkPosCollison(this._tmpP0.set(t),this._outRes);return s&&e&&e(this._outRes),s},e._checkPosCollison=function(t,e){this.setRectPos(t),this.updateGridInfo();var i=0;if(o.impreciseCheckByRect(this.GroupId,this.SelfId,this.curRectPosArr,e,!0))for(var s in e){for(var n=e[s],r=n.length-1;r>=0;r--){var a=n[r];o.checkRectByColId(this.selfRect,a,null,this.isCircleCollider,!0)||n.splice(r,1)}0==n.length?delete e[s]:i++}return i>0},e.checkPosByGroup=function(t,e,i){for(var s in this._outRes)this._outRes[s]=null;this._outRes={},this.setRectPos(t),this.updateGridInfo();var n=0;if(o.impreciseCheckByGroup(t,this._outRes,e))for(var r in this._outRes){for(var a=this._outRes[r],h=a.length-1;h>=0;h--){var l=a[h];o.checkRectByColId(this.selfRect,l,null,this.isCircleCollider,!0)||a.splice(h,1)}0==a.length?delete this._outRes[r]:n++}return this._isColl=n>0,this._isColl&&i&&i(this._outRes),this._isColl},t}())._COLLODERINDEX=1,e._RF.pop()}}})),System.register("chunks:///_virtual/BasicEffect.ts",["cc","./Tools.ts"],(function(t){var e,i,s;return{setters:[function(t){e=t.cclegacy,i=t._decorator},function(t){s=t.default}],execute:function(){var n;e._RF.push({},"06be1zze3ZHAawiRBswSJOj","BasicEffect",void 0);var r=i.ccclass;i.property,t("BasicEffect",r("BasicEffect")(n=function(){function t(t){this.node=null,this.isFinish=!1,this.node=t}var e=t.prototype;return e.init=function(){},e.update=function(t){},e.reset=function(){},e.clearObj=function(){s.clearObj(this)},t}())||n),e._RF.pop()}}})),System.register("chunks:///_virtual/BasicLayer.ts",["cc","./EventManager.ts"],(function(t){var e,i,s;return{setters:[function(t){e=t.cclegacy,i=t._decorator},function(t){s=t.default}],execute:function(){var n;e._RF.push({},"6851dlWug1DZIzKdVAQ4LgQ","BasicLayer",void 0);var r=i.ccclass;i.property,t("BasicLayer",r("BasicLayer")(n=function(){function t(t){this.node=null,this.events={},this.onceEvents={},this.node=t}var e=t.prototype;return e.initLayer=function(){this.init(),this.onEvents()},e.init=function(){},e.onEvents=function(){},e.setData=function(t){},e.reset=function(){},e.customUpdate=function(t){},e.customLateUpdate=function(t){},e.on=function(t,e,i){var n=s.on(t,e,i);n&&(this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(n))},e.once=function(t,e,i){var n=s.once(t,e,i);n&&(this.onceEvents.hasOwnProperty(t)||(this.onceEvents[t]=[]),this.onceEvents[t].push(n))},e.emit=function(t,e,i){void 0===e?s.emit(t):void 0===i?s.emit(t,e):s.emit(t,e,i),this.onceEvents.hasOwnProperty(t)&&delete this.onceEvents[t]},e.off=function(t,e,i){var n=this.events[t];if(n)for(var r=n.length-1;r>=0;--r)n[r].cb===e&&n[r].target===i&&(s.off(t,n[r]),n.splice(r,1));if(n=this.onceEvents[t])for(var o=n.length-1;o>=0;--o)n[o].cb===e&&n[o].target===i&&(s.off(t,n[o]),n.splice(o,1))},e.offEvents=function(){for(var t in this.events)s.offGroup(t,this.events[t]);for(var e in this.events={},this.onceEvents)s.offGroup(e,this.onceEvents[e]);this.onceEvents={}},t}())||n),e._RF.pop()}}})),System.register("chunks:///_virtual/BasicModifyMesh.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.MeshRenderer,h=t.Component}],execute:function(){var l,c,u,p,f,m;r._RF.push({},"b1660mQ0TBNtpwGCHPSffJ4","BasicModifyMesh",void 0);var d=o.ccclass,y=o.property;t("BasicModifyMesh",(l=d("BasicModifyMesh"),c=y(a),l((f=e((p=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"msr",f,n(e)),e.transData1=[0,0,0,0],e.transData2=[0,0,0,0],e.a_transData1="a_transData1",e.a_transData2="a_transData2",e._curColorNum=0,e._deathNum=1,s(e,"isUseColor",m,n(e)),e}i(e,t);var r=e.prototype;return r.onLoad=function(){delete this.msr.mesh.struct.maxPosition,delete this.msr.mesh.struct.minPosition,this.msr.shadowCastingMode=0},r.setData=function(){this._curColorNum=0,this._deathNum=1,this.transData2[0]=this._curColorNum,this.transData2[1]=this._deathNum},r.setTransData=function(t,e,i){this.transData1[0]=t.x,this.transData1[1]=i,this.transData1[2]=t.z,this.transData1[3]=e,this.msr.setInstancedAttribute(this.a_transData1,this.transData1)},r.byHit=function(){this._curColorNum=1},r.setDeath=function(){this._deathNum=.05},r.updateColor=function(t){this.isUseColor&&(this._curColorNum+=.2*(0-this._curColorNum)*t*60,this.transData2[0]=this._curColorNum,this.transData2[1]=this._deathNum,this.msr.setInstancedAttribute(this.a_transData2,this.transData2))},e}(h)).prototype,"msr",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(p.prototype,"isUseColor",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u=p))||u)),r._RF.pop()}}})),System.register("chunks:///_virtual/BasicModifyRotMesh.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.MeshRenderer,h=t.Component}],execute:function(){var l,c,u,p,f,m;r._RF.push({},"cab95XBnRRATLiBndUupULm","BasicModifyRotMesh",void 0);var d=o.ccclass,y=o.property;t("BasicModifyRotMesh",(l=d("BasicModifyRotMesh"),c=y(a),l((f=e((p=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"msr",f,n(e)),e.transData1=[0,0,0,0],e.transData2=[0,0,0,0],e.a_transData1="a_transData1",e.a_transData2="a_transData2",e._curColorNum=0,e._deathNum=1,s(e,"isUseColor",m,n(e)),e}i(e,t);var r=e.prototype;return r.onLoad=function(){delete this.msr.mesh.struct.maxPosition,delete this.msr.mesh.struct.minPosition,this.msr.shadowCastingMode=0},r.setData=function(){this._curColorNum=0,this._deathNum=1,this.transData2[0]=this._curColorNum,this.transData2[1]=this._deathNum},r.setTransData=function(t,e,i){this.transData1[0]=t.x,this.transData1[1]=i,this.transData1[2]=t.z,this.transData1[3]=e,this.msr.setInstancedAttribute(this.a_transData1,this.transData1)},r.byHit=function(){this._curColorNum=1},r.setDeath=function(){this._deathNum=.05},r.updateColor=function(t){this.isUseColor&&(this._curColorNum+=.2*(0-this._curColorNum)*t*60,this.transData2[0]=this._curColorNum,this.transData2[1]=this._deathNum,this.msr.setInstancedAttribute(this.a_transData2,this.transData2))},e}(h)).prototype,"msr",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(p.prototype,"isUseColor",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u=p))||u)),r._RF.pop()}}})),System.register("chunks:///_virtual/BasicMountLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventManager.ts"],(function(t){var e,i,s,n,r;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.Component},function(t){r=t.default}],execute:function(){var o;i._RF.push({},"2e32553YL5AybqPyrC8I2cj","BasicMountLayer",void 0);var a=s.ccclass;s.property,t("BasicMountLayer",a("BasicMountLayer")(o=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).events={},e.onceEvents={},e}e(i,t);var s=i.prototype;return s.initLayer=function(){this.init(),this.onEvents()},s.init=function(){},s.onEvents=function(){},s.setData=function(t){},s.reset=function(){},s.customUpdate=function(t){},s.customLateUpdate=function(t){},s.on=function(t,e,i){var s=r.on(t,e,i);s&&(this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(s))},s.once=function(t,e,i){var s=r.once(t,e,i);s&&(this.onceEvents.hasOwnProperty(t)||(this.onceEvents[t]=[]),this.onceEvents[t].push(s))},s.emit=function(t,e,i){void 0===e?r.emit(t):void 0===i?r.emit(t,e):r.emit(t,e,i),this.onceEvents.hasOwnProperty(t)&&delete this.onceEvents[t]},s.off=function(t,e,i){var s=this.events[t];if(s)for(var n=s.length-1;n>=0;--n)s[n].cb===e&&s[n].target===i&&(r.off(t,s[n]),s.splice(n,1));if(s=this.onceEvents[t])for(var o=s.length-1;o>=0;--o)s[o].cb===e&&s[o].target===i&&(r.off(t,s[o]),s.splice(o,1))},s.offEvents=function(){for(var t in this.events)r.offGroup(t,this.events[t]);for(var e in this.events={},this.onceEvents)r.offGroup(e,this.onceEvents[e]);this.onceEvents={}},i}(n))||o),i._RF.pop()}}})),System.register("chunks:///_virtual/BasicProp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicComponet.ts","./BasicCollider.ts","./CollisionManager.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.v3,h=t.size},function(t){l=t.BasicComponet},function(t){c=t.BasicCollider},function(t){u=t.ColliderGroup}],execute:function(){var p,f,m,d;r._RF.push({},"4927ak0T4lFlKiaunHCwm8Z","BasicProp",void 0);var y=o.ccclass,v=o.property;t("BasicProp",y("BasicProp")((m=e((f=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"cldSize",m,n(e)),s(e,"isCircleCollider",d,n(e)),e.collider=null,e.cldGroup=u.Trap,e.pos=a(),e}i(e,t);var r=e.prototype;return r.setData=function(t){this.node.setPosition(t.p),this.node.setRotation(t.r),this.node.parent=t.parent,this.setCollider()},r.reset=function(){this.resetCollider()},r.show=function(){},r.hide=function(){},r.customUpdate=function(t){this.updateCollider(t)},r.customLateUpdate=function(t){this.lateUpdateCollider(t)},r.setCollider=function(){this.pos.set(this.node.worldPosition),this.collider=new c(this.cldGroup,this,!0),this.collider.setRectSize(this.cldSize),this.collider.setRectPos(this.pos),this.collider.updateGridInfo(!0),this.collider.isCircleCollider=this.isCircleCollider},r.resetCollider=function(){this.collider&&(this.collider.clearGridInfo(),this.collider.removeFromManager(),this.collider=null)},r.updateCollider=function(t){this.checkCollistion()},r.checkCollistion=function(){this.collider&&this.collider.checkPosCollistion(this.pos,this.onCheckColliderCb.bind(this))},r.onCheckColliderCb=function(t){},r.lateUpdateCollider=function(t){this.collider&&this.collider.lateUpdate(t)},e}(l)).prototype,"cldSize",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h(1,1)}}),d=e(f.prototype,"isCircleCollider",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p=f))||p),r._RF.pop()}}})),System.register("chunks:///_virtual/BasicRec.ts",["cc"],(function(t){var e,i;return{setters:[function(t){e=t.cclegacy,i=t._decorator}],execute:function(){var s,n;e._RF.push({},"54ef2OvcFhG5rHA/zW9ucMx","BasicRec",void 0);var r=i.ccclass;i.property,t("BasicRec",r("BasicRec")(((n=function(){function t(){this._curId=0,this.node=null,this._curId=t.RECID++}var e=t.prototype;return e.init=function(){},e.update=function(t){},e.reset=function(){},t}()).RECID=0,s=n))||s),e._RF.pop()}}})),System.register("chunks:///_virtual/BasicRole.ts",["cc"],(function(t){var e,i,s;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.v3}],execute:function(){var n;e._RF.push({},"4d55eOFne5O6ITTyjiFslcy","BasicRole",void 0);var r=i.ccclass;i.property,t("BasicRole",r("BasicRole")(n=function(){function t(){this.curPos=s(),this.hp=0}var e=t.prototype;return e.onAtk=function(){},e.byHit=function(t){},t}())||n),e._RF.pop()}}})),System.register("chunks:///_virtual/BasicRole2.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"666edOVxyFA2a1ncKPkO/xd","BasicRole",void 0),t._RF.pop()}}})),System.register("chunks:///_virtual/BasicSkeleAnim.ts",["cc","./GlobalTmpData.ts","./ColorLog.ts"],(function(t){var e,i,s,n,r;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.SkeletalAnimation},function(t){n=t.GlobalTmpData},function(t){r=t.clog}],execute:function(){var o;e._RF.push({},"9f3314wJzdHr5FzC7tbfS1q","BasicSkeleAnim",void 0);var a=i.ccclass;i.property,t("BasicSkeleAnim",a("BasicSkeleAnim")(o=function(){function t(t){this.anim=null,this._curClip=null,this._allClips={},this._curAnimtimeScale=1,this._clipInitSpd=null,this._extralAnimSpd=1,this._crossTime=.2,this.anim=t.getComponent(s)}var e=t.prototype;return e.init=function(t){for(var e in this.anim.clips)this._allClips[this.anim.clips[e].name]=this.anim.clips[e];this.anim.stop(),this.setInitClipSpd(),this.onEvents()},e.onEvents=function(){},e.offEvents=function(){},e.reset=function(){this._curClip=null,this._curAnimtimeScale=1,this._extralAnimSpd=1,this.anim.stop(),this.resetClipSpd(),this.offEvents()},e.setInitClipSpd=function(){if(!this._clipInitSpd)for(var t in this.anim.clips){var e=this.anim.clips[t],i=this.anim.getState(e.name);i&&(this._clipInitSpd||(this._clipInitSpd={}),this._clipInitSpd[e.name]=i.speed||1)}},e.resetClipSpd=function(){if(this._clipInitSpd)for(var t in this.anim.clips){var e=this.anim.clips[t],i=this.anim.getState(e.name);e&&i&&this._clipInitSpd[e.name]&&(i.speed=this._clipInitSpd[e.name])}},e.playAnim=function(t,e,i,o,a){if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===o&&(o=1),i||t!=this._curClip)if(this.setInitClipSpd(),this._clipInitSpd&&this._clipInitSpd[t]){this._curClip=t,this._extralAnimSpd=o,this._curAnimtimeScale=n.timeScale*o;var h=this.anim.getState(t);if(h.speed=this._clipInitSpd[t]*this._curAnimtimeScale,a&&this.anim.once(s.EventType.FINISHED,a),this.anim.crossFade(t,this._crossTime),e){var l=h.duration;h.setTime(l*Math.random()),h.sample()}}else r.warn("没有"+t+"动作：",this.anim.node.name)},t}())||o),e._RF.pop()}}})),System.register("chunks:///_virtual/BasicState.ts",["cc","./Tools.ts"],(function(t){var e,i;return{setters:[function(t){e=t.cclegacy},function(t){i=t.default}],execute:function(){e._RF.push({},"d48de5PM/VA/5mIDg46CmW+","BasicState",void 0),t("BasicState",function(){function t(t){this.cmp=null,this.cmp=t}var e=t.prototype;return e.reset=function(){i.clearObj(this)},e.enter=function(t){},e.onEvents=function(){},e.offEvents=function(){},e.update=function(t){},e.exit=function(){},t}()),e._RF.pop()}}})),System.register("chunks:///_virtual/CameraLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalData.ts","./GlobalEnum.ts","./EventManager.ts","./EventTypes.ts","./BasicMountLayer.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.Camera,r=t.v3},function(t){o=t.default},function(t){a=t.GlobalEnum},function(t){h=t.default},function(t){l=t.EventTypes},function(t){c=t.BasicMountLayer}],execute:function(){var u;i._RF.push({},"4d6b6diR89KWq59OuECI/xS","CameraLayer",void 0);var p=s.ccclass;s.property,t("CameraLayer",p("CameraLayer")(u=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this)._initPos=r(),e._initRot=r(),e._initRothoHeight=3,e._followPos=null,e._cameraSelf=null,e._cameraCmp=null,e._tmpPos=r(),e}e(i,t);var s=i.prototype;return s.init=function(){this._initPos.set(this.node.position),this._initRot.set(this.node.eulerAngles),this._cameraSelf=this.node.children[0],this._cameraCmp=this._cameraSelf.getComponent(n),o.set(a.GlobalDataType.Camera3D,this._cameraCmp)},s.onEvents=function(){h.on(l.CameraEvents.SetCameraPos,this.onSetCameraPos,this),h.on(l.CameraEvents.SetFollowPos,this.onSetFollowPos,this),h.on(l.CameraEvents.SetCameraSelfRot,this.onSetCameraSelfRot,this),h.on(l.CameraEvents.SetCameraSelfPos,this.onSetCameraSelfPos,this),h.on(l.CameraEvents.SetCameraSelfOffset,this.onSetCameraSelfOffset,this),h.on(l.CameraEvents.SetCameraOrthoHeightOffset,this.onSetCameraOrthoHeightOffset,this)},s.setData=function(t){},s.reset=function(){this._followPos=null,this.node.setPosition(this._initPos)},s.customUpdate=function(t){this.followCamera(t)},s.customLateUpdate=function(t){},s.followCamera=function(t){this._followPos&&(this._tmpPos.set(this.node.position),this._tmpPos.lerp(this._followPos,.1),this.node.setPosition(this._tmpPos))},s.onSetCameraPos=function(t){t&&this.node.setPosition(t)},s.onSetFollowPos=function(t){this._followPos=t},s.onSetCameraSelfPos=function(t){this._cameraSelf.setPosition(t)},s.onSetCameraSelfOffset=function(t){this._cameraSelf.setPosition(t)},s.onSetCameraOrthoHeightOffset=function(t){this._cameraCmp.orthoHeight=this._initRothoHeight+t},s.onSetCameraSelfRot=function(t){this._cameraSelf.eulerAngles=t},i}(c))||u),i._RF.pop()}}})),System.register("chunks:///_virtual/CollisionManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicLayer.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v3,r=t.rect,o=t.v2,a=t.size,h=t.Vec3,l=t.Intersection2D},function(t){c=t.BasicLayer}],execute:function(){var u,p;t("ColliderGroup",void 0),i._RF.push({},"06250PAm0xG4L55xYkJC58i","CollisionManager",void 0);var f,m=s.ccclass,d=n(),y={};!function(t){t[t.None=0]="None",t[t.Player=1]="Player",t[t.PlayerBullet=2]="PlayerBullet",t[t.Enemy=3]="Enemy",t[t.EnemyBullet=4]="EnemyBullet",t[t.Prop=5]="Prop",t[t.Trap=6]="Trap",t[t.Barrier=7]="Barrier",t[t.PlayerTrigger=8]="PlayerTrigger",t[t.EnemyTrigger=9]="EnemyTrigger"}(f||(f=t("ColliderGroup",{})));var v=t("GroupConfig",{0:[],1:[7],2:[3],3:[],4:[1],5:[1],6:[1],7:[],8:[1],9:[3]}),g=t("CollisionManager",m("CollisionManager")(((p=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var s=i.prototype;return s.onEvents=function(){},s.reset=function(){for(var t=0;t<i.gridInfo.length;t++){var e=i.gridInfo[t];if(e)for(var s=0;s<e.length;s++){var n=e[s];if(n)for(var r in n)n[r]=null}}i.gridInfo=[],i.allColliderRecs={}},s.setData=function(t){},s.createMapData=function(t){var e=a(2*t.x,2*t.z);i.mapSize.set(e.width,1,e.height);var s=n(.5*-e.width,0,.5*-e.height),r=n(s);h.round(r,r),i.mapWpos.set(r);var o=i.mapSize,l=i.gridSize,c=n();c.x=o.x/l.x,c.y=o.y/l.y,c.z=o.z/l.z,h.ceil(c,c);for(var u=n(),p=Date.now(),m=0;m<=c.x;m++){u.x=Math.ceil(m),i.gridInfo[u.x]=[];for(var d=0;d<=c.z;d++){u.z=Math.ceil(d);var y={};for(var v in f)isNaN(v)||(y[+v]=[]);i.gridInfo[u.x][u.z]=y}}var g=Date.now();console.log("# 碰撞管理创建: ",g-p,"ms")},s.update=function(t){},i.setColilderByColId=function(t,e){this.allColliderRecs[t]=e},i.getColilderByColId=function(t){return this.allColliderRecs[t]},i.removeColliderByColId=function(t){this.allColliderRecs[t]&&delete this.allColliderRecs[t]},i.getInfo=function(t){return h.subtract(d,t,this.mapWpos),d.divide(this.gridSize),h.ceil(d,d),this.gridInfo[d.x]&&this.gridInfo[d.x][d.z]?this.gridInfo[d.x][d.z]:y},i.getInfoByGroup=function(t,e,i){i=i||{};for(var s=0;s<t.length;s++)for(var n=t[s],r=this.getInfo(n),o=0;o<e.length;o++){var a=e[o];if(r[a]){i[a]||(i[a]=[]);for(var h=0;h<r[a].length;h++){var l=r[a][h];l>=0&&i[a].indexOf(l)<0&&i[a].push(l)}}}return i},i.setInfo=function(t,e,i,s){h.subtract(d,t,this.mapWpos),d.divide(this.gridSize),h.ceil(d,d),s.set(d),d.y=0,this.gridInfo[d.x]||(this.gridInfo[d.x]=[]),this.gridInfo[d.x][d.z]||(this.gridInfo[d.x][d.z]={}),this.gridInfo[d.x][d.z][e]||(this.gridInfo[d.x][d.z][e]=[]);var n=this.gridInfo[d.x][d.z][e],r=n.indexOf(i);if(r>=0)return r;for(var o=0;o<n.length;o++)if(n[o]<0){n[o]=i,r=o;break}return r<0&&(n.push(i),r=n.length-1),r},i.clearInfo=function(t,e,i,s){if(d.set(t),!this.gridInfo[d.x]||!this.gridInfo[d.x][d.z])return!1;var n=this.gridInfo[d.x][d.z][e];return n[s]>=0&&n[s]==i&&(n[s]=-1),!0},i}(c)).gridInfo=[],p.allColliderRecs={},p.mapSize=n(),p.gridSize=n(1,1,1),p.mapWpos=n(),u=p))||u),P=t("CollisionTools",function(){function t(){}return t.getRectByPos=function(t,e){return this._tmpRect.set(0,0,2*e,2*e),this._tmpRect.center=this._tmpV2.set(t.x,t.z),this._tmpRect},t.getCollInfoByPos=function(t,e,i,s){this._tmpArr=[],this._tmpRect.set(0,0,2*e,2*e),this._tmpRect.center=this._tmpV2.set(t.x,t.z),this.updatePosRecFromRect(this._tmpRect,this._tmpArr);var n=!1;for(var r in this._tmpArr){var o=this._tmpArr[r];this.impreciseCheckByGroup(o,i,s)&&(n=!0)}return n},t.getCollInfoByRect=function(t,e,i){this._tmpArr=[],this.updatePosRecFromRect(t,this._tmpArr);var s=!1;for(var n in this._tmpArr){var r=this._tmpArr[n];this.impreciseCheckByGroup(r,e,i)&&(s=!0)}return s},t.updatePosRecFromRect=function(t,e){for(var i=g.gridSize,s=Math.ceil(t.width/i.x),r=Math.ceil(t.height/i.z),o=0,a=0;a<=s;a++)for(var h=0;h<=r;h++)e[o]||(e[o]=n()),e[o].set(a*i.x,0,h*i.z),e[o].add3f(t.x,0,t.y),o++},t.impreciseCheckByRect=function(t,e,i,s,n){void 0===n&&(n=!0);var r=!1;for(var o in i){var a=i[o];this.impreciseCheckByPos(t,e,a,s,n)&&(r=!0)}return r},t.impreciseCheckByPos=function(t,e,i,s,n){void 0===n&&(n=!0);var r=!1,o=g.getInfo(i);if(!o)return console.warn("# 获取检测数据错误 pos:"+i),!1;for(var a in o){var h=o[a],l=+a;if(h.length>0&&(n&&v[t].indexOf(l)>=0||!n)){s[l]||(s[l]=[]);for(var c=0;c<h.length;c++){var u=h[c];u>=0&&u!=e&&s[l].indexOf(u)<0&&s[l].push(u)}r||(r=s[l].length>0)}}return r},t.impreciseCheckByGroup=function(t,e,i){var s=!1,n=g.getInfo(t);if(!n)return console.warn("# 获取检测数据错误 pos:"+t),!1;for(var r in n){var o=n[r],a=+r;if(o.length>0&&i&&i.indexOf(a)>=0){e[a]||(e[a]=[]);for(var h=0;h<o.length;h++){var l=o[h];l>=0&&e[a].indexOf(l)<0&&e[a].push(l)}s||(s=e[a].length>0)}}return s},t.checkPosByColIdArrCb=function(t,e,i,s,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=!0),!i)return!1;var o={colId:-1,rect:this._tmpRect};this._tmpRect.set(0,0,2*e,2*e),this._tmpRect.center=this._tmpV2.set(t.x,t.z);for(var a=0;a<i.length;a++)this.checkRectByColId(this._tmpRect,i[a],o,n,r)&&s&&s(o);return!1},t.checkRectByColIdArrCb=function(t,e,i,s,n){if(void 0===s&&(s=!1),void 0===n&&(n=!0),!e)return!1;for(var r={colId:-1,rect:this._tmpRect},o=0;o<e.length;o++)this.checkRectByColId(t,e[o],r,s,n)&&i&&i(r);return!1},t.checkRectByColIdArr=function(t,e,i,s,n){if(void 0===s&&(s=!1),void 0===n&&(n=!0),!e)return!1;for(var r=0;r<e.length;r++)if(this.checkRectByColId(t,e[r],i,s,n))return!0;return!1},t.checkRectByColId=function(t,e,i,s,n){void 0===s&&(s=!1),void 0===n&&(n=!0);var r=!1,o=g.getColilderByColId(e);if(o&&(n||!n&&!o.isTrigger)){this._tmpRect.set(o.selfRect);var a=t.center,h=o.selfRect.center,c=.5*t.width,u=.5*o.selfRect.height;s&&o.isCircleCollider&&(r=l.circleCircle(a,c,h,u))&&i&&i.fixPos&&(this._tmpDirec.set(a).subtract(h),this._tmpDirec.normalize().multiplyScalar(c+u).add(h),i.fixPos.set(this._tmpDirec.x,0,this._tmpDirec.y)),s||o.isCircleCollider||(r=l.rectRect(t,this._tmpRect)),s&&!o.isCircleCollider&&(r=l.rectCircle(o.selfRect,a,c)),!s&&o.isCircleCollider&&(r=l.rectCircle(t,h,u)),r&&i&&(i.colId=e,i.rect.set(this._tmpRect))}return r},t}());P._tmpArr=[],P._tmpRect=r(),P._tmpV2=o(),P._tmpDirec=o(),i._RF.pop()}}})),System.register("chunks:///_virtual/Decorate.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicComponet.ts","./GlobalPool.ts"],(function(t){var e,i,s,n,r,o;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.MeshRenderer},function(t){r=t.BasicComponet},function(t){o=t.default}],execute:function(){var a;i._RF.push({},"03c2fqLmAJNO4i0knLkP03d","Decorate",void 0);var h=s.ccclass;s.property,t("Decorate",h("Decorate")(a=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).building=null,e.arr=["Architecture_A","Architecture_B","Architecture_C","Architecture_D","Architecture_E"],e}return e(i,t),i.prototype.onEnable=function(){if(!this.building){var t=this.arr[Math.floor(Math.random()*this.arr.length)];this.building=o.get(t),this.building.parent=this.node,this.building.setPosition(0,0,0);var e=this.building.getComponent(n);e&&(e.mesh.struct.maxPosition.multiplyScalar(3),e.mesh.struct.minPosition.multiplyScalar(3))}},i}(r))||a),i._RF.pop()}}})),System.register("chunks:///_virtual/Drone.ts",["cc","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventManager.ts","./EventTypes.ts","./AudioEnum.ts","./AudioSystem.ts","./Tools.ts","./ModifyPosRotMesh.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.Vec3,n=t.v3},function(t){r=t.WeaponCfg},function(t){o=t.GlobalEnum},function(t){a=t.GlobalTmpData},function(t){h=t.default},function(t){l=t.EventTypes},function(t){c=t.AudioEnum},function(t){u=t.AudioSystem},function(t){p=t.default},function(t){f=t.ModifyPosRotMesh}],execute:function(){var m;e._RF.push({},"e6050KsqotNArJhYJE76X2/","Drone",void 0);var d=i.ccclass;i.property,t("Drone",d("Drone")(m=function(){function t(t){this.curPos=n(),this.curRot=n(),this.node=null,this.height=0,this.transMsr=null,this.tmpP=n(),this.tmpP1=n(),this.offsetX=0,this.atkCd=0,this.curt=0,this.atk=0,this.tmpV=n(),this.atkData={pos:n(),rot:n(),lineVec:n(),rotSpd:n(),atkRate:1},this.shotBulletRot=[-3,0,3],this.node=t,this.transMsr=t.getComponent(f)}var e=t.prototype;return e.init=function(){this.height=r[o.WeaponType.Drone].droneheight,this.curPos.set(a.Player.wpos).add(a.Player.offset),this.curRot.y=a.Player.wrotY-1.57,this.curPos.y=15,this.initAtk()},e.reset=function(){p.clearObj(this)},e.setOffset=function(){},e.customUpdate=function(t){this.move(t),this.updateAtk(t)},e.move=function(t){this.tmpP1.set(this.offsetX,0,0),s.rotateY(this.tmpP1,this.tmpP1,s.ZERO,a.Player.wrotY-1.57),this.tmpP.set(a.Player.wpos),this.tmpP.add(this.tmpP1),this.curPos.lerp(this.tmpP,.1*t*60),this.curPos.y+=.1*(this.height-this.curPos.y)*t*60,this.curRot.y+=.2*(a.Player.wrotY-1.57-this.curRot.y)*t*60,this.transMsr&&this.transMsr.setTransData(this.curPos,this.curRot,2)},e.initAtk=function(){var t=r[o.WeaponType.Drone];this.atk=t.atk,this.atkCd=1/t.atkSpd,this.curt=0},e.updateAtk=function(t){a.Game.isGameRun&&(this.curt+=t,this.curt>=this.atkCd&&(this.curt=0,this.onAtk()))},e.onAtk=function(){u.playEffect(c.Drone);for(var t=r[o.WeaponType.Drone],e=this.curRot.y-1.57,i=0;i<this.shotBulletRot.length;i++){var n=.01745*this.shotBulletRot[i];this.tmpV.set(1,0,0),s.rotateY(this.tmpV,this.tmpV,s.ZERO,n+e),this.tmpV.multiplyScalar(t.bulletSpd||10),this.tmpP.set(this.curPos).add3f(0,1,0),this.atkData.pos.set(this.tmpP),this.atkData.lineVec.set(this.tmpV),this.atkData.rotSpd.set(s.ZERO),this.atkData.atkRate=t.bulletSpd,h.emit(l.EffectEvents.showMergeEffect,t.bullet,this.atkData)}},t}())||m),e._RF.pop()}}})),System.register("chunks:///_virtual/EffectLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventTypes.ts","./GlobalPool.ts","./BasicLayer.ts"],(function(t){var e,i,s,n,r,o,a;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.Vec3},function(t){r=t.EventTypes},function(t){o=t.default},function(t){a=t.BasicLayer}],execute:function(){var h;i._RF.push({},"2d11aUgpKtG1KIktFztkLFA","EffectLayer",void 0);var l=s.ccclass;s.property,t("EffectLayer",l("EffectLayer")(h=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this)._effectRecs={},e}e(i,t);var s=i.prototype;return s.init=function(){},s.onEvents=function(){this.on(r.EffectEvents.showParticleEffect,this.onShowParticleEffect,this),this.on(r.EffectEvents.showFrameEffect,this.onShowFrameEffect,this),this.on(r.EffectEvents.showObjs,this.onShowObjs,this)},s.setData=function(t){},s.reset=function(){this.resetEffects()},s.customUpdate=function(t){this.updateEffects(t)},s.customLateUpdate=function(t){},s.resetEffects=function(){for(var t in this._effectRecs){var e=this._effectRecs[t];e&&e.reset()}this._effectRecs={}},s.updateEffects=function(t){for(var e in this._effectRecs){var i=this._effectRecs[e];i&&i.isFinish?(i.reset(),delete this._effectRecs[e]):i.update(t)}},s.onShowParticleEffect=function(t,e){var i=o.get(t,e.p);i.parent=this.node,e.p&&i.setPosition(e.p),e.r&&(i.eulerAngles=e.r),e.s&&i.setScale(e.s)},s.onShowFrameEffect=function(t,e){var i=o.get(t,e);i.parent=this.node,i.setPosition(n.ZERO),i.eulerAngles=n.ZERO},s.onShowObjs=function(t,e){o.get(t,e).parent=this.node},i}(a))||h),i._RF.pop()}}})),System.register("chunks:///_virtual/ElectricSaw.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./CollisionManager.ts","./BasicProp.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Node,l=t.v3,c=t.Tween,u=t.tween},function(t){p=t.TrapCfg,f=t.GlobalConfig},function(t){m=t.GlobalEnum},function(t){d=t.ColliderGroup,y=t.CollisionManager},function(t){v=t.BasicProp}],execute:function(){var g,P,R,_,C,b,S,M,E;r._RF.push({},"74fa4VlUjhFOKwq1HyrFLBF","ElectricSaw",void 0);var T=o.ccclass,D=o.property;t("ElectricSaw",(g=T("ElectricSaw"),P=D({type:a(m.TrapType)}),R=D(h),_=D(h),g((S=e((b=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).cldGroup=d.PlayerTrigger,s(e,"trapType",S,n(e)),s(e,"moveTarget",M,n(e)),s(e,"line",E,n(e)),e._isMove=!1,e._isRuning=!1,e._offset=l(),e.tmpP=l(),e._rot=l(),e}i(e,t);var r=e.prototype;return r.setData=function(e){t.prototype.setData.call(this,e),this.setMove(e.d)},r.reset=function(){this.resetMove(),t.prototype.reset.call(this)},r.customUpdate=function(e){t.prototype.customUpdate.call(this,e),this.updateMove(e)},r.show=function(){t.prototype.show.call(this),!this._isRuning&&this._isMove&&this.moveAnim()},r.hide=function(){t.prototype.hide.call(this),this._isRuning&&this.resetMove()},r.setMove=function(t){this._isRuning=!1,this._isMove=null!=t&&0!=+t,this.line.active=this._isMove},r.resetMove=function(){this._isRuning=!1,this._offset.set(0,0,0),this.pos.set(0,0,0),this.moveTarget&&this.moveTarget.setPosition(this._offset),c.stopAllByTarget(this._offset)},r.updateMove=function(t){this._isMove&&this.moveTarget&&(this.moveTarget.setPosition(this._offset),this.pos.set(this.moveTarget.worldPosition)),this.rotateAnim(t)},r.moveAnim=function(){this._isRuning=!0,c.stopAllByTarget(this._offset);var t=.4*f.RoadWidth;this._offset.set(-t,0,0),u(this._offset).repeatForever(u(this._offset).to(3,{x:t},{easing:"sineInOut"}).to(3,{x:-t},{easing:"sineInOut"}).start()).start()},r.rotateAnim=function(t){this.moveTarget&&(this._rot.y+=180*t,this.moveTarget.eulerAngles=this._rot)},r.checkCollistion=function(){this.collider&&this.collider.checkPosCollistion(this.pos,this.onCheckColliderCb.bind(this))},r.onCheckColliderCb=function(t){var e=p[this.trapType];for(var i in t)for(var s=t[i],n=0;n<s.length;n++){var r=s[n],o=y.getColilderByColId(r).targetCmp;o&&o.byHit(e.atk)}},e}(v)).prototype,"trapType",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m.TrapType.ElectricSaw}}),M=e(b.prototype,"moveTarget",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(b.prototype,"line",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=b))||C)),r._RF.pop()}}})),System.register("chunks:///_virtual/EndMark.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalTmpData.ts","./EventManager.ts","./EventTypes.ts"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v3,r=t.Component},function(t){o=t.GlobalTmpData},function(t){a=t.default},function(t){h=t.EventTypes}],execute:function(){var l;i._RF.push({},"2676exKyutAEpl/fVo7GGFs","EndMark",void 0);var c=s.ccclass;s.property,t("EndMark",c("EndMark")(l=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).tmpP=n(),e}e(i,t);var s=i.prototype;return s.onLoad=function(){a.on(h.CurLevelEvents.GetEndPathInfo,this.onGetEndPathInfo,this)},s.onEnable=function(){this.init()},s.onDisable=function(){this.reset()},s.init=function(){var t=this;setTimeout((function(){o.Player.endMarkPos.set(t.node.worldPosition),o.endPassPath=[],t.getEndPaths(o.endPassPath)}),0)},s.reset=function(){},s.getEndPaths=function(t){t.push(this.node.getChildByName("p0").worldPosition),t.push(this.node.getChildByName("p1").worldPosition)},s.getFormation=function(t,e){var i=this.node.getChildByName("formation");this.tmpP.set(i.worldPosition),this.tmpP.x+=-4;for(var s=0,r=0,o=0;o<t;o++){var a=n(this.tmpP);a.x+=s*(8/9),a.z+=r*(8/9),e.push(a),++s>=10&&(s=0,r++)}},s.onGetEndPathInfo=function(t){this.getEndPaths(t.outPaths),this.getFormation(t.num,t.outFormation)},i}(r))||l),i._RF.pop()}}})),System.register("chunks:///_virtual/Enemy.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventManager.ts","./EventTypes.ts","./StorageSystem.ts","./Tools.ts","./BasicModifyMesh.ts","./BasicCollider.ts","./CollisionManager.ts","./BasicRole.ts","./EnemyAnim.ts","./EnemyStates.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g,P,R,_,C,b,S;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.size,r=t.v3},function(t){o=t.GlobalConfig},function(t){a=t.GlobalEnum},function(t){h=t.GlobalTmpData},function(t){l=t.default},function(t){c=t.EventTypes},function(t){u=t.StorageSystem},function(t){p=t.default},function(t){f=t.BasicModifyMesh},function(t){m=t.BasicCollider},function(t){d=t.ColliderGroup},function(t){y=t.BasicRole},function(t){v=t.EnemyAnim},function(t){g=t.EnemyStateType,P=t.EnemyMoveState,R=t.EnemyFollowState,_=t.EnemyEnterPassState,C=t.EnemyEndFollowState,b=t.EnemyDeathState,S=t.EnemyWinState}],execute:function(){var M;i._RF.push({},"2eeaa9muX9Bko67QJuZuRxy","Enemy",void 0);var E=s.ccclass;s.property,t("Enemy",E("Enemy")(M=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).node=null,e.enemyType=void 0,e.anim=null,e.modfiyMsCmp=null,e.curScale=1,e.tmpP=r(),e.tmpR=r(),e.tmpV=r(),e.tmpC=r(),e._shadowData={pos:null,scale:1,isShow:!0},e.lineVec=r(),e.pathIndex=0,e.allPath=null,e.moveSpd=0,e.isPathEnd=!1,e.isEndMark=!1,e.curPos=r(),e._rotVec=r(),e._toRadianY=0,e._curRadianY=0,e._rotDirec=1,e._rotSpd=1*Math.PI,e._rotSpdRate=1,e._followTarget=null,e._checkCd=.2,e._checkTime=0,e.collider=null,e.hp=0,e.atk=0,e._stateRecs={},e._curState=null,e._preState=null,e}e(i,t);var s=i.prototype;return s.init=function(t,e,i){this.enemyType=e,this.node=t,this.modfiyMsCmp=this.node.getComponent(f),this.modfiyMsCmp.setData(),this.anim=new v(this.node),this.anim.init(this),this.initProp(),this.initMoveData(i),this.setStateData(),this.setCollider(),this.initShadow()},s.reset=function(){this.anim.reset(),this.resetState(),this.resetCollider(),this.resetShadow(),p.clearObj(this)},s.update=function(t){this.updateState(t),this.updateCollider(t),this.updateTransData(t)},s.lateUpdate=function(t){this.lateUpdateCollider(t)},s.initShadow=function(){this._shadowData.pos=this.curPos,this._shadowData.isShow=!0,this._shadowData.scale=this.curScale,l.emit(c.EffectEvents.showMergeEffect,a.MergeEffectType.MergeShadow,this._shadowData)},s.resetShadow=function(){this._shadowData.isShow=!1},s.initMoveData=function(t){this.allPath=t,this.pathIndex=0,this.curPos.set(this.allPath[0]),this.isPathEnd=!1,this.isEndMark=!1,this.moveSpd=o.Enemy[this.enemyType].spd*(.15*Math.random()+1),this.lineVec.set(this.allPath[1]).subtract(this.allPath[0]);var e=Math.atan2(-this.lineVec.z,this.lineVec.x)+1.57;this.calRotation(e),this._curRadianY=this._toRadianY,this.modfiyMsCmp.setTransData(this.curPos,this._curRadianY,this.curScale)},s.move=function(t){this.tmpP.set(this.lineVec).multiplyScalar(t),this.curPos.add(this.tmpP);var e=Math.atan2(-this.lineVec.z,this.lineVec.x)+1.57;this.calRotation(e),this.rotation(t)},s.updateTransData=function(t){this.modfiyMsCmp.setTransData(this.curPos,this._curRadianY,this.curScale),this.modfiyMsCmp.updateColor(t)},s.calPathDirec=function(){var t=this.allPath[this.pathIndex],e=this.pathIndex+1;if(e>=this.allPath.length-1)this.isPathEnd=!0;else{var i=this.allPath[e],s=this.tmpP.set(t).subtract(i).lengthSqr();if(this.tmpP.set(this.curPos).subtract(t),this.tmpP.lengthSqr()>=s){if(this.pathIndex++,(e=this.pathIndex+1)>this.allPath.length-1)return void(this.isPathEnd=!0);t=this.allPath[this.pathIndex],i=this.allPath[e]}this.lineVec.set(i).subtract(t).normalize().multiplyScalar(this.moveSpd)}},s.rotation=function(t){if(this._curRadianY!==this._toRadianY){var e=this._rotSpd*this._rotSpdRate*t;e>Math.abs(this._curRadianY-this._toRadianY)?this._curRadianY=this._toRadianY:(e*=this._rotDirec,this._curRadianY+=e),this._rotVec.set(0,57.3*this._curRadianY,0)}},s.calRotation=function(t){this._toRadianY=t%6.28;var e=Math.PI;this._toRadianY<0&&(this._toRadianY+=2*e),this._curRadianY=this._curRadianY%(2*e),this._curRadianY>2*e?this._toRadianY-=2*e:this._curRadianY<0&&(this._toRadianY+=2*e);var i=this._toRadianY-this._curRadianY;i>e?(this._curRadianY+=2*e,this._rotDirec=-1):i<-e?(this._toRadianY+=2*e,this._rotDirec=1):i>0?this._rotDirec=1:i<0&&(this._rotDirec=-1)},s.setFollowTarget=function(t){this._followTarget=t,this._followTarget&&this.changeState(g.Follow)},s.checkPlayerCenterPos=function(t){if(this._checkTime+=t,this._checkTime>=this._checkCd){this._checkTime=0;var e=h.Player.wpos,i=o.EnemyCfg.followDist;this.tmpP.set(e).subtract(this.curPos).lengthSqr()<=i*i&&this.changeState(g.Follow)}},s.checkEndMark=function(){var t=h.Player.endMarkPos;!this.isEndMark&&Math.abs(this.curPos.x-t.x)<5&&this.curPos.z>t.z-.5&&(this.isEndMark=!0,this.changeState(g.EnterPass))},s.setCollider=function(){var t=o.EnemyCfg.cldRadius;this.collider=new m(d.Enemy,this,!0),this.collider.setRectSize(n(t,t)),this.collider.setRectPos(this.curPos),this.collider.updateGridInfo(!0),this.collider.isCircleCollider=!0},s.resetCollider=function(){this.collider&&(this.collider.clearGridInfo(),this.collider.removeFromManager(),this.collider=null)},s.updateCollider=function(t){this.collider&&this.collider.setRectPos(this.curPos)},s.lateUpdateCollider=function(t){this.collider&&this.collider.lateUpdate(t)},s.initProp=function(){var t=u.getData().levelAssets.curLv*o.EnemyCfg.lvupStep+1,e=o.Enemy[this.enemyType];this.hp=e.hp*t,this.atk=e.atk*t,this.curScale=e.scale},s.onAtk=function(){},s.byHit=function(t){this.hp<=0||(this.hp-=t,l.emit(c.EffectEvents.showMergeEffect,a.MergeEffectType.MergeEnemyByHit,{p:this.tmpP.set(this.curPos.x,.5,this.curPos.z)}),this.modfiyMsCmp.byHit(),this.hp<=0&&(this.hp=0,this.resetCollider(),this.modfiyMsCmp.setDeath(),this.changeState(g.Death)))},s.setStateData=function(){this._stateRecs[g.Move]=new P(this),this._stateRecs[g.Follow]=new R(this),this._stateRecs[g.EnterPass]=new _(this),this._stateRecs[g.EndFollow]=new C(this),this._stateRecs[g.Death]=new b(this),this._stateRecs[g.Win]=new S(this),this.changeState(g.Move),setTimeout((function(){}),0)},s.resetState=function(){for(var t in this._stateRecs)this._stateRecs[t].offEvents(),this._stateRecs[t].reset();this._stateRecs={},this._curState=null,this._preState=null},s.changeState=function(t,e,i){void 0===i&&(i=!1),(this._curState!==t||i)&&(this._stateRecs[this._curState]&&this._stateRecs[this._curState].exit(),this._stateRecs[t]&&(this._preState=this._curState,this._curState=t,this._stateRecs[this._curState].enter(e)))},s.updateState=function(t){this._stateRecs[this._curState]&&this._stateRecs[this._curState].update(t)},i}(y))||M),i._RF.pop()}}})),System.register("chunks:///_virtual/EnemyAnim.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Tools.ts","./BasicSkeleAnim.ts"],(function(t){var e,i,s,n,r;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator},function(t){n=t.default},function(t){r=t.BasicSkeleAnim}],execute:function(){var o;i._RF.push({},"0569fAx6cdNN7Xx1fp+AIWO","EnemyAnim",void 0);var a=s.ccclass;s.property,t("EnemyAnim",a("EnemyAnim")(o=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).cmp=null,e}e(i,t);var s=i.prototype;return s.onEvents=function(){},s.offEvents=function(){},s.init=function(e){t.prototype.init.call(this),this.cmp=e},s.reset=function(){t.prototype.reset.call(this),n.clearObj(this)},s.onAtk=function(){},i}(r))||o),i._RF.pop()}}})),System.register("chunks:///_virtual/EnemyBomb.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./EventManager.ts","./EventTypes.ts","./CollisionManager.ts","./Enemy.ts","./EnemyStates.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator},function(t){n=t.GlobalConfig},function(t){r=t.GlobalEnum},function(t){o=t.default},function(t){a=t.EventTypes},function(t){h=t.CollisionTools,l=t.ColliderGroup,c=t.CollisionManager},function(t){u=t.Enemy},function(t){p=t.EnemyStateType}],execute:function(){var f;i._RF.push({},"9b6e3BK6NBHDaAUEG7oEti6","EnemyBomb",void 0);var m=s.ccclass;s.property,t("EnemyBomb",m("EnemyBomb")(f=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var s=i.prototype;return s.byHit=function(t){this.hp<=0||(this.hp-=t,this.modfiyMsCmp.byHit(),this.hp<=0&&(this.hp=0,this.enemyBoom(),this.resetCollider(),this.modfiyMsCmp.setDeath(),this.changeState(p.Death)))},s.enemyBoom=function(){var t=this,e=n.Enemy[r.EnemyType.Bomb],i={};h.getCollInfoByPos(this.curPos,e.boomRadius,i,[l.Enemy,l.Player])&&function(){var s=e.boomAtk,n=e.boomRadius*e.boomRadius;for(var r in i)for(var o=i[r],a=0;a<o.length;a++){var h=o[a];h!=t.collider.SelfId&&function(){var e=c.getColilderByColId(h).targetCmp;e&&e!=t&&e.hp>0&&t.tmpP.set(t.curPos).subtract(e.curPos).lengthSqr()<=n&&setTimeout((function(){e.byHit(s)}),0)}()}}(),o.emit(a.EffectEvents.show3DTo2DEffect,{t:r.Effect3dType.Effect_jz_bomb_boom,p:this.curPos})},i}(u))||f),i._RF.pop()}}})),System.register("chunks:///_virtual/EnemyStates.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalEnum.ts","./GlobalTmpData.ts","./GlobalPool.ts","./BasicState.ts"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v3},function(t){r=t.GlobalEnum},function(t){o=t.GlobalTmpData},function(t){a=t.default},function(t){h=t.BasicState}],execute:function(){var l;t("EnemyStateType",void 0),i._RF.push({},"5a018qq2QVMY6DskHmiAl3G","EnemyStates",void 0),s.ccclass,s.property,function(t){t[t.Move=0]="Move",t[t.Follow=1]="Follow",t[t.EnterPass=2]="EnterPass",t[t.EndFollow=3]="EndFollow",t[t.Death=4]="Death",t[t.Win=5]="Win"}(l||(l=t("EnemyStateType",{}))),t("EnemyMoveState",function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var s=i.prototype;return s.enter=function(t){var e=this.cmp.enemyType==r.EnemyType.Ninja?r.EnemyClip.rush:r.EnemyClip.run;this.cmp.anim.playAnim(e,!0)},s.update=function(t){this.cmp.calPathDirec(),this.cmp.move(t),this.cmp.checkEndMark(),this.cmp.checkPlayerCenterPos(t)},i}(h)),t("EnemyFollowState",function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).checkCd=.1,e.curt=0,e.tmpP=n(),e}e(i,t);var s=i.prototype;return s.enter=function(t){},s.update=function(t){this.updateCheck(t),this.cmp.move(t),this.cmp.checkEndMark()},s.updateCheck=function(t){this.curt+=t,this.curt>=this.checkCd&&(this.curt=0,this.tmpP.set(o.Player.wpos).add(o.Player.offset).subtract(this.cmp.curPos),this.cmp._rotSpdRate=1.2,this.tmpP.normalize().multiplyScalar(1.2*this.cmp.moveSpd),this.cmp.lineVec.set(this.tmpP))},i}(h)),t("EnemyEnterPassState",function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var s=i.prototype;return s.enter=function(t){var e=this;this.cmp.allPath=[n(this.cmp.curPos)],o.endPassPath.forEach((function(t){e.cmp.allPath.push(n(t))})),this.cmp.pathIndex=0,this.cmp.lineVec.set(this.cmp.allPath[1]).subtract(this.cmp.allPath[0]),this.cmp.lineVec.normalize().multiplyScalar(this.cmp.moveSpd)},s.update=function(t){this.cmp.calPathDirec(),this.cmp.move(t),this.checkPass()},s.checkPass=function(){this.cmp.curPos.z>=this.cmp.allPath[this.cmp.allPath.length-1].z&&this.cmp.changeState(l.EndFollow)},i}(h)),t("EnemyEndFollowState",function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).targetRec=null,e.maxDist=0,e.tmpP=n(),e}e(i,t);var s=i.prototype;return s.enter=function(t){this.getTargetPos()},s.update=function(t){this.getTargetPos(),this.moveToTarget(t)},s.reset=function(){t.prototype.reset.call(this),this.targetRec&&(this.targetRec.p=null,this.targetRec.role=null),this.targetRec=null},s.moveToTarget=function(t){this.targetRec&&this.tmpP.set(this.cmp.curPos).subtract(this.targetRec.p).lengthSqr()>this.maxDist&&this.cmp.lineVec.set(0,0,this.cmp.moveSpd),this.tmpP.set(this.cmp.lineVec).multiplyScalar(t),this.cmp.curPos.add(this.tmpP)},s.getTargetPos=function(){if(!this.targetRec||this.targetRec&&this.targetRec.role.hp<0){var t=o.endFormationRec;for(var e in t){var i=t[e];if(i&&i.role.hp>0){this.targetRec=i,this.tmpP.set(this.targetRec.p).subtract(this.cmp.curPos),this.maxDist=this.tmpP.lengthSqr(),this.cmp.lineVec.set(this.tmpP).normalize().multiplyScalar(this.cmp.moveSpd);break}}this.targetRec||this.cmp.lineVec.set(0,0,this.cmp.moveSpd)}},s.exit=function(){},i}(h)),t("EnemyDeathState",function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this)._delayId=null,e}e(i,t);var s=i.prototype;return s.enter=function(t){var e=this;this.cmp.anim.playAnim(r.EnemyClip.death),this._delayId=setTimeout((function(){e.cmp&&e.cmp.node&&a.put(e.cmp.node)}),2e3)},s.update=function(t){},s.reset=function(){clearTimeout(this._delayId),t.prototype.reset.call(this)},i}(h)),t("EnemyWinState",function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var s=i.prototype;return s.enter=function(t){},s.update=function(t){},i}(h)),i._RF.pop()}}})),System.register("chunks:///_virtual/FortBarbette.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./EventTypes.ts","./BasicCollider.ts","./CollisionManager.ts","./BasicProp.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Node,l=t.Tween,c=t.tween,u=t.v3,p=t.Vec3},function(t){f=t.TrapCfg},function(t){m=t.GlobalEnum},function(t){d=t.EventTypes},function(t){y=t.BasicCollider},function(t){v=t.ColliderGroup},function(t){g=t.BasicProp}],execute:function(){var P,R,_,C,b,S,M;r._RF.push({},"e2ac7268b5G0aMpWOnSd2bI","FortBarbette",void 0);var E=o.ccclass,T=o.property,D=(t("FortBarbette",(P=E("FortBarbette"),R=T({type:a(m.TrapType)}),_=T(h),P((S=e((b=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).cldGroup=v.PlayerTrigger,s(e,"trapType",S,n(e)),s(e,"skeleNode",M,n(e)),e.anim=null,e._isPlaying=!1,e.isTriggerUsed=!1,e.tmpV=u(),e.tmpP=u(),e.atkData={pos:u(),rot:u(),lineVec:u(),rotSpd:u(),atkRate:1},e}i(e,t);var r=e.prototype;return r.initSub=function(){this.anim=new D(this.skeleNode),this.anim.init(this)},r.setData=function(e){this.anim.setData(),t.prototype.setData.call(this,e)},r.reset=function(){this.anim.reset(),this._isPlaying=!1,t.prototype.reset.call(this)},r.customUpdate=function(e){t.prototype.customUpdate.call(this,e),this.anim.update(e)},r.show=function(){this.isTriggerUsed&&!this._isPlaying&&(this._isPlaying=!0,this.anim.showAtkAnim())},r.hide=function(){this.isTriggerUsed&&this._isPlaying&&(this._isPlaying=!1,this.anim.stopAnim())},r.setCollider=function(){this.pos.set(this.node.worldPosition),this.collider=new y(this.cldGroup,this,!0),this.collider.setRectSize(this.cldSize),this.collider.setRectPos(this.pos),this.collider.updateGridInfo(!0),this.collider.isCircleCollider=this.isCircleCollider},r.resetCollider=function(){t.prototype.resetCollider.call(this),this.isTriggerUsed=!1},r.checkCollistion=function(){this.isTriggerUsed||this.collider&&this.collider.checkPosFast(this.pos,this.onTriggerEnter.bind(this))},r.onTriggerEnter=function(){var t=this;this.isTriggerUsed=!0,this.anim.showStartAnim((function(){t._isPlaying=!0,t.anim&&t.anim.showAtkAnim()}))},r.onAtk=function(){var t=f[this.trapType],e=this.node.eulerAngles.y+1.57;this.tmpV.set(1,0,0),p.rotateY(this.tmpV,this.tmpV,p.ZERO,e),this.tmpV.multiplyScalar(t.bulletSpd||10),this.tmpP.set(this.node.worldPosition).add3f(0,1,0),this.atkData.pos.set(this.tmpP),this.atkData.lineVec.set(this.tmpV),this.atkData.rotSpd.set(p.ZERO),this.atkData.atkRate=t.atkRate||1,this.emit(d.EffectEvents.showMergeEffect,t.bulletType,this.atkData)},e}(g)).prototype,"trapType",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m.TrapType.FortBarbette}}),M=e(b.prototype,"skeleNode",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=b))||C)),t("FortBarbetteAnim",function(){function t(t){this.cmp=null,this.body=null,this.head=null,this.bodyPos=u(),this.headPos=u(),this.initBodyPos=u(0,-2,0),this.initHeadPos=u(0,.42,0),this._isAtk=!1,this.body=t,this.head=t.getChildByName("head")}var e=t.prototype;return e.onEvents=function(){},e.offEvents=function(){},e.init=function(t){this.cmp=t},e.setData=function(){this.setAnim()},e.reset=function(){this.stopAnim()},e.update=function(t){this.updateAnim(t)},e.setAnim=function(){this.head.setPosition(this.initHeadPos),this.body.setPosition(this.initBodyPos),this._isAtk=!1},e.showStartAnim=function(t){var e=this;l.stopAllByTarget(this.bodyPos),this.bodyPos.set(this.initBodyPos),this.body.setPosition(this.bodyPos),c(this.bodyPos).to(.1,{y:0},{onUpdate:function(){e.body&&e.body.setPosition(e.bodyPos)}}).call((function(){t&&t()})).start()},e.showAtkAnim=function(){var t=this;this._isAtk=!0,l.stopAllByTarget(this.headPos),this.headPos.set(this.initHeadPos),this.head.setPosition(this.headPos),c(this.headPos).repeatForever(c(this.headPos).to(.1,{z:-.13}).to(.1,{z:0}).call((function(){t.onAtk()}))).start()},e.updateAnim=function(t){this._isAtk&&this.head.setPosition(this.headPos)},e.resetAnim=function(){this.stopAnim()},e.stopAnim=function(){this._isAtk=!1,l.stopAllByTarget(this.bodyPos),l.stopAllByTarget(this.headPos)},e.onAtk=function(){this.cmp&&this.cmp.onAtk()},t}()));r._RF.pop()}}})),System.register("chunks:///_virtual/FrameAnim.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicComponet.ts","./GlobalPool.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.MeshRenderer,h=t.director,l=t.v4},function(t){c=t.BasicComponet},function(t){u=t.default}],execute:function(){var p,f,m,d,y;r._RF.push({},"5cfccpOCOdDJ6u08wD4hk00","FrameAnim",void 0);var v=o.ccclass,g=o.property;t("FrameAnim",(p=v("FrameAnim"),f=g(a),p((y=e((d=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"mesh",y,n(e)),e.pass=null,e.handleFrameData=void 0,e.frameData=void 0,e.handlePlayData=void 0,e.playData=void 0,e}i(e,t);var r=e.prototype;return r.initSub=function(){this.initMat()},r.setData=function(t){if(this.node.setPosition(t.p),t.e&&(this.node.eulerAngles=t.e),t.s&&this.node.setScale(t.s),this.pass&&(this.playData.w=h.root.cumulativeTime,this.applyMat(),this.playData.x>0)){var e=this.playData.x*this.frameData.w/this.frameData.z;this.scheduleOnce(this.onPlayFinish,e+.1)}},r.onPlayFinish=function(){u.put(this.node)},r.initMat=function(){this.frameData=l(),this.playData=l();var t=this.mesh.getMaterial(0),e=t.passes[0],i=e.getHandle("playData");e.getUniform(i,this.playData),1!=this.playData.y&&(t=this.mesh.getMaterialInstance(0),this.pass=t.passes[0],this.handlePlayData=this.pass.getHandle("playData"),this.pass.getUniform(this.handlePlayData,this.playData),this.handleFrameData=this.pass.getHandle("frameData"),this.pass.getUniform(this.handleFrameData,this.frameData))},r.applyMat=function(){this.pass&&(this.pass.setUniform(this.handleFrameData,this.frameData),this.pass.setUniform(this.handlePlayData,this.playData))},e}(c)).prototype,"mesh",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=d))||m)),r._RF.pop()}}})),System.register("chunks:///_virtual/Game",["./BasicEffect.ts","./BasicLayer.ts","./BasicModifyMesh.ts","./BasicModifyRotMesh.ts","./BasicMountLayer.ts","./BasicRec.ts","./BasicRole2.ts","./BasicSkeleAnim.ts","./BasicState.ts","./CameraLayer.ts","./EffectLayer.ts","./FrameAnim.ts","./InstanceFrameAnim.ts","./LevelManager.ts","./HorizonTouch.ts","./BasicCollider.ts","./CollisionManager.ts","./BasicRole.ts","./Enemy.ts","./EnemyAnim.ts","./EnemyBomb.ts","./EnemyStates.ts","./GiantModifyMesh.ts","./Role.ts","./RoleAnim.ts","./RoleGiant.ts","./RoleHand.ts","./RoleLayer.ts","./RoleStates.ts","./BasicBullet.ts","./GrenadesBullet.ts","./MergeBullet.ts","./PistolBullet.ts","./MergeBasic.ts","./MergeEffect.ts","./MergeEffectLayer.ts","./MergeFrameAnim.ts","./MergeFrameGroup.ts","./MergeGroup.ts","./MergeMesh.ts","./MergeShadow.ts","./MergeUtils.ts","./BasicProp.ts","./Drone.ts","./ElectricSaw.ts","./FortBarbette.ts","./Grenades.ts","./Hammer.ts","./LandMine.ts","./ModifyPosRotMesh.ts","./Panels.ts","./PropsLayer.ts","./Rocket.ts","./Spininess.ts","./UpperAirNail.ts","./WeaponProp.ts","./Decorate.ts","./EndMark.ts","./PathBasic.ts","./RoadLayer.ts","./TrailLayer.ts","./TrailMesh.ts","./TrailRec.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}})),System.register("chunks:///_virtual/GiantModifyMesh.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicModifyMesh.ts"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.MeshRenderer},function(t){h=t.BasicModifyMesh}],execute:function(){var l,c,u,p,f,m,d,y,v;r._RF.push({},"7776b2d9YtMeJ+Pn9CIG0ya","GiantModifyMesh",void 0);var g=o.ccclass,P=o.property;t("GiantModifyMesh",(l=g("GiantModifyMesh"),c=P(a),u=P(a),p=P(a),l((d=e((m=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"msrA",d,n(e)),s(e,"msrB",y,n(e)),s(e,"msrC",v,n(e)),e.transData1=[0,0,0,0],e.transData2=[0,0,0,0],e.a_transData1="a_transData1",e.a_transData2="a_transData2",e._curColorNum=0,e._deathNum=1,e.msrArr=[],e}i(e,t);var r=e.prototype;return r.onLoad=function(){this.msrArr.push(this.msr,this.msrA,this.msrB,this.msrC);for(var t=0;t<this.msrArr.length;t++){var e=this.msrArr[t];delete e.mesh.struct.maxPosition,delete e.mesh.struct.minPosition,e.shadowCastingMode=0}},r.setData=function(){this._curColorNum=0,this._deathNum=1,this.transData2[0]=this._curColorNum,this.transData2[1]=this._deathNum},r.setTransData=function(t,e,i){this.transData1[0]=t.x,this.transData1[1]=i,this.transData1[2]=t.z,this.transData1[3]=e;for(var s=0;s<this.msrArr.length;s++){var n=this.msrArr[s];n.node.active&&n.setInstancedAttribute(this.a_transData1,this.transData1)}},r.byHit=function(){this._curColorNum=1},r.setDeath=function(){this._deathNum=.05},r.updateColor=function(t){this._curColorNum+=.2*(0-this._curColorNum)*t*60,this.transData2[0]=this._curColorNum,this.transData2[1]=this._deathNum;for(var e=0;e<this.msrArr.length;e++){var i=this.msrArr[e];i.node.active&&i.setInstancedAttribute(this.a_transData2,this.transData2)}},e}(h)).prototype,"msrA",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=e(m.prototype,"msrB",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(m.prototype,"msrC",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=m))||f)),r._RF.pop()}}})),System.register("chunks:///_virtual/Grenades.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,n;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.Component}],execute:function(){var r;i._RF.push({},"50056IFn3NFrryzWOfivHIX","Grenades",void 0);var o=s.ccclass;s.property,t("Grenades",o("Grenades")(r=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var s=i.prototype;return s.start=function(){},s.update=function(t){},i}(n))||r),i._RF.pop()}}})),System.register("chunks:///_virtual/GrenadesBullet.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicComponet.ts","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventTypes.ts","./GlobalPool.ts","./CollisionManager.ts","./ModifyPosRotMesh.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.Vec3,r=t.v3},function(t){o=t.BasicComponet},function(t){a=t.WeaponCfg},function(t){h=t.GlobalEnum},function(t){l=t.GlobalTmpData},function(t){c=t.EventTypes},function(t){u=t.default},function(t){p=t.CollisionTools,f=t.ColliderGroup,m=t.CollisionManager},function(t){d=t.ModifyPosRotMesh}],execute:function(){var y;i._RF.push({},"750bfka3LVF44YWlJ13lbL4","GrenadesBullet",void 0);var v=s.ccclass;s.property,t("GrenadesBullet",v("GrenadesBullet")(y=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).pos=r(),e.rot=r(),e.lineVec=r(),e.atkRate=0,e.modfiyMsCmp=null,e.maxDist=5,e.curDist=0,e.isFinish=!1,e.tmpP=r(),e.maxH=5,e.rotSpd=r(5,5,5),e}e(i,t);var s=i.prototype;return s.setData=function(t){this.modfiyMsCmp=this.node.getComponent(d),this.node.setPosition(n.ZERO),this.node.eulerAngles=n.ZERO,this.lineVec.set(t.lineVec),this.pos.set(t.pos),this.atkRate=t.atkRate,this.rot.set(n.ZERO),this.curDist=0,this.isFinish=!1},s.update=function(t){l.Game.isPause||this.isFinish||(this.tmpP.set(this.lineVec).multiplyScalar(t),this.curDist+=this.tmpP.length(),this.pos.add(this.tmpP),this.pos.y=Math.sin(this.curDist/this.maxDist*3.14)*this.maxH,this.tmpP.set(this.rotSpd).multiplyScalar(t),this.rot.add(this.tmpP),this.modfiyMsCmp.setTransData(this.pos,this.rot,2+.08*this.pos.y),this.curDist>=this.maxDist&&(this.isFinish=!0,this.onBoom()))},s.onBoom=function(){var t=this,e=a[h.WeaponType.Grenades],i={};p.getCollInfoByPos(this.pos,e.boomRadius,i,[f.Enemy])&&function(){var s=e.atk,n=e.boomRadius*e.boomRadius;for(var r in i)for(var o=i[r],a=function(e){var i=o[e],r=m.getColilderByColId(i).targetCmp;r&&r.hp>0&&t.tmpP.set(t.pos).subtract(r.curPos).lengthSqr()<=n&&setTimeout((function(){r.byHit(s)}),0)},h=0;h<o.length;h++)a(h)}(),this.emit(c.EffectEvents.show3DTo2DEffect,{t:h.Effect3dType.Effect_jz_rocketboom,p:this.pos}),setTimeout((function(){u.put(t.node)}),0)},i}(o))||y),i._RF.pop()}}})),System.register("chunks:///_virtual/Hammer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./AudioEnum.ts","./AudioSystem.ts","./CollisionManager.ts","./BasicProp.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Node,l=t.v3,c=t.Tween,u=t.tween},function(t){p=t.TrapCfg},function(t){f=t.GlobalEnum},function(t){m=t.AudioEnum},function(t){d=t.AudioSystem},function(t){y=t.ColliderGroup,v=t.CollisionManager},function(t){g=t.BasicProp}],execute:function(){var P,R,_,C,b,S,M,E,T;r._RF.push({},"a6716rgOTFIqLSTGZEo1sNd","Hammer",void 0);var D=o.ccclass,A=o.property;t("Hammer",(P=D("Hammer"),R=A({type:a(f.TrapType)}),_=A(h),C=A(h),P((M=e((S=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).cldGroup=y.PlayerTrigger,s(e,"trapType",M,n(e)),s(e,"moveTarget",E,n(e)),s(e,"root",T,n(e)),e.rotAnim=l(),e.isRuning=!1,e}i(e,t);var r=e.prototype;return r.setData=function(e){t.prototype.setData.call(this,e);var i=+e.d||2,s=l(0,2==i?0:180,0);this.root.eulerAngles=s},r.reset=function(){this.resetAnim(),t.prototype.reset.call(this)},r.customUpdate=function(e){t.prototype.customUpdate.call(this,e),this.updateAnim(e)},r.show=function(){t.prototype.show.call(this),this.isRuning||this.runAnim()},r.hide=function(){t.prototype.hide.call(this),this.isRuning&&this.resetAnim()},r.runAnim=function(){var t=this;this.isRuning=!0,c.stopAllByTarget(this.rotAnim),this.rotAnim.set(0,0,0),this.moveTarget.eulerAngles=this.rotAnim,u(this.rotAnim).repeatForever(u(this.rotAnim).to(.4,{z:90},{easing:"backInOut"}).call((function(){t.checkCollistion(),d.playEffect(m.Hammer)})).to(.4,{z:0},{easing:"sineIn"})).start()},r.resetAnim=function(){this.isRuning=!1,c.stopAllByTarget(this.rotAnim)},r.updateAnim=function(t){this.moveTarget&&(this.moveTarget.eulerAngles=this.rotAnim)},r.updateCollider=function(t){},r.onCheckColliderCb=function(t){var e=p[this.trapType];for(var i in t)for(var s=t[i],n=0;n<s.length;n++){var r=s[n],o=v.getColilderByColId(r).targetCmp;o&&o.byHit(e.atk)}},e}(g)).prototype,"trapType",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return f.TrapType.Spininess}}),E=e(S.prototype,"moveTarget",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(S.prototype,"root",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=S))||b)),r._RF.pop()}}})),System.register("chunks:///_virtual/HorizonTouch.ts",["cc","./EventManager.ts","./EventTypes.ts"],(function(t){var e,i,s,n,r,o,a;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.clamp,n=t.v3,r=t.v2},function(t){o=t.default},function(t){a=t.EventTypes}],execute:function(){var h;e._RF.push({},"5f5baAgtD5P74dC775UHe9P","HorizonTouch",void 0);var l=i.ccclass;i.property,t("HorizonTouch",l("HorizonTouch")(h=function(){function t(t,e,i){this.ctrlPos=n(),this.touchDistX=0,this.curSpdX=0,this.minX=0,this.maxX=0,this.fitMinX=0,this.fitMaxX=0,this.spdX=70,this.isTouch=!1,this.isMoveFinished=!1,this.initPos=n(),this.tmpPos=n(),this.preDirec=r(0,0),this.preTouchPos=r(),this.prePos=n(),this.touchStartPos=r(),this.initPos.set(t),this.ctrlPos.set(t),this.minX=e,this.maxX=i,this.fitMaxX=i,this.fitMinX=e,this.onEvents()}var e=t.prototype;return e.onEvents=function(){o.on(a.TouchEvents.TouchStart,this.onTouchStart,this),o.on(a.TouchEvents.TouchMove,this.onTouchMove,this),o.on(a.TouchEvents.TouchEnd,this.onTouchEnd,this)},e.reset=function(){this.ctrlPos.set(this.initPos),this.touchDistX=0,this.curSpdX=0,this.isTouch=!1,this.isMoveFinished=!1},e.update=function(t){this.move(t),this.fixPos(t)},e.move=function(t){if(this.tmpPos.set(this.ctrlPos),this.tmpPos.x!=this.touchDistX&&!this.isMoveFinished){var e=this.touchDistX>this.tmpPos.x?1:-1,i=Math.abs(this.touchDistX-this.tmpPos.x)/3;i=s(i,.1,10),this.curSpdX=this.spdX*i;var n=this.curSpdX*e*t+this.tmpPos.x;(e>0&&n>this.touchDistX||e<0&&n<this.touchDistX)&&(n=this.touchDistX),this.tmpPos.x=s(n,this.minX,this.maxX)}this.ctrlPos.set(this.tmpPos),this.tmpPos.x==this.touchDistX&&(this.isMoveFinished=!0)},e.fixPos=function(t){if(!this.isTouch&&this.isMoveFinished){var e=s(this.ctrlPos.x,this.fitMinX,this.fitMaxX);this.ctrlPos.x+=.1*(e-this.ctrlPos.x)*60*t}},e.onTouchStart=function(t){this.isTouch=!0,this.prePos.set(this.ctrlPos),this.preTouchPos.set(t),this.preDirec.set(0),this.touchStartPos.set(t)},e.onTouchMove=function(t,e){this.isTouch=!0,this.isMoveFinished=!1;var i=e.x-this.touchStartPos.x;this.touchDistX=.02*i+this.prePos.x,this.touchDistX=s(this.touchDistX,this.minX,this.maxX),this.preTouchPos.set(e)},e.onTouchEnd=function(t,e){this.isTouch=!1},t}())||h),e._RF.pop()}}})),System.register("chunks:///_virtual/InstanceFrameAnim.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicComponet.ts","./GlobalPool.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.v3,h=t.v2,l=t.MeshRenderer,c=t.Vec3},function(t){u=t.BasicComponet},function(t){p=t.default}],execute:function(){var f,m,d,y,v,g,P;r._RF.push({},"0f04eeOiJxLrIc9KEeYXv9T","InstanceFrameAnim",void 0);var R=o.ccclass,_=o.property,C=o.executeInEditMode;t("InstanceFrameAnim",R("InstanceFrameAnim")(f=C((d=e((m=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).msr=null,s(e,"delayTime",d,n(e)),s(e,"uvRange",y,n(e)),s(e,"uvStepTime",v,n(e)),s(e,"isLoop",g,n(e)),s(e,"scale",P,n(e)),e.curPos=a(),e.scaleRate=1,e.curUvOffset=h(),e.curUvTime=0,e.curFrameIndex=1,e.curUvXCount=0,e.maxFrame=1,e.uvOffsetStep=h(),e.isFinish=!1,e.curt=0,e._transData1=[0,0,0,1],e._data1="transData1",e._transData2=[0,0,0,0],e._data2="transData2",e._transData3=[0,0,0,0],e._data3="transData3",e}i(e,t);var r=e.prototype;return r.onEnable=function(){},r.setData=function(t){this.curPos.set(t.p),this.scaleRate=t.s||1,this.msr=this.node.getComponent(l),this.node.setPosition(this.curPos),this.node.eulerAngles=c.ZERO,this.setUv(),this.setMat()},r.reset=function(){},r.update=function(t){this.updateUv(t),this.updateMat(t)},r.setUv=function(){this.curt=0,this.isFinish=!1,this.maxFrame=this.uvRange.x*this.uvRange.y,this.uvOffsetStep.set(1/this.uvRange.x,1/this.uvRange.y),this.curUvOffset.set(0,0),this.curUvXCount=0,this.curFrameIndex=1,this.curUvTime=0},r.updateUv=function(t){(this.curFrameIndex<this.maxFrame||this.curFrameIndex>=this.maxFrame&&this.isLoop)&&(this.curUvTime+=t,this.curUvTime>=this.uvStepTime&&(this.curUvTime=0,this.curFrameIndex++,this.curUvOffset.x+=this.uvOffsetStep.x,this.curUvOffset.x>=1&&(this.curUvOffset.x=0,this.curUvXCount++),this.curUvOffset.y=this.uvOffsetStep.y*this.curUvXCount,this.curUvOffset.y>=1&&(this.curUvOffset.y=0,this.curUvXCount=0))),this.curt+=t,this.curt>=this.delayTime&&(this.curt=0,this.isFinish=!0,p.put(this.node))},r.setMat=function(){this._transData1[0]=this.curPos.x,this._transData1[1]=this.curPos.y,this._transData1[2]=this.curPos.z,this._transData1[3]=this.scaleRate,this._transData2[0]=this.uvOffsetStep.x,this._transData2[1]=this.uvOffsetStep.y,this._transData2[2]=0,this._transData2[3]=0,this._transData3[0]=this.scale.x,this._transData3[1]=this.scale.y,this._transData3[2]=this.scale.z,this.msr&&this.msr.setInstancedAttribute(this._data1,this._transData1),this.msr&&this.msr.setInstancedAttribute(this._data3,this._transData3)},r.updateMat=function(t){this.msr&&(this._transData2[2]=this.curUvOffset.x,this._transData2[3]=this.curUvOffset.y,this.msr.setInstancedAttribute(this._data2,this._transData2))},e}(u)).prototype,"delayTime",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y=e(m.prototype,"uvRange",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h()}}),v=e(m.prototype,"uvStepTime",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),g=e(m.prototype,"isLoop",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),P=e(m.prototype,"scale",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a(1,1,1)}}),f=m))||f)||f),r._RF.pop()}}})),System.register("chunks:///_virtual/LandMine.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./EventManager.ts","./EventTypes.ts","./AudioEnum.ts","./AudioSystem.ts","./GlobalPool.ts","./CollisionManager.ts","./BasicProp.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.size},function(t){l=t.TrapCfg},function(t){c=t.GlobalEnum},function(t){u=t.default},function(t){p=t.EventTypes},function(t){f=t.AudioEnum},function(t){m=t.AudioSystem},function(t){d=t.default},function(t){y=t.ColliderGroup,v=t.CollisionManager},function(t){g=t.BasicProp}],execute:function(){var P,R,_,C,b,S;r._RF.push({},"24fberoPHNLoJWdQpNCwcqA","LandMine",void 0);var M=o.ccclass,E=o.property;t("LandMine",(P=M("LandMine"),R=E({type:a(c.TrapType)}),P((b=e((C=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"trapType",b,n(e)),e.cldGroup=y.PlayerTrigger,s(e,"boomSize",S,n(e)),e.isTriggerUsed=!1,e}i(e,t);var r=e.prototype;return r.setData=function(e){t.prototype.setData.call(this,e)},r.reset=function(){this.resetCollider()},r.customUpdate=function(t){this.updateCollider(t)},r.customLateUpdate=function(t){this.lateUpdateCollider(t)},r.resetCollider=function(){this.isTriggerUsed=!1,t.prototype.resetCollider.call(this)},r.checkCollistion=function(){this.isTriggerUsed||this.collider&&this.collider.checkPosFast(this.pos,this.onTriggerEnter.bind(this))},r.updateCollider=function(t){this.checkCollistion(),this.isTriggerUsed&&d.put(this.node)},r.onTriggerEnter=function(){this.isTriggerUsed=!0,u.emit(p.EffectEvents.show3DTo2DEffect,{t:c.Effect3dType.Effect_jz_mine_boom,p:this.pos}),m.playEffect(f.boom),this.collider&&(this.collider.setRectSize(this.boomSize),this.collider.checkPosCollistion(this.pos,this.onCheckColliderCb.bind(this)))},r.onCheckColliderCb=function(t){var e=l[this.trapType];for(var i in t)for(var s=t[i],n=0;n<s.length;n++){var r=s[n],o=v.getColilderByColId(r).targetCmp;o&&o.byHit(e.atk)}},e}(g)).prototype,"trapType",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return c.TrapType.Spininess}}),S=e(C.prototype,"boomSize",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h()}}),_=C))||_)),r._RF.pop()}}})),System.register("chunks:///_virtual/LevelManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalTmpData.ts","./EventManager.ts","./EventTypes.ts","./StorageSystem.ts","./UIEnum.ts","./UISystem.ts","./EffectLayer.ts","./BasicMountLayer.ts","./MergeEffectLayer.ts","./RoleLayer.ts","./RoadLayer.ts","./CollisionManager.ts","./PropsLayer.ts","./GlobalPool.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g,P,R,_,C;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Node,h=t.Component},function(t){l=t.GlobalTmpData},function(t){c=t.default},function(t){u=t.EventTypes},function(t){p=t.StorageSystem},function(t){f=t.UIEnum},function(t){m=t.UISystem},function(t){d=t.EffectLayer},function(t){y=t.BasicMountLayer},function(t){v=t.MergeEffectLayer},function(t){g=t.RoleLayer},function(t){P=t.RoadLayer},function(t){R=t.CollisionManager},function(t){_=t.PropsLayer},function(t){C=t.default}],execute:function(){var b,S,M,E,T,D,A;r._RF.push({},"a6023B5i2FORIquIsXBKntO","LevelManager",void 0);var w=o.ccclass,x=o.property;t("LevelManager",(b=w("LevelManager"),S=x(a),M=x(a),b((D=e((T=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"layerNodeArr",D,n(e)),s(e,"perfabsLayer",A,n(e)),e._isPause=!1,e._isOver=!1,e._lvData=null,e._isRun=!1,e.mountLayers=[],e.customLayers=[],e}i(e,t);var r=e.prototype;return r.onLoad=function(){this.onEvents(),this.initLayers(),this.initCustomLayers()},r.onEvents=function(){c.on(u.GameEvents.GamePause,this.onGamePause,this),c.on(u.GameEvents.GameResume,this.onGameResume,this),c.on(u.GameEvents.GameRun,this.onGameRun,this),c.on(u.GameEvents.GameOver,this.onGameOver,this),c.on(u.GameEvents.SetGameTimeScale,this.onSetGameTimeScale,this),c.on(u.GameEvents.GameLoadFinish,this.onGameLoadFinish,this),c.on(u.TouchEvents.TouchStart,this.onTouchStart,this)},r.onEnable=function(){this.reset(),this.startRecord(),this.setData()},r.start=function(){},r.onDisable=function(){this.resetLayers(),this.resetCustomLayers()},r.reset=function(){this._isPause=!1,this._isOver=!1,this._isRun=!1,l.timeScale=1,l.reset(),this.resetLayers()},r.setData=function(){this._lvData=p.getLvData(),this.setLayersData(this._lvData),this.setCustomLayersData(this._lvData)},r.update=function(t){if(this.updateRunRecord(t),!this._isPause&&!this._isOver){this.updateGameRecord(t);var e=t*l.timeScale;this.updateLayers(e),this.updateCustomLayers(e)}},r.lateUpdate=function(t){if(!this._isPause&&!this._isOver){var e=t*l.timeScale;this.lateUpdateLayers(e),this.lateUpdateCustomLayers(e)}},r.startRecord=function(){l.Game.startTime=Date.now(),l.Game.totalTime=0,l.Game.endTime=0},r.updateRunRecord=function(t){l.Game.totalTime+=t},r.updateGameRecord=function(t){this._isOver||(l.Game.gameTime+=t)},r.stopRecord=function(){l.Game.endTime=Date.now()},r.initLayers=function(){for(var t=0;t<this.layerNodeArr.length;t++){var e=this.layerNodeArr[t].getComponent(y);this.mountLayers.push(e),e.initLayer()}},r.resetLayers=function(){for(var t=0;t<this.mountLayers.length;t++)this.mountLayers[t].reset()},r.setLayersData=function(t){for(var e=0;e<this.mountLayers.length;e++)this.mountLayers[e].setData(t)},r.updateLayers=function(t){for(var e=0;e<this.mountLayers.length;e++)this.mountLayers[e].customUpdate(t)},r.lateUpdateLayers=function(t){for(var e=0;e<this.mountLayers.length;e++)this.mountLayers[e].customLateUpdate(t)},r.initCustomLayers=function(){this.customLayers.push(new P(this.perfabsLayer)),this.customLayers.push(new _(this.perfabsLayer)),this.customLayers.push(new R(this.perfabsLayer)),this.customLayers.push(new d(this.perfabsLayer)),this.customLayers.push(new v(this.perfabsLayer)),this.customLayers.push(new g(this.perfabsLayer));for(var t=0;t<this.customLayers.length;t++)this.customLayers[t].initLayer()},r.resetCustomLayers=function(){for(var t=0;t<this.customLayers.length;t++)this.customLayers[t].reset();C.putAllChildren(this.perfabsLayer)},r.setCustomLayersData=function(t){for(var e=0;e<this.customLayers.length;e++)this.customLayers[e].setData(t)},r.updateCustomLayers=function(t){for(var e=0;e<this.customLayers.length;e++)this.customLayers[e].customUpdate(t)},r.lateUpdateCustomLayers=function(t){for(var e=0;e<this.customLayers.length;e++)this.customLayers[e].customLateUpdate(t)},r.runGame=function(){this._isRun||(this._isRun=!0)},r.onGameLoadFinish=function(){},r.onTouchStart=function(){},r.onGamePause=function(){this._isPause=!0,l.Game.isPause=!0},r.onGameResume=function(){this._isPause=!1,l.Game.isPause=!1},r.onSetGameTimeScale=function(t){void 0!==t&&(l.timeScale=t)},r.onGameOver=function(t){this._isOver||(l.Game.isGameOver=!0,this._isOver=!0,m.hideUI(f.FakeLevelAdUI),this.stopRecord())},r.onGameRun=function(){l.Game.isGameRun=!0,console.log("# Game Run #"),m.showUI(f.FakeLevelAdUI)},e}(h)).prototype,"layerNodeArr",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A=e(T.prototype,"perfabsLayer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=T))||E)),r._RF.pop()}}})),System.register("chunks:///_virtual/MergeBasic.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicComponet.ts"],(function(t){var e,i,s,n;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator},function(t){n=t.BasicComponet}],execute:function(){var r;i._RF.push({},"b5f549y/6xEpoUMJqvYU9w/","MergeBasic",void 0);var o=s.ccclass;s.property,t("MergeBasic",o("MergeBasic")(r=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.showEffect=function(t){return!0},i}(n))||r),i._RF.pop()}}})),System.register("chunks:///_virtual/MergeBullet.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalEnum.ts","./MergeBasic.ts","./MergeMesh.ts","./BasicBullet.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Mesh,l=t.MeshRenderer,c=t.utils,u=t.v4,p=t.v3,f=t.size},function(t){m=t.GlobalEnum},function(t){d=t.MergeBasic},function(t){y=t.MergeMesh},function(t){v=t.BasicBullet}],execute:function(){var g,P,R,_,C,b,S,M,E,T,D,A,w;r._RF.push({},"72632+6gCJE3JD050ETr+qn","MergeBullet",void 0);var x=o.ccclass,F=o.property;t("MergeBullet",(g=x("MergeBullet"),P=F({type:a(m.WeaponType)}),R=F({type:h,displayName:"合并模型"}),g(((w=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"weaponType",b,n(e)),e.meshRenderer=null,e.max=110,s(e,"mergeMesh",S,n(e)),s(e,"animTime",M,n(e)),s(e,"initAngY",E,n(e)),s(e,"bulletSize",T,n(e)),s(e,"isCircleCollider",D,n(e)),s(e,"bulletScale",A,n(e)),e._pass=null,e._trans0Handle=0,e._trans0Arr=[],e._trans1Handle=0,e._trans1Arr=[],e.effectRecs=[],e.isAllFinish=!1,e}i(e,t);var r=e.prototype;return r.initSub=function(){this.meshRenderer=this.node.getComponent(l),e.meshRecs[this.weaponType]||(e.meshRecs[this.weaponType]=new y,e.meshRecs[this.weaponType].init(this.mergeMesh,this.max),console.log("init:",this.node.name)),this.meshRenderer.mesh=c.createMesh(e.meshRecs[this.weaponType].meshData),this.initMats(),this.initEffects()},r.onEvents=function(){},r.setData=function(t){this.setMat(),this.setEffects()},r.reset=function(){this.resetMat(),this.resetEffects()},r.customUpdate=function(t){this.updateEffects(t),this.updateMats(t)},r.customLateUpdate=function(t){this.lateUpdateEffects(t)},r.initMats=function(){this._pass=this.meshRenderer.getMaterialInstance(0).passes[0],this._trans0Handle=this._pass.getHandle("trans0"),this._trans1Handle=this._pass.getHandle("trans1");for(var t=0;t<this.max;t++)this._trans0Arr.push(u(0,0,0,0)),this._trans1Arr.push(u(0,0,0,0))},r.setMat=function(){this.reset()},r.resetMat=function(){for(var t=0;t<this.max;t++)this._trans0Arr[t].set(0,0,0,0),this._trans1Arr[t].set(0,0,0,0);this.applyTrans()},r.applyTrans=function(){this._pass&&(this._pass.setUniformArray(this._trans0Handle,this._trans0Arr),this._pass.setUniformArray(this._trans1Handle,this._trans1Arr))},r.updateMats=function(t){this.applyTrans()},r.initEffects=function(){for(var t=p(0,this.initAngY,0),e=0;e<this.max;e++){var i=new v(e,this.weaponType,t);i.init(),this.effectRecs.push(i)}},r.setEffects=function(){for(var t=0;t<this.effectRecs.length;t++)this.effectRecs[t].reset();this.isAllFinish=!1},r.resetEffects=function(){for(var t=0;t<this.effectRecs.length;t++)this.effectRecs[t].reset();this.isAllFinish=!1},r.updateEffects=function(t){if(this.isAllFinish)this.node.active=!1;else for(var e=0;e<this.effectRecs.length;e++){var i=this.effectRecs[e];!i.isFinish&&i.update(t),this._trans0Arr[i._index].set(i.pos.x,i.pos.y,i.pos.z,i.scale*i.activeNum),this._trans1Arr[i._index].set(i.rot.x,i.rot.y,i.rot.z,i.opacity),this.isAllFinish=this.isAllFinish&&i.isFinish}},r.lateUpdateEffects=function(t){if(!this.isAllFinish)for(var e=0;e<this.effectRecs.length;e++)this.effectRecs[e].lateUpdate(t)},r.showEffect=function(t){for(var e=!1,i=0;i<this.effectRecs.length;i++){var s=this.effectRecs[i];if(s.isFinish){e=!0,s.setActive(t.pos,t.lineVec,t.rotSpd,t.atkRate,this.animTime,this.bulletSize,this.bulletScale,this.isCircleCollider),this.node.active=!0,this.isAllFinish=!1;break}}return e},e}(d)).meshRecs={},b=e((C=w).prototype,"weaponType",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S=e(C.prototype,"mergeMesh",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(C.prototype,"animTime",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),E=e(C.prototype,"initAngY",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),T=e(C.prototype,"bulletSize",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return f()}}),D=e(C.prototype,"isCircleCollider",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),A=e(C.prototype,"bulletScale",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_=C))||_)),r._RF.pop()}}})),System.register("chunks:///_virtual/MergeEffect.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalEnum.ts","./MergeBasic.ts","./MergeGroup.ts","./MergeMesh.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g,P;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Mesh,l=t.CCInteger,c=t.Vec2,u=t.MeshRenderer,p=t.utils,f=t.v4,m=t.v3},function(t){d=t.GlobalEnum},function(t){y=t.MergeBasic},function(t){v=t.PhyInitParam,g=t.MergeGroup},function(t){P=t.MergeMesh}],execute:function(){var R,_,C,b,S,M,E,T,D,A,w,x,F,k,B,L,G,I,z,U,O,H,N,V,W,Y,X,j,Z,q,J,K,Q,$,tt,et;r._RF.push({},"fe0edmsAa5PqYoyarJQ69q6","MergeEffect",void 0);var it=o.ccclass,st=o.property;t("MergeEffect",(R=it("MergeEffect"),_=st({type:a(d.MergeType)}),C=st({type:h,displayName:"合并模型",group:"合并参数"}),b=st({type:l,displayName:"单组数量",step:1,min:1,max:110,group:"合并参数"}),S=st({type:l,displayName:"动画时长",step:.1,group:"合并参数"}),M=st({type:c,displayName:"初始UV偏移"}),E=st({group:"物理参数"}),T=st({group:"物理参数"}),D=st({group:"物理参数"}),A=st({group:"物理参数",displayName:"角速度"}),w=st({group:"物理参数",displayName:"角度浮动"}),x=st({group:"物理参数",displayName:"角度衰减"}),F=st({group:"物理参数"}),k=st({group:"物理参数"}),B=st({group:"物理参数"}),L=st({group:"透明参数"}),G=st({group:"透明参数"}),R(((et=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"mergeType",U,n(e)),e.meshRenderer=null,e.max=110,s(e,"mergeMesh",O,n(e)),s(e,"groupNum",H,n(e)),s(e,"animTime",N,n(e)),s(e,"uvArr",V,n(e)),s(e,"lineSpd",W,n(e)),s(e,"lineFloat",Y,n(e)),s(e,"lineDamping",X,n(e)),s(e,"rotSpd",j,n(e)),s(e,"rotFloat",Z,n(e)),s(e,"rotDamping",q,n(e)),s(e,"initScale",J,n(e)),s(e,"scaleFloat",K,n(e)),s(e,"scaleSpd",Q,n(e)),s(e,"opacity",$,n(e)),s(e,"opacitySpd",tt,n(e)),e.curParam=null,e._pass=null,e._trans0Handle=0,e._trans0Arr=[],e._trans1Handle=0,e._trans1Arr=[],e.effectRecs=[],e.isAllFinish=!1,e}i(e,t);var r=e.prototype;return r.initSub=function(){this.meshRenderer=this.node.getComponent(u),e.meshRecs[this.mergeType]||(e.meshRecs[this.mergeType]=new P,e.meshRecs[this.mergeType].init(this.mergeMesh,this.max,this.uvArr),console.log("init:",this.node.name)),this.meshRenderer.mesh=p.createMesh(e.meshRecs[this.mergeType].meshData),this.initMats(),this.initPhyParams(),this.initEffects()},r.onEvents=function(){},r.setData=function(t){this.setMat(),this.setEffects()},r.reset=function(){this.resetMat(),this.resetEffects(),this.resetParams()},r.customUpdate=function(t){this.updateEffects(t),this.updateMats(t)},r.initPhyParams=function(){if(e.paramRecs[this.node.name])this.curParam=e.paramRecs[this.node.name];else{var t=new v;t.lineSpd.set(this.lineSpd),t.lineFloat.set(this.lineFloat),t.lineDamping.set(this.lineDamping),t.rotSpd.set(this.rotSpd),t.rotFloat.set(this.rotFloat),t.rotDamping.set(this.rotDamping),t.initScale=this.initScale,t.scaleFloat=this.scaleFloat,t.scaleSpd=this.scaleSpd,t.opacity=this.opacity,t.opacitySpd=this.opacitySpd,t.delayTime=this.animTime,e.paramRecs[this.node.name]=t,this.curParam=t}},r.resetParams=function(){},r.initMats=function(){this._pass=this.meshRenderer.getMaterialInstance(0).passes[0],this._trans0Handle=this._pass.getHandle("trans0"),this._trans1Handle=this._pass.getHandle("trans1");for(var t=0;t<this.max;t++)this._trans0Arr.push(f(0,0,0,0)),this._trans1Arr.push(f(0,0,0,0))},r.setMat=function(){this.resetMat()},r.resetMat=function(){for(var t=0;t<this.max;t++)this._trans0Arr[t].set(0,0,0,0),this._trans1Arr[t].set(0,0,0,0);this.applyTrans()},r.applyTrans=function(){this._pass&&(this._pass.setUniformArray(this._trans0Handle,this._trans0Arr),this._pass.setUniformArray(this._trans1Handle,this._trans1Arr))},r.updateMats=function(t){this.applyTrans()},r.initEffects=function(){this.groupNum=Math.floor(this.groupNum);for(var t=Math.floor(this.max/this.groupNum),e=0,i=0,s=0;s<t;s++){e=this.groupNum*s,i=this.groupNum*(s+1)-1;var n=new g(e,i,this.curParam);n.init(),this.effectRecs.push(n)}},r.setEffects=function(){for(var t=0;t<this.effectRecs.length;t++)this.effectRecs[t].reset();this.isAllFinish=!1},r.resetEffects=function(){for(var t=0;t<this.effectRecs.length;t++)this.effectRecs[t].reset();this.isAllFinish=!1},r.updateEffects=function(t){if(this.isAllFinish)this.node.active=!1;else for(var e=0;e<this.effectRecs.length;e++){var i=this.effectRecs[e];i.update(t);for(var s=i.startIndex,n=0;s<=i.endIndex;s++,n++){var r=i.items[n];this._trans0Arr[s].set(r.pos.x,r.pos.y,r.pos.z,r.scale*r.activeNum),this._trans1Arr[s].set(r.rot.x,r.rot.y,r.rot.z,r.opacity)}this.isAllFinish=this.isAllFinish&&i.isFinish}},r.showEffect=function(t){for(var e=!1,i=0;i<this.effectRecs.length;i++){var s=this.effectRecs[i];if(s.isFinish){e=!0,s.setActive(!0,t.p),this.node.active=!0,this.isAllFinish=!1;break}}return e},e}(y)).meshRecs={},et.paramRecs={},U=e((z=et).prototype,"mergeType",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O=e(z.prototype,"mergeMesh",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(z.prototype,"groupNum",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),N=e(z.prototype,"animTime",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),V=e(z.prototype,"uvArr",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W=e(z.prototype,"lineSpd",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m()}}),Y=e(z.prototype,"lineFloat",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m()}}),X=e(z.prototype,"lineDamping",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m()}}),j=e(z.prototype,"rotSpd",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m()}}),Z=e(z.prototype,"rotFloat",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m()}}),q=e(z.prototype,"rotDamping",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m()}}),J=e(z.prototype,"initScale",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),K=e(z.prototype,"scaleFloat",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Q=e(z.prototype,"scaleSpd",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$=e(z.prototype,"opacity",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tt=e(z.prototype,"opacitySpd",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I=z))||I)),r._RF.pop()}}})),System.register("chunks:///_virtual/MergeEffectLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalEnum.ts","./EventTypes.ts","./GlobalPool.ts","./BasicLayer.ts","./MergeBasic.ts"],(function(t){var e,i,s,n,r,o,a,h,l;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v3},function(t){r=t.GlobalEnum},function(t){o=t.EventTypes},function(t){a=t.default},function(t){h=t.BasicLayer},function(t){l=t.MergeBasic}],execute:function(){var c;i._RF.push({},"ca62fnerRZKH4P9VSVa8nK/","MergeEffectLayer",void 0);var u=s.ccclass;s.property,t("MergeEffectLayer",u("MergeEffectLayer")(c=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))||this).allMergeEffects={},e.initMergeTypes=[r.MergeEffectType.MergeShadow,r.MergeEffectType.MergePistolBullet,r.MergeEffectType.MergeRocketSmook,r.MergeEffectType.MergeRoleDeath],e._testT=0,e.testCD=1,e.testFrameNum=1,e.testRange=n(5,0,5),e}e(i,t);var s=i.prototype;return s.init=function(){for(var t=0;t<this.initMergeTypes.length;t++){var e=this.initMergeTypes[t];if(!this.allMergeEffects[e]){this.allMergeEffects[e]=[];var i=a.get(e);i.parent=this.node,i.position.set(0,0,0);var s=i.getComponent(l);this.allMergeEffects[e].push(s)}}},s.onEvents=function(){this.on(o.EffectEvents.showMergeEffect,this.onShowMergeEffect,this)},s.setData=function(t){},s.reset=function(){for(var t in this.allMergeEffects){for(var e=this.allMergeEffects[t],i=0;i<e.length;i++)a.put(e[i].node),e[i].reset();delete this.allMergeEffects[t]}this.allMergeEffects={}},s.customUpdate=function(t){for(var e in this.allMergeEffects)for(var i=this.allMergeEffects[e],s=0;s<i.length;s++)i[s].customUpdate(t)},s.customLateUpdate=function(t){for(var e in this.allMergeEffects)for(var i=this.allMergeEffects[e],s=0;s<i.length;s++)i[s].customLateUpdate(t)},s.onShowMergeEffect=function(t,e){var i=!1;this.allMergeEffects[t]||(this.allMergeEffects[t]=[]);for(var s=0;s<this.allMergeEffects[t].length;s++)if(this.allMergeEffects[t][s].showEffect(e)){i=!0;break}if(!i){var n=a.get(t);n.parent=this.node,n.position.set(0,0,0);var r=n.getComponent(l);r.showEffect(e),this.allMergeEffects[t].push(r)}},s.testUpdate=function(t){if(this._testT+=t,this._testT>=this.testCD){this._testT=0;for(var e=n(),i=0;i<this.testFrameNum;i++)e.x=(2*Math.random()-1)*this.testRange.x,e.y=(2*Math.random()-1)*this.testRange.y,e.z=(2*Math.random()-1)*this.testRange.z,this.onShowMergeEffect(r.MergeEffectType.MergeFrameAnim,{p:e})}},i}(h))||c),i._RF.pop()}}})),System.register("chunks:///_virtual/MergeFrameAnim.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalEnum.ts","./Tools.ts","./MergeBasic.ts","./MergeFrameGroup.ts","./MergeGroup.ts","./MergeMesh.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g,P,R,_,C;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Mesh,l=t.CCInteger,c=t.CCFloat,u=t.v2,p=t.MeshRenderer,f=t.utils,m=t.v4,d=t.v3,y=t.color},function(t){v=t.GlobalEnum},function(t){g=t.default},function(t){P=t.MergeBasic},function(t){R=t.MergeFrameGroup},function(t){_=t.PhyInitParam},function(t){C=t.MergeMesh}],execute:function(){var b,S,M,E,T,D,A,w,x,F,k,B,L,G,I,z,U,O,H,N,V,W,Y,X,j,Z,q,J,K,Q,$,tt,et,it,st,nt,rt,ot,at,ht,lt,ct,ut,pt,ft,mt,dt,yt;r._RF.push({},"4ee78xLeo5GoqACZseFeava","MergeFrameAnim",void 0);var vt=o.ccclass,gt=o.property;t("MergeFrameAnim",(b=vt("MergeFrameAnim"),S=gt({type:a(v.MergeType)}),M=gt({type:h,displayName:"合并模型",group:"合并参数"}),E=gt({type:l,displayName:"单组数量",step:1,min:1,max:55,group:"合并参数"}),T=gt({type:l,displayName:"动画时长",step:.1,group:"合并参数"}),D=gt({group:"物理参数"}),A=gt({group:"物理参数"}),w=gt({group:"物理参数"}),x=gt({group:"物理参数"}),F=gt({group:"物理参数"}),k=gt({group:"物理参数"}),B=gt({group:"物理参数"}),L=gt({group:"物理参数"}),G=gt({group:"物理参数"}),I=gt({group:"颜色"}),z=gt({group:"颜色"}),U=gt({group:"颜色"}),O=gt({group:"颜色"}),H=gt({type:c,group:"颜色"}),N=gt({group:"颜色"}),V=gt({group:"帧动画",displayName:"贴图排列"}),W=gt({group:"帧动画",displayName:"播放间隔"}),Y=gt({group:"帧动画",displayName:"是否循环"}),b(((yt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"mergeType",Z,n(e)),e.meshRenderer=null,e.max=55,s(e,"mergeMesh",q,n(e)),s(e,"groupNum",J,n(e)),s(e,"animTime",K,n(e)),s(e,"lineSpd",Q,n(e)),s(e,"lineFloat",$,n(e)),s(e,"lineDamping",tt,n(e)),s(e,"rotSpd",et,n(e)),s(e,"rotFloat",it,n(e)),s(e,"rotDamping",st,n(e)),s(e,"initScale",nt,n(e)),s(e,"scaleFloat",rt,n(e)),s(e,"scaleSpd",ot,n(e)),s(e,"opacity",at,n(e)),s(e,"opacitySpd",ht,n(e)),s(e,"initColor",lt,n(e)),s(e,"toColor",ct,n(e)),s(e,"colorSpdRate",ut,n(e)),s(e,"colorLoop",pt,n(e)),e.uvArr=[],e.initUvOffset=u(),e.uvOffsetMax=u(1,1),s(e,"uvRange",ft,n(e)),e.uvOffsetStep=u(),s(e,"uvStepTime",mt,n(e)),s(e,"uvLoop",dt,n(e)),e.maxFrame=10,e._pass=null,e._trans0Handle=0,e._trans0Arr=[],e._trans1Handle=0,e._trans1Arr=[],e._trans2Handle=0,e._trans2Arr=[],e._trans3Handle=0,e._trans3Arr=[],e.effectRecs=[],e.isAllFinish=!1,e}i(e,t);var r=e.prototype;return r.initSub=function(){this.meshRenderer=this.node.getComponent(p),e.meshRecs[this.mergeType]||(e.meshRecs[this.mergeType]=new C,e.meshRecs[this.mergeType].init(this.mergeMesh,this.max,this.uvArr),console.log("init:",this.node.name)),this.meshRenderer.mesh=f.createMesh(e.meshRecs[this.mergeType].meshData),this.initMats(),this.initPhyParams(),this.initEffects()},r.onEvents=function(){},r.setData=function(t){this.setMat(),this.setEffects()},r.reset=function(){this.resetMat(),this.resetEffects()},r.customUpdate=function(t){this.updateEffects(t),this.updateMats(t)},r.initPhyParams=function(){if(!e.paramRecs[this.mergeType]){var t=new _;t.lineSpd.set(this.lineSpd),t.lineFloat.set(this.lineFloat),t.lineDamping.set(this.lineDamping),t.rotSpd.set(this.rotSpd),t.rotFloat.set(this.rotFloat),t.rotDamping.set(this.rotDamping),t.initScale=this.initScale,t.scaleFloat=this.scaleFloat,t.scaleSpd=this.scaleSpd,t.opacity=this.opacity,t.opacitySpd=this.opacitySpd,t.delayTime=this.animTime,this.maxFrame=this.uvRange.x*this.uvRange.y,this.uvOffsetStep.set(1/this.uvRange.x,1/this.uvRange.y),t.initUvOffset.set(-this.uvOffsetStep.x,-this.uvOffsetStep.y),t.uvOffsetMax.set(this.uvOffsetMax),t.uvOffsetStep.set(this.uvOffsetStep),t.uvStepTime=this.uvStepTime,t.uvLoop=this.uvLoop,t.maxFrame=this.maxFrame,g.getColorRate(this.initColor,t.initColor),g.getColorRate(this.toColor,t.toColor),t.colorSpd=this.colorSpdRate,t.coloLoop=this.colorLoop,e.paramRecs[this.mergeType]=t}},r.initMats=function(){var t=this.meshRenderer.getMaterialInstance(0),e=m(1/this.uvRange.x,1/this.uvRange.y,0,0);t.setProperty("tilingOffset",e),this._pass=t.passes[0],this._trans0Handle=this._pass.getHandle("trans0"),this._trans1Handle=this._pass.getHandle("trans1"),this._trans2Handle=this._pass.getHandle("trans2"),this._trans3Handle=this._pass.getHandle("trans3");for(var i=0;i<this.max;i++)this._trans0Arr.push(m(0,0,0,0)),this._trans1Arr.push(m(0,0,0,0)),this._trans2Arr.push(m(0,0,0,0)),this._trans3Arr.push(m(0,0,0,0))},r.setMat=function(){this.reset()},r.resetMat=function(){for(var t=0;t<this.max;t++)this._trans0Arr[t].set(0,0,0,0),this._trans1Arr[t].set(0,0,0,0),this._trans2Arr[t].set(0,0,0,0),this._trans3Arr[t].set(0,0,0,0);this.applyTrans()},r.applyTrans=function(){this._pass&&(this._pass.setUniformArray(this._trans0Handle,this._trans0Arr),this._pass.setUniformArray(this._trans1Handle,this._trans1Arr),this._pass.setUniformArray(this._trans2Handle,this._trans2Arr),this._pass.setUniformArray(this._trans3Handle,this._trans3Arr))},r.updateMats=function(t){this.applyTrans()},r.initEffects=function(){for(var t=Math.floor(this.max/this.groupNum),i=0,s=0,n=0;n<t;n++){i=this.groupNum*n,s=this.groupNum*(n+1)-1;var r=new R(i,s,e.paramRecs[this.mergeType]);r.init(),this.effectRecs.push(r)}},r.setEffects=function(){for(var t=0;t<this.effectRecs.length;t++)this.effectRecs[t].reset();this.isAllFinish=!1},r.resetEffects=function(){for(var t=0;t<this.effectRecs.length;t++)this.effectRecs[t].reset();this.isAllFinish=!1},r.updateEffects=function(t){if(this.isAllFinish)this.node.active=!1;else for(var e=0;e<this.effectRecs.length;e++){var i=this.effectRecs[e];i.update(t);for(var s=i.startIndex,n=0;s<=i.endIndex;s++,n++){var r=i.items[n];this._trans0Arr[s].set(r.pos.x,r.pos.y,r.pos.z,r.scale*r.activeNum),this._trans1Arr[s].set(r.rot.x,r.rot.y,r.rot.z,r.opacity),this._trans2Arr[s].set(r.curUvOffset.x,r.curUvOffset.y,0,0),this._trans3Arr[s].set(r.curColor)}this.isAllFinish=this.isAllFinish&&i.isFinish}},r.showEffect=function(t){for(var e=!1,i=0;i<this.effectRecs.length;i++){var s=this.effectRecs[i];if(s.isFinish){e=!0,s.setActive(!0,t),this.node.active=!0,this.isAllFinish=!1;break}}return e},e}(P)).meshRecs={},yt.paramRecs={},Z=e((j=yt).prototype,"mergeType",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),q=e(j.prototype,"mergeMesh",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(j.prototype,"groupNum",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),K=e(j.prototype,"animTime",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Q=e(j.prototype,"lineSpd",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d()}}),$=e(j.prototype,"lineFloat",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d()}}),tt=e(j.prototype,"lineDamping",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d()}}),et=e(j.prototype,"rotSpd",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d()}}),it=e(j.prototype,"rotFloat",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d()}}),st=e(j.prototype,"rotDamping",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d()}}),nt=e(j.prototype,"initScale",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rt=e(j.prototype,"scaleFloat",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ot=e(j.prototype,"scaleSpd",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),at=e(j.prototype,"opacity",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ht=e(j.prototype,"opacitySpd",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lt=e(j.prototype,"initColor",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return y().fromHEX("#FFFFFF")}}),ct=e(j.prototype,"toColor",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return y().fromHEX("#FFFFFF")}}),ut=e(j.prototype,"colorSpdRate",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),pt=e(j.prototype,"colorLoop",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ft=e(j.prototype,"uvRange",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u()}}),mt=e(j.prototype,"uvStepTime",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),dt=e(j.prototype,"uvLoop",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),X=j))||X)),r._RF.pop()}}})),System.register("chunks:///_virtual/MergeFrameGroup.ts",["cc","./MergeGroup.ts"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.v3,n=t.v2,r=t.v4,o=t.clamp01,a=t.Vec4},function(t){h=t.PhyParam}],execute:function(){var l;e._RF.push({},"747887kmLFOL47BFlWCQLV7","MergeFrameGroup",void 0);var c=i.ccclass,u=(i.property,function(){function t(t,e){this.index=0,this.isFinish=!0,this.lineSpd=s(),this.rotSpd=s(),this.scaleSpd=0,this.opacitySpd=0,this.pos=s(),this.rot=s(),this.scale=0,this.opacity=0,this.activeNum=0,this.curUvOffset=n(),this.curUvTime=0,this.curFrameIndex=1,this.curUvXCount=0,this.curColor=r(),this.colMixRate=0,this.param=null,this.curt=0,this.tmpP=s(),this.tmpR=s(),this.tmpC1=r(),this.tmpC2=r(),this.param=e,this.index=t}var e=t.prototype;return e.init=function(){this.reset()},e.reset=function(){this.lineSpd.set(this.param.lineSpd),this.rotSpd.set(this.param.rotSpd),this.scaleSpd=this.param.scaleSpd,this.opacitySpd=this.param.opacitySpd,this.pos.set(0,0,0),this.rot.set(0,0,0),this.curUvOffset.set(this.param.initUvOffset),this.curColor.set(this.param.initColor),this.scale=0,this.opacity=0,this.isFinish=!0,this.curt=0,this.curUvTime=0,this.curFrameIndex=1,this.colMixRate=0,this.curUvXCount=0},e.setActive=function(t,e){this.reset(),this.activeNum=t?1:0,this.pos.set(e),this.isFinish=!1,this.scale=this.param.initScale,this.opacity=this.param.opacity},e.update=function(t){this.calParam(t)},e.calParam=function(t){this.isFinish||(this.tmpP.set(this.param.lineDamping).multiplyScalar(t),this.lineSpd.add(this.tmpP),this.tmpP.set(this.lineSpd).multiplyScalar(t),this.pos.add(this.tmpP),this.tmpR.set(this.param.rotDamping).multiplyScalar(t),this.rotSpd.add(this.tmpR),this.tmpR.set(this.rotSpd).multiplyScalar(t),this.rot.add(this.tmpR),this.scale+=this.scaleSpd*t*this.activeNum,this.scale=this.scale<0?0:this.scale,this.opacity=o(this.opacity+this.opacitySpd*t),this.curt+=t,this.curt>=this.param.delayTime&&(this.isFinish=!0),(this.curFrameIndex<this.param.maxFrame||this.curFrameIndex>=this.param.maxFrame&&this.param.uvLoop)&&(this.curUvTime+=t,this.curUvTime>=this.param.uvStepTime&&(this.curUvTime=0,this.curFrameIndex++,this.curUvOffset.x+=this.param.uvOffsetStep.x,this.curUvOffset.x>=this.param.uvOffsetMax.x&&(this.curUvOffset.x=0,this.curUvXCount++),this.curUvOffset.y=this.param.uvOffsetStep.y*this.curUvXCount,this.curUvOffset.y>=this.param.uvOffsetMax.y&&(this.curUvOffset.y=0,this.curUvXCount=0))),this.colMixRate+=this.param.colorSpd*t,this.colMixRate>1&&(this.colMixRate=this.param.coloLoop?0:1),this.tmpC1.set(this.param.initColor).multiplyScalar(1-this.colMixRate),this.tmpC2.set(this.param.toColor).multiplyScalar(this.colMixRate),a.add(this.curColor,this.tmpC1,this.tmpC2))},t}());t("MergeFrameGroup",c("MergeFrameGroup")(l=function(){function t(t,e,i){this.startIndex=0,this.endIndex=0,this.items=[],this.initParam=null,this.isFinish=!0,this.startIndex=t,this.endIndex=e,this.initParam=i;for(var s=this.startIndex;s<=this.endIndex;s++){var n=s,r=this.getPhyParam(i),o=new u(n,r);this.items.push(o)}}var e=t.prototype;return e.getPhyParam=function(t){var e=s(t.lineFloat).multiplyScalar(.5),i=s(t.rotFloat).multiplyScalar(.5),n=.5*t.scaleFloat,r=new h;return r.lineSpd.x=t.lineSpd.x+(2*Math.random()-1)*e.x,r.lineSpd.y=t.lineSpd.y+(2*Math.random()-1)*e.y,r.lineSpd.z=t.lineSpd.z+(2*Math.random()-1)*e.z,r.lineDamping.set(t.lineDamping),r.rotSpd.x=t.rotSpd.x+(2*Math.random()-1)*i.x,r.rotSpd.y=t.rotSpd.y+(2*Math.random()-1)*i.y,r.rotSpd.z=t.rotSpd.z+(2*Math.random()-1)*i.z,r.initScale=t.initScale+(2*Math.random()-1)*n,r.scaleSpd=t.scaleSpd,r.opacity=t.opacity,r.opacitySpd=t.opacitySpd,r.delayTime=t.delayTime,r.uvOffsetMax.set(t.uvOffsetMax),r.uvOffsetStep.set(t.uvOffsetStep),r.uvStepTime=t.uvStepTime,r.initUvOffset.set(t.initUvOffset),r.uvLoop=t.uvLoop,r.maxFrame=t.maxFrame,r.colorSpd=t.colorSpd,r.initColor.set(t.initColor),r.toColor.set(t.toColor),r.coloLoop=t.coloLoop,r},e.setActive=function(t,e){this.isFinish=!1;for(var i=0;i<this.items.length;i++)this.items[i].setActive(t,e)},e.init=function(){for(var t=0;t<this.items.length;t++)this.items[t].init()},e.reset=function(){this.isFinish=!0;for(var t=0;t<this.items.length;t++)this.items[t].reset()},e.update=function(t){for(var e=!0,i=0;i<this.items.length;i++){var s=this.items[i];s.update(t),e=e&&s.isFinish}this.isFinish=e,this.isFinish&&this.reset()},t}())||l),e._RF.pop()}}})),System.register("chunks:///_virtual/MergeGroup.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,n,r,o,a;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v3,r=t.v2,o=t.v4,a=t.clamp01}],execute:function(){var h;i._RF.push({},"b9bc7zLcUhJ1alb9LGWRokX","MergeGroup",void 0);var l=s.ccclass,c=(s.property,function(){function t(t,e){this.index=0,this.isFinish=!0,this.lineSpd=n(),this.rotSpd=n(),this.scaleSpd=0,this.opacitySpd=0,this.pos=n(),this.rot=n(),this.scale=0,this.opacity=0,this.activeNum=0,this.param=null,this.curt=0,this.tmpP=n(),this.tmpR=n(),this.param=e,this.index=t}var e=t.prototype;return e.init=function(){this.reset()},e.reset=function(){this.lineSpd.set(this.param.lineSpd),this.rotSpd.set(this.param.rotSpd),this.scaleSpd=this.param.scaleSpd,this.opacitySpd=this.param.opacitySpd,this.pos.set(0,0,0),this.rot.set(0,0,0),this.scale=0,this.opacity=0,this.isFinish=!0,this.curt=0},e.setActive=function(t,e){this.reset(),this.activeNum=t?1:0,this.pos.set(e),this.isFinish=!1,this.scale=this.param.initScale,this.opacity=this.param.opacity},e.update=function(t){this.calParam(t)},e.calParam=function(t){this.isFinish||(this.tmpP.set(this.param.lineDamping).multiplyScalar(t),this.lineSpd.add(this.tmpP),this.tmpP.set(this.lineSpd).multiplyScalar(t),this.pos.add(this.tmpP),this.tmpR.set(this.param.rotDamping).multiplyScalar(t),this.rotSpd.add(this.tmpR),this.tmpR.set(this.rotSpd).multiplyScalar(t),this.rot.add(this.tmpR),this.scale+=this.scaleSpd*t*this.activeNum,this.scale=this.scale<0?0:this.scale,this.opacity=a(this.opacity+this.opacitySpd*t),this.curt+=t,this.curt>=this.param.delayTime&&(this.isFinish=!0))},t}()),u=(t("MergeGroup",l("MergeGroup")(h=function(){function t(t,e,i){this.startIndex=0,this.endIndex=0,this.items=[],this.initParam=null,this.isFinish=!0,this.startIndex=t,this.endIndex=e,this.initParam=i;for(var s=this.startIndex;s<=this.endIndex;s++){var n=s,r=this.getPhyParam(i),o=new c(n,r);this.items.push(o)}}var e=t.prototype;return e.getPhyParam=function(t){var e=n(t.lineFloat).multiplyScalar(.5),i=n(t.rotFloat).multiplyScalar(.5),s=.5*t.scaleFloat,r=new u;return r.lineSpd.x=t.lineSpd.x+(2*Math.random()-1)*e.x,r.lineSpd.y=t.lineSpd.y+(2*Math.random()-1)*e.y,r.lineSpd.z=t.lineSpd.z+(2*Math.random()-1)*e.z,r.lineDamping.set(t.lineDamping),r.rotSpd.x=t.rotSpd.x+(2*Math.random()-1)*i.x,r.rotSpd.y=t.rotSpd.y+(2*Math.random()-1)*i.y,r.rotSpd.z=t.rotSpd.z+(2*Math.random()-1)*i.z,r.initScale=t.initScale+(2*Math.random()-1)*s,r.scaleSpd=t.scaleSpd,r.opacity=t.opacity,r.opacitySpd=t.opacitySpd,r.delayTime=t.delayTime,r},e.setActive=function(t,e){this.isFinish=!1;for(var i=0;i<this.items.length;i++)this.items[i].setActive(t,e)},e.init=function(){for(var t=0;t<this.items.length;t++)this.items[t].init()},e.reset=function(){this.isFinish=!0;for(var t=0;t<this.items.length;t++)this.items[t].reset()},e.update=function(t){for(var e=!0,i=0;i<this.items.length;i++){var s=this.items[i];s.update(t),e=e&&s.isFinish}this.isFinish=e,this.isFinish&&this.reset()},t}())||h),t("PhyParam",(function(){this.lineSpd=n(),this.lineDamping=n(),this.rotSpd=n(),this.rotDamping=n(),this.initScale=1,this.scaleSpd=0,this.opacity=1,this.opacitySpd=0,this.delayTime=0,this.initUvOffset=r(),this.uvOffsetMax=r(),this.uvOffsetStep=r(),this.uvStepTime=.1,this.uvLoop=!1,this.maxFrame=1,this.initColor=o(),this.toColor=o(),this.colorSpd=.5,this.coloLoop=!1})));t("PhyInitParam",function(t){function i(){var e;return(e=t.call(this)||this).ParamId=0,e.lineFloat=n(),e.rotFloat=n(),e.scaleFloat=0,e.ParamId=i._PhyInitParamId++,e}return e(i,t),i}(u))._PhyInitParamId=0,i._RF.pop()}}})),System.register("chunks:///_virtual/MergeMesh.ts",["cc","./MergeUtils.ts"],(function(t){var e,i,s,n,r;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.v2,n=t.gfx},function(t){r=t.MergeUtils}],execute:function(){var o;e._RF.push({},"0233dV92BZD37gEcBDzI7AR","MergeMesh",void 0);var a=i.ccclass;i.property,t("MergeMesh",a("MergeMesh")(o=function(){function t(){this.meshData=null,this.subMesh=null,this.mergeCount=1,this.uvOffsetArr=[]}var e=t.prototype;return e.init=function(t,e,i){this.meshData||(this.subMesh=t,this.mergeCount=e,this.uvOffsetArr=i||[s(0,0)],this.initMeshData(),this.mergeMeshData())},e.initMeshData=function(){this.meshData={positions:[],normals:[],uvs:[],indices:[],customAttributes:[{attr:{name:"a_animData0",format:n.Format.RGBA32F,isNormalized:!1,stream:0,isInstanced:!1,location:0},values:[]}]}},e.mergeMeshData=function(){for(var t=r.getRiginalMeshData(this.subMesh),e=s(0,0),i=0;i<this.mergeCount;i++){var n=t.positions.length/3,o=this.meshData.positions.length/3;r.copyArr(this.meshData.positions,t.positions),r.copyArr(this.meshData.normals,t.normals),r.copyArr(this.meshData.uvs,t.uvs);for(var a=0,h=t.indices.length;a<h;++a)this.meshData.indices.push(t.indices[a]+o);if(this.uvOffsetArr.length>0){var l=this.uvOffsetArr[Math.floor(Math.random()*this.uvOffsetArr.length)]||e;e.set(l)}for(var c=this.meshData.customAttributes[0].values,u=0;u<n;++u)c.push(e.x,e.y,0,i)}},t}())||o),e._RF.pop()}}})),System.register("chunks:///_virtual/MergeShadow.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MergeBasic.ts","./MergeMesh.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Mesh,h=t.MeshRenderer,l=t.utils,c=t.v4},function(t){u=t.MergeBasic},function(t){p=t.MergeMesh}],execute:function(){var f,m,d,y,v,g;r._RF.push({},"eed2biGiV9PorCo4SXKVhQA","MergeShadow",void 0);var P=o.ccclass,R=o.property,_=(t("MergeShadow",(f=P("MergeShadow"),m=R({type:a,displayName:"合并模型"}),f(((g=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).meshRenderer=null,e.max=110,s(e,"mergeMesh",v,n(e)),e._pass=null,e._trans0Handle=0,e._trans0Arr=[],e.effectRecs=[],e.isAllFinish=!1,e}i(e,t);var r=e.prototype;return r.initSub=function(){this.meshRenderer=this.node.getComponent(h),e.meshData||(e.meshData=new p,e.meshData.init(this.mergeMesh,this.max),console.log("init:",this.node.name)),this.meshRenderer.mesh=l.createMesh(e.meshData.meshData),this.initMats(),this.initEffects()},r.onEvents=function(){},r.setData=function(t){this.setMat(),this.setEffects()},r.reset=function(){this.resetMat(),this.resetEffects()},r.customUpdate=function(t){this.updateEffects(t),this.updateMats(t)},r.customLateUpdate=function(t){this.lateUpdateEffects(t)},r.initMats=function(){this._pass=this.meshRenderer.getMaterialInstance(0).passes[0],this._trans0Handle=this._pass.getHandle("trans0");for(var t=0;t<this.max;t++)this._trans0Arr.push(c(0,0,0,0))},r.setMat=function(){this.reset()},r.resetMat=function(){for(var t=0;t<this.max;t++)this._trans0Arr[t].set(0,0,0,0);this.applyTrans()},r.applyTrans=function(){this._pass&&this._pass.setUniformArray(this._trans0Handle,this._trans0Arr)},r.updateMats=function(t){this.applyTrans()},r.initEffects=function(){for(var t=0;t<this.max;t++){var e=new _(t);e.init(),this.effectRecs.push(e)}},r.setEffects=function(){for(var t=0;t<this.effectRecs.length;t++)this.effectRecs[t].reset();this.isAllFinish=!1},r.resetEffects=function(){for(var t=0;t<this.effectRecs.length;t++)this.effectRecs[t].reset();this.isAllFinish=!1},r.updateEffects=function(t){if(this.isAllFinish)this.node.active=!1;else{this.isAllFinish=!0;for(var e=0;e<this.effectRecs.length;e++){var i=this.effectRecs[e];i.param?(this.isAllFinish=!1,this._trans0Arr[i._index].set(i.param.pos.x,i.param.pos.y+.1,i.param.pos.z,i.scale*i.activeNum),i.param.isShow||i.reset()):this._trans0Arr[i._index].set(0,0,0,0)}}},r.lateUpdateEffects=function(t){},r.showEffect=function(t){for(var e=!1,i=0;i<this.effectRecs.length;i++){var s=this.effectRecs[i];if(!s.param){e=!0,s.setActive(t),this.node.active=!0,this.isAllFinish=!1;break}}return e},e}(u)).meshData=null,v=e((y=g).prototype,"mergeMesh",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=y))||d)),t("ShadowItem",function(){function t(t){this._index=0,this.scale=0,this.activeNum=0,this.param=null,this._index=t}var e=t.prototype;return e.init=function(){},e.setActive=function(t){this.scale=t.scale,this.activeNum=1,this.param=t},e.reset=function(){this.activeNum=0,this.param=null},t}()));r._RF.pop()}}})),System.register("chunks:///_virtual/MergeUtils.ts",["cc"],(function(t){var e,i,s;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.gfx}],execute:function(){var n;e._RF.push({},"74fc2HBDwxLmJx838PY42bp","MergeUtils",void 0);var r=i.ccclass;i.property,t("MergeUtils",r("MergeUtils")(n=function(){function t(){}return t.getRiginalMeshData=function(t,e){void 0===e&&(e=!1);var i={};return i.positions=t.readAttribute(0,s.AttributeName.ATTR_POSITION),i.normals=t.readAttribute(0,s.AttributeName.ATTR_NORMAL),i.tangents=t.readAttribute(0,s.AttributeName.ATTR_TANGENT),i.uvs=t.readAttribute(0,s.AttributeName.ATTR_TEX_COORD),i.colors=t.readAttribute(0,s.AttributeName.ATTR_COLOR),i.indices=t.readIndices(0),e&&(this.rotatePos(i.positions),this.rotatePos(i.normals),this.rotatePos(i.tangents)),i},t.copyArr=function(t,e){for(var i=0,s=e.length;i<s;++i)t.push(e[i])},t.rotatePos=function(t){for(var e=t.length/3,i=0;i<e;++i){var s=3*i+1,n=t[s];t[s]=t[s+1],t[s+1]=-n}},t}())||n),e._RF.pop()}}})),System.register("chunks:///_virtual/ModifyPosRotMesh.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,n,r;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.MeshRenderer,r=t.Component}],execute:function(){var o;i._RF.push({},"9071c4e2TJOWaiJaOIM4/Xm","ModifyPosRotMesh",void 0);var a=s.ccclass;s.property,t("ModifyPosRotMesh",a("ModifyPosRotMesh")(o=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).msr=null,e.transPos=[0,0,0,0],e._transPos="a_transPos",e.transRot=[0,0,0,0],e._transRot="a_transRot",e}e(i,t);var s=i.prototype;return s.onLoad=function(){this.msr=this.node.getComponent(n),this.msr.mesh&&(delete this.msr.mesh.struct.maxPosition,delete this.msr.mesh.struct.minPosition),this.msr.shadowCastingMode=0},s.setData=function(){},s.setTransData=function(t,e,i){this.msr&&(this.transPos[0]=t.x,this.transPos[1]=t.y,this.transPos[2]=t.z,this.transPos[3]=i,this.transRot[0]=e.x,this.transRot[1]=e.y,this.transRot[2]=e.z,this.msr.setInstancedAttribute(this._transPos,this.transPos),this.msr.setInstancedAttribute(this._transRot,this.transRot))},i}(r))||o),i._RF.pop()}}})),System.register("chunks:///_virtual/Panels.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventTypes.ts","./BasicCollider.ts","./CollisionManager.ts","./BasicProp.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g,P,R,_,C,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Node,l=t.MeshRenderer,c=t.v4,u=t.v3,p=t.v2,f=t.Tween,m=t.tween,d=t.Vec3,y=t.Intersection2D},function(t){v=t.GlobalConfig},function(t){g=t.GlobalEnum},function(t){P=t.GlobalTmpData},function(t){R=t.EventTypes},function(t){_=t.BasicCollider},function(t){C=t.ColliderGroup},function(t){b=t.BasicProp}],execute:function(){var S,M,E,T,D,A,w,x,F,k,B,L,G;r._RF.push({},"b87a5V6XLxDZJ+FFTrrambX","Panels",void 0);var I=o.ccclass,z=o.property;t("Panels",(S=I("Panels"),M=z({type:a(g.TrapType)}),E=z(h),T=z(h),D=z(l),A=z(l),S((F=e((x=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).cldGroup=C.PlayerTrigger,s(e,"trapType",F,n(e)),e._panelId=0,e._isMove=!1,s(e,"red",k,n(e)),s(e,"blue",B,n(e)),s(e,"symbolMsr",L,n(e)),s(e,"labelMsr",G,n(e)),e.symbolType=void 0,e.symbolCfg={"+":g.IncreaseType.symbol_Add,"-":g.IncreaseType.symbol_Reduce,x:g.IncreaseType.symbol_Multip,"/":g.IncreaseType.symbol_Division},e.symbolUvZ={"+":0,"-":.25,x:.5,"/":.75},e.num=0,e.tmpV4=c(),e.pos=u(),e._isAnim=!1,e.tmpP=u(),e.isTriggerUsed=!1,e.checkRadius=v.Player.checkRadius,e.tmpP2=p(),e}i(e,t);var r=e.prototype;return r.onEvents=function(){this.on(R.CurLevelEvents.HideIncreaceProp,this.onHidePanel,this)},r.initSub=function(){this.initAnim(),this.initLabel()},r.setData=function(e){t.prototype.setData.call(this,e),this.initAnim(),this.setLabel(e),this._panelId=e.id,this._isMove=e.isMove},r.reset=function(){this.resetAnim(),this.resetLabel(),t.prototype.reset.call(this)},r.customUpdate=function(e){t.prototype.customUpdate.call(this,e),this.updateAnim(e)},r.initLabel=function(){},r.setLabel=function(t){this.blue.active="+"==t.symbol||"x"==t.symbol,this.red.active="-"==t.symbol||"/"==t.symbol,this.symbolType=this.symbolCfg[t.symbol],this.num=t.num;var e=this.symbolMsr.getMaterialInstance(0),i=e.passes[0].getHandle("tilingOffset");this.tmpV4.set(.25,1,this.symbolUvZ[t.symbol],0),e.passes[0].setUniform(i,this.tmpV4);var s,n,r=t.num.toFixed(0);s=+r[0],this.labelMsr[0].getMaterialInstance(0).setProperty("tilingOffset",c(.1,1,.1*s,0)),this.labelMsr[1].node.active=!1,r.length>1&&(this.labelMsr[1].node.active=!0,n=+r[1],this.labelMsr[1].getMaterialInstance(0).setProperty("tilingOffset",c(.1,1,.1*n,0)))},r.resetLabel=function(){},r.initAnim=function(){this._isAnim=!1,this.pos.set(this.node.position)},r.resetAnim=function(){this._isAnim=!1},r.updateAnim=function(t){},r.showMoveDownAnim=function(){var t=this;this._isAnim||(this._isAnim=!0,f.stopAllByTarget(this.pos),m(this.pos).to(.5,{y:-3},{onUpdate:function(){t.node&&t.node.setPosition(t.pos)}}).start())},r.setCollider=function(){this.pos.set(this.node.worldPosition),this.collider=new _(this.cldGroup,this,!0),this.tmpP.set(this.cldSize.width,0,this.cldSize.height),d.rotateY(this.tmpP,this.tmpP,d.ZERO,.01745*this.node.eulerAngles.y),this.cldSize.set(Math.abs(this.tmpP.x),Math.abs(this.tmpP.z)),this.collider.setRectSize(this.cldSize),this.collider.setRectPos(this.pos),this.collider.updateGridInfo(!0),this.collider.isCircleCollider=this.isCircleCollider},r.resetCollider=function(){t.prototype.resetCollider.call(this),this.isTriggerUsed=!1},r.checkCollistion=function(){!this.isTriggerUsed&&this.collider&&(this.tmpP.set(P.Player.wpos).add(P.Player.offset),this.tmpP2.set(this.tmpP.x,this.tmpP.z),y.rectCircle(this.collider.selfRect,this.tmpP2,this.checkRadius)&&this.onTriggerEnter())},r.onTriggerEnter=function(){this.isTriggerUsed||(this.isTriggerUsed=!0,this.showMoveDownAnim(),this.emit(R.RoleEvents.AddRoles,this.symbolType,this.num),this.emit(R.CurLevelEvents.HideIncreaceProp,this._panelId))},r.onHidePanel=function(t){t!=this._panelId||this.isTriggerUsed||(this.isTriggerUsed=!0,this.showMoveDownAnim())},e}(b)).prototype,"trapType",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return g.TrapType.Increase}}),k=e(x.prototype,"red",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(x.prototype,"blue",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(x.prototype,"symbolMsr",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(x.prototype,"labelMsr",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),w=x))||w)),r._RF.pop()}}})),System.register("chunks:///_virtual/PathBasic.ts",["cc","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventManager.ts","./EventTypes.ts","./GlobalPool.ts","./Tools.ts","./BasicCollider.ts","./CollisionManager.ts","./PropsLayer.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.MeshRenderer,n=t.v3,r=t.size,o=t.rect,a=t.quat},function(t){h=t.GlobalConfig,l=t.TrapCfg},function(t){c=t.GlobalEnum},function(t){u=t.GlobalTmpData},function(t){p=t.default},function(t){f=t.EventTypes},function(t){m=t.default},function(t){d=t.default},function(t){y=t.BasicCollider},function(t){v=t.ColliderGroup},function(t){g=t.PropsLayer}],execute:function(){var P;e._RF.push({},"3debcrZn+9KIZ7dl7bPkisu","PathBasic",void 0);var R=i.ccclass;i.property,t("PathBasic",R("PathBasic")(P=function(){function t(t,e,i,s){this.node=null,this.pathIndex=0,this.pathNode=null,this.decorate=null,this.enemy=null,this.bornPos=null,this.trigger=null,this.propPos=null,this.roadArr=[],this.turnArr=[],this.turnBArr=[],this.turnCArr=[],this.enemyData=null,this.propData=null,this.tmpP=n(),this.cldArr=[],this.cldVSize=r(.3,10),this.cldHSize=r(10,.3),this.cldBoxSize=r(10,10),this.tmpRect=o(),this.tmpQuat=a(),this.tmpR=n(),this.roadCw=4.625,this.isCreateEnemy=!1,this.curTriggerSize=n(1,1),this.isUsed=!1,this.node=e,this.enemyData=i,this.propData=s,this.pathIndex=t,this.pathNode=this.node.getChildByName("path"),this.decorate=this.node.getChildByName("decorate"),this.propPos=this.node.getChildByName("prop"),this.enemy=this.node.getChildByName("enemy"),this.bornPos=this.enemy.getChildByName("bornPos"),this.trigger=this.enemy.getChildByName("trigger");for(var h=0;h<this.node.children.length;h++){var l=this.node.children[h];switch(l.name){case"road":this.roadArr.push(l);break;case"turn":this.turnArr.push(l);break;case"turnB":this.turnBArr.push(l);break;case"turnC":this.turnCArr.push(l)}}}var e=t.prototype;return e.init=function(){},e.reset=function(){this.resetColliders(),d.clearObj(this)},e.update=function(t){this.checkTrigger()},e.getStopPos=function(t){t.set(this.pathNode.children[this.pathNode.children.length-1].worldPosition)},e.getMinMaxPos=function(t,e){for(var i=0;i<this.node.children.length;i++){var n=this.node.children[i];if(n.getComponent(s)){var r=n.worldPosition,o=r.x-12,a=r.x+12,h=r.z-12,l=r.z+12;t.x=Math.min(t.x,o),t.z=Math.min(t.z,h),e.x=Math.max(e.x,a),e.z=Math.max(e.z,l)}}},e.createColliders=function(){this.createDecrateCollider()},e.resetColliders=function(){for(var t=0;t<this.cldArr.length;t++){var e=this.cldArr[t];e&&(e.clearGridInfo(),e.removeFromManager())}this.cldArr=[]},e.createDecrateCollider=function(){for(var t=0;t<this.decorate.children.length;t++){var e=this.decorate.children[t];this.tmpP.set(e.worldPosition);var i=new y(v.Barrier,this,!1);i.setRectSize(this.cldBoxSize),i.setRectPos(this.tmpP),i.updateGridInfo(!0),this.showTestCld(this.tmpP,this.cldBoxSize)}},e.showTestCld=function(t,e){if(h.ShowDebugCld){var i=m.get("testCld");i.parent=this.node.parent,i.setPosition(t),i.setScale(e.x,.5,e.y)}},e.createTriggers=function(){if(this.isCreateEnemy=!!this.enemyData,this.isUsed=!1,this.isCreateEnemy&&h.ShowDebugCld){var t=m.get("testTrigger");t.setWorldPosition(this.trigger.worldPosition),t.setScale(this.curTriggerSize.x,2,this.curTriggerSize.y),t.parent=this.node.parent}},e.checkTrigger=function(){this.isCreateEnemy&&!this.isUsed&&(this.tmpP.set(u.Player.wpos).subtract(this.trigger.worldPosition),this.tmpP.lengthSqr()<2&&(this.createEnemys(),this.isUsed=!0))},e.createEnemys=function(){var t=this;if(!this.isUsed&&this.isCreateEnemy&&this.enemyData)for(var e=0;e<this.enemyData.length;e++)for(var i=this.enemyData[e].split(","),s=i[0],r=i[1],o=+i[2],a=+i[3],h=0;h<s.length;h++){var l=+s[h];if(this.bornPos.children[l])for(var c=function(e){var i=[];t.bornPos.children[l].children.forEach((function(t){i.push(n(t.worldPosition))}));var s=+r[e],h=Math.floor(Math.random()*(a-o)+o),c={type:s,count:h=h<0?0:h,initPathIndex:t.pathIndex,initPath:i};p.emit(f.EnemyEvents.CreateEnemys,c)},u=0;u<r.length;u++)c(u)}},e.createProps=function(){if(this.propData){var t=this.propData[0],e={p:this.propPos.worldPosition,r:this.propPos.worldRotation,d:void 0},i=9,s=0;switch(t){case c.PropType.Weapon:var r=this.propData[3].length,o=this.propData[3];s=i/(r+1);for(var a=g._weaponID++,h=0;h<r;h++)this.tmpP.set((h+1)*s-i/2),this.tmpP.transformMat4(this.propPos.worldMatrix),e.p.set(this.tmpP),e.d={weaponType:+o[h],weaponId:a},p.emit(f.CurLevelEvents.CreateProps,"WeaponProp",e);break;case c.PropType.Trap:var u=this.propData[1],m=l[u].perfab,d=this.propData[2]||1;e.d=this.propData[3],l[u].isMuilty||(d=1),s=(i=9)/(d+1);for(var y=0;y<d;y++)this.tmpP.set((y+1)*s-i/2),this.tmpP.transformMat4(this.propPos.worldMatrix),e.p.set(this.tmpP),p.emit(f.CurLevelEvents.CreateProps,m,e);break;case c.PropType.Increase:var v=g._IncreaceID++,P=this.propData[1],R=this.propData[2],_=!(0==this.propData[3]||P&&R),C=n(-2.25,0,0),b=n(2.25,0,0);P&&(C.transformMat4(this.node.worldMatrix),e.p.set(C),this.showIncreaceProp(P,_,v,e)),R&&(b.transformMat4(this.node.worldMatrix),e.p.set(b),this.showIncreaceProp(R,_,v,e))}}},e.showIncreaceProp=function(t,e,i,s){var n=t[0],r=t,o=+(r=r.slice(1,r.length));s.id=i,s.isMove=e,s.symbol=n,s.num=o,p.emit(f.CurLevelEvents.CreateProps,"Panels",s)},t}())||P),e._RF.pop()}}})),System.register("chunks:///_virtual/PistolBullet.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,n;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.Component}],execute:function(){var r;i._RF.push({},"7c4754EaIxFP7XH9d00H/N1","PistolBullet",void 0);var o=s.ccclass;s.property,t("PistolBullet",o("PistolBullet")(r=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var s=i.prototype;return s.start=function(){},s.update=function(t){},i}(n))||r),i._RF.pop()}}})),System.register("chunks:///_virtual/PropsLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventTypes.ts","./StorageSystem.ts","./GlobalPool.ts","./BasicLayer.ts","./BasicProp.ts","./Drone.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v2,r=t.v3,o=t.Vec3},function(t){a=t.GlobalConfig},function(t){h=t.GlobalEnum},function(t){l=t.GlobalTmpData},function(t){c=t.EventTypes},function(t){u=t.StorageSystem},function(t){p=t.default},function(t){f=t.BasicLayer},function(t){m=t.BasicProp},function(t){d=t.Drone}],execute:function(){var y,v;i._RF.push({},"1547dDOG1lDv6TzPL+VORX8","PropsLayer",void 0);var g=s.ccclass;s.property,t("PropsLayer",g("PropsLayer")(((v=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))||this)._allProps={},e.propSize=n(15,15),e._allDrones={},e._droneCount=0,e.tmpP=r(),e}e(i,t);var s=i.prototype;return s.init=function(){},s.onEvents=function(){this.on(c.CurLevelEvents.CreateProps,this.onCreateProps,this),this.on(c.CurLevelEvents.CreateDrones,this.onCreateDrones,this)},s.setData=function(t){i._IncreaceID=0,i._weaponID=0,this.setDrones()},s.reset=function(){this.resetProps(),this.resetDrones()},s.customUpdate=function(t){this.updateProps(t),this.updateDrones(t)},s.customLateUpdate=function(t){this.lateUpdateProps(t),this.lateUpdateDrones(t)},s.resetProps=function(){for(var t in this._allProps)this._allProps[t].reset();this._allProps={}},s.createProp=function(t,e){e.parent=this.node;var i=p.get(t,e),s=i.getComponent(m);this._allProps[i.uuid]=s},s.updateProps=function(t){var e=l.Player.wpos,i=.5*this.propSize.x+.5*a.RunPropSize.x,s=.5*this.propSize.y+.5*a.RunPropSize.y;for(var n in this._allProps){var r=this._allProps[n];r&&r.node.active?Math.abs(e.x-r.node.worldPosition.x)<=i&&Math.abs(e.z-r.node.worldPosition.z)<=s?(r.show(),r.customUpdate(t)):r.hide():delete this._allProps[n]}},s.lateUpdateProps=function(t){for(var e in this._allProps){var i=this._allProps[e];i&&i.node.active?i.customLateUpdate(t):delete this._allProps[e]}},s.setDrones=function(){u.getData().userAssets.unlockGoods.indexOf(h.WeaponType.Drone)>=0&&this.createDrone()},s.resetDrones=function(){for(var t in this._allDrones)this._allDrones[t].reset();this._allDrones={},this._droneCount=0},s.createDrone=function(){var t=p.get("Drone");t.parent=this.node,t.setPosition(o.ZERO),t.eulerAngles=o.ZERO;var e=new d(t);e.init(),this._allDrones[t.uuid]=e,this._droneCount++;var i=10/(this._droneCount+1),s=0;for(var n in this._allDrones)this._allDrones[n].offsetX=(s+1)*i-5,s++;1==this._droneCount&&(e.offsetX=-3)},s.updateDrones=function(t){for(var e in this._allDrones){var i=this._allDrones[e];i&&i.node.active?i.customUpdate(t):delete this._allDrones[e]}},s.lateUpdateDrones=function(t){},s.onCreateProps=function(t,e){this.createProp(t,e)},s.onCreateDrones=function(){this.createDrone()},i}(f))._IncreaceID=0,v._weaponID=0,y=v))||y),i._RF.pop()}}})),System.register("chunks:///_virtual/RoadLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalClass.ts","./GlobalConfig.ts","./GlobalTmpData.ts","./EventTypes.ts","./GlobalPool.ts","./BasicLayer.ts","./PathBasic.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v3,r=t.quat,o=t.Vec3,a=t.v2},function(t){h=t.PathInfo},function(t){l=t.GlobalConfig},function(t){c=t.GlobalTmpData},function(t){u=t.EventTypes},function(t){p=t.default},function(t){f=t.BasicLayer},function(t){m=t.PathBasic}],execute:function(){var d;i._RF.push({},"88e6bjOBWRIyoH2b4JSnTlc","RoadLayer",void 0);var y=s.ccclass;s.property,t("RoadLayer",y("RoadLayer")(d=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).tmpP=n(),e.tmpR=n(),e.allPathRec=null,e.allBuilding=null,e.buildingSize=a(12,12),e._normalBuiding=["Decorate_A","Decorate_B","Decorate_C"],e._turnBuiding="Decorate_Turning",e}e(i,t);var s=i.prototype;return s.init=function(){},s.onEvents=function(){},s.setData=function(t){this.setPath(t)},s.reset=function(){this.resetPath()},s.customUpdate=function(t){this.updatePath(t)},s.customLateUpdate=function(t){},s.setPath=function(t){this.allPathRec=[],this.allBuilding=[],c.PathInfo=[];for(var e=n(999999,0,999999),i=n(-999999,0,-999999),s=n(),a=0;a<t.path.length;a++){var l=t.path[a],f=p.get(l);f.parent=this.node,f.setWorldPosition(s);var d=new m(a,f,t.enemy[a],t.prop[a]);d.init(),d.getStopPos(s),this.allPathRec.push(d);var y=new h;y.n=l,y.p.set(f.worldPosition);for(var v=0;v<d.pathNode.children.length;v++){var g=d.pathNode.children[v];y.path.push(n(g.worldPosition))}c.PathInfo.push(y);for(var P=0;P<d.decorate.children.length;P++){var R=d.decorate.children[P];this.allBuilding.push({pos:n(R.worldPosition),rot:r(R.worldRotation),name:R.name,node:null})}d.getMinMaxPos(e,i)}o.subtract(c.MapSize,i,e),o.round(c.MapSize,c.MapSize),this.emit(u.GridMapEvents.CreateMapData,c.MapSize),console.log("# mapSize:",c.MapSize);for(var _=0;_<this.allPathRec.length;_++){var C=this.allPathRec[_];C.createColliders(),C.createTriggers(),C.createProps()}},s.resetPath=function(){for(var t=0;t<this.allPathRec.length;t++)this.allPathRec[t].reset();this.allPathRec=null;for(var e=0;e<this.allBuilding.length;e++){var i=this.allBuilding[e];i.pos=null,i.node=null}this.allBuilding=null},s.updatePath=function(t){for(var e=0;e<this.allPathRec.length;e++){var i=this.allPathRec[e];i&&i.update(t)}this.showBuilding()},s.showBuilding=function(){for(var t=c.Player.wpos,e=.5*this.buildingSize.x+.5*l.VisibleSize.x,i=.5*this.buildingSize.y+.5*l.VisibleSize.y,s=0;s<this.allBuilding.length;s++){var n=this.allBuilding[s];if(Math.abs(t.x-n.pos.x)<=e&&Math.abs(t.z-n.pos.z)<=i){if(!n.node){var r=void 0;switch(n.name){case"Decorate":r=this._normalBuiding[Math.floor(Math.random()*this._normalBuiding.length)];break;case"Decorate_Turning":r=this._turnBuiding}n.node=p.get(r),n.node.parent=this.node,n.node.setWorldPosition(n.pos),n.node.setWorldRotation(n.rot)}}else p.put(n.node),n.node=null}},i}(f))||d),i._RF.pop()}}})),System.register("chunks:///_virtual/Rocket.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./EventTypes.ts","./AudioEnum.ts","./AudioSystem.ts","./GlobalPool.ts","./CollisionManager.ts","./BasicProp.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Node,l=t.v3,c=t.size},function(t){u=t.TrapCfg},function(t){p=t.GlobalEnum},function(t){f=t.EventTypes},function(t){m=t.AudioEnum},function(t){d=t.AudioSystem},function(t){y=t.default},function(t){v=t.CollisionManager},function(t){g=t.BasicProp}],execute:function(){var P,R,_,C,b,S,M,E;r._RF.push({},"e363endlshO/JDE9YxdSaBu","Rocket",void 0);var T=o.ccclass,D=o.property;t("Rocket",(P=T("Rocket"),R=D({type:a(p.TrapType)}),_=D(h),P((S=e((b=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"trapType",S,n(e)),s(e,"rocket",M,n(e)),e.initRoketPos=l(),e._roketPos=l(),e._lineVec=l(),e._isRun=!1,e._g=-10,e.tmpP=l(),e.smookData={p:l()},s(e,"boomSize",E,n(e)),e.isTriggerUsed=!1,e}i(e,t);var r=e.prototype;return r.initSub=function(){this.initAnim()},r.setData=function(e){t.prototype.setData.call(this,e)},r.reset=function(){this.resetAnim(),this.resetCollider()},r.customUpdate=function(t){this.updateCollider(t),this.updateAnim(t)},r.customLateUpdate=function(t){this.lateUpdateCollider(t)},r.initAnim=function(){this.rocket.active=!1,this.initRoketPos.set(0,10,0)},r.showAnim=function(){this.rocket.active=!0,this._lineVec.set(0,-10,0),this._roketPos.set(this.initRoketPos),this.rocket.setPosition(this._roketPos),this._isRun=!0},r.resetAnim=function(){this.rocket.active=!1,this._isRun=!1,this.rocket.setPosition(this.initRoketPos)},r.updateAnim=function(t){this._isRun&&(this._lineVec.y+=this._g*t,this.tmpP.set(this._lineVec).multiplyScalar(t),this._roketPos.add(this.tmpP),this.rocket.setPosition(this._roketPos),this.smookData.p.set(this.rocket.children[0].worldPosition),this.emit(f.EffectEvents.showMergeEffect,p.MergeEffectType.MergeRocketSmook,this.smookData),this._roketPos.y<0&&(this._isRun=!1,this.emit(f.EffectEvents.show3DTo2DEffect,{t:p.Effect3dType.Effect_jz_rocketboom,p:this.pos}),this.checkCollistion(),d.playEffect(m.boom),y.put(this.node)))},r.resetCollider=function(){this.isTriggerUsed=!1,t.prototype.resetCollider.call(this)},r.checkTrigger=function(){this.isTriggerUsed||this.collider&&this.collider.checkPosFast(this.pos,this.onTriggerEnter.bind(this))},r.checkCollistion=function(){this.collider&&(this.collider.setRectSize(this.boomSize),this.collider.checkPosCollistion(this.pos,this.onCheckColliderCb.bind(this)))},r.updateCollider=function(t){this.checkTrigger()},r.onTriggerEnter=function(){this.isTriggerUsed=!0,this.showAnim()},r.onCheckColliderCb=function(t){var e=u[this.trapType];for(var i in t)for(var s=t[i],n=0;n<s.length;n++){var r=s[n],o=v.getColilderByColId(r).targetCmp;o&&o.byHit(e.atk)}},e}(g)).prototype,"trapType",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return p.TrapType.Spininess}}),M=e(b.prototype,"rocket",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(b.prototype,"boomSize",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return c()}}),C=b))||C)),r._RF.pop()}}})),System.register("chunks:///_virtual/Role.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventManager.ts","./EventTypes.ts","./Tools.ts","./BasicModifyMesh.ts","./BasicCollider.ts","./CollisionManager.ts","./BasicRole.ts","./RoleAnim.ts","./RoleHand.ts","./RoleStates.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g,P,R,_,C,b,S,M,E,T;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.size,r=t.Vec3,o=t.v3},function(t){a=t.GlobalConfig,h=t.WeaponCfg},function(t){l=t.GlobalEnum},function(t){c=t.GlobalTmpData},function(t){u=t.default},function(t){p=t.EventTypes},function(t){f=t.default},function(t){m=t.BasicModifyMesh},function(t){d=t.BasicCollider},function(t){y=t.ColliderGroup,v=t.CollisionManager},function(t){g=t.BasicRole},function(t){P=t.RoleAnim},function(t){R=t.RoleHand},function(t){_=t.RoleStateType,C=t.RoleIdleState,b=t.RoleMoveState,S=t.RolePassState,M=t.RoleDeathState,E=t.RoleStandShootState,T=t.RoleWinState}],execute:function(){var D;i._RF.push({},"35d46EUJ/5A0p4Fm4Jgd75+","Role",void 0);var A=s.ccclass;s.property,t("Role",A("Role")(D=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).node=null,e.roleAnim=null,e.roleHand=null,e.modfiyMsCmp=null,e.offset=o(),e.followPos=c.Player.wpos,e.centerPos=o(),e.curPos=o(),e.pathLineVec=null,e.lineVec=o(),e.hp=0,e.moveSpd=0,e.atkRate=1,e.curWeapon=0,e.curScale=1,e.isGiant=!1,e.curGiantLv=1,e._shadowData={pos:null,scale:1,isShow:!0},e.tmpP=o(),e.tmpV=o(),e.stepP=o(),e._rotVec=o(),e._toRadianY=0,e._curRadianY=0,e._rotDirec=1,e._rotSpd=2*Math.PI,e.tmpR=o(),e.transData=[0,0,0,0],e.collider=null,e._checkRes={},e._colGroup=[y.Enemy],e.atkData={pos:o(),rot:o(),lineVec:o(),rotSpd:o(),atkRate:1},e.shotBulletRot=[-3,0,3],e.isStand=!1,e._stateRecs={},e._curState=null,e._preState=null,e}e(i,t);var s=i.prototype;return s.init=function(t,e,i,s,n){this.isGiant=n,this.node=t,this.modfiyMsCmp=this.node.getComponent(m),this.modfiyMsCmp.setData(),this.offset.set(i),this.pathLineVec=s,this.centerPos.set(e),this.curPos.set(e),this.roleAnim=new P(this.node),this.roleAnim.init(this),this.initProp(),this.roleHand=this.node.getComponent(R),this.roleHand.init(this.node.parent,this.curPos,this._rotVec,this.curScale),this.roleHand.setWeapon(this.curWeapon),this.initMoveData(),this.setStateData(),this.setCollider(),this.initShadow()},s.reset=function(){this.roleAnim.reset(),this.resetState(),this.resetCollider(),this.roleHand.reset(),this.resetShadow(),f.clearObj(this)},s.update=function(t){this.roleHand,this.roleHand.updateAnim(t),this.updateTransData(t),this.updateState(t),this.updateCollider(t)},s.lateUpdate=function(t){this.lateUpdateCollider(t)},s.initProp=function(){var t=a.Player;this.hp=this.isGiant?t.giantHp:t.hp,this.curScale=this.isGiant?t.giantScale:t.scale,this.atkRate=this.isGiant?t.giantAtkRate:t.atkRate},s.setGiantLv=function(t){this.isGiant&&(this.curGiantLv=t)},s.initShadow=function(){this._shadowData.pos=this.curPos,this._shadowData.isShow=!0,this._shadowData.scale=this.curScale,u.emit(p.EffectEvents.showMergeEffect,l.MergeEffectType.MergeShadow,this._shadowData)},s.resetShadow=function(){this._shadowData.isShow=!1},s.setWeapon=function(t){this.curWeapon!=t&&(this.roleHand.setWeapon(t),this.curWeapon=t,c.Game.isGameRun&&this.playAtkAnim(this.isStand,!0))},s.initMoveData=function(){this.moveSpd=a.Player.moveSpd,this._curRadianY=Math.PI,this._toRadianY=this._curRadianY,this._rotVec.set(0,this._curRadianY,0),this.modfiyMsCmp.setTransData(this.curPos,this._curRadianY,this.curScale)},s.setOffset=function(t){this.offset.set(t)},s.move=function(t){this.tmpP.set(this.centerPos).subtract(this.followPos),this.tmpV.set(this.offset).subtract(this.tmpP),this.tmpV.multiplyScalar(5),this.lineVec.set(this.pathLineVec).add(this.tmpV),this.stepP.set(this.lineVec).multiplyScalar(t),this.centerPos.add(this.stepP),this.tmpP.set(this.centerPos).add(c.Player.offset),this.stepP.set(this.tmpP).subtract(this.curPos),this.checkMove(this.curPos,this.stepP,this.curPos)},s.rotation=function(t){var e=Math.atan2(-this.lineVec.z,this.lineVec.x)+1.57+3.14;if(this.calRotation(e),this._curRadianY!==this._toRadianY){var i=this._rotSpd*t;i>Math.abs(this._curRadianY-this._toRadianY)?this._curRadianY=this._toRadianY:(i*=this._rotDirec,this._curRadianY+=i),this._rotVec.set(0,this._curRadianY,0)}},s.updateTransData=function(t){this.modfiyMsCmp.setTransData(this.curPos,this._curRadianY,this.curScale),this.modfiyMsCmp.updateColor(t)},s.calRotation=function(t){this._toRadianY=t%6.28;var e=Math.PI;this._toRadianY<0&&(this._toRadianY+=2*e),this._curRadianY=this._curRadianY%(2*e),this._curRadianY>2*e?this._toRadianY-=2*e:this._curRadianY<0&&(this._toRadianY+=2*e);var i=this._toRadianY-this._curRadianY;i>e?(this._curRadianY+=2*e,this._rotDirec=-1):i<-e?(this._toRadianY+=2*e,this._rotDirec=1):i>0?this._rotDirec=1:i<0&&(this._rotDirec=-1)},s.setCollider=function(){var t=a.Player.cldRadius;this.collider=new d(y.Player,this,!1),this.collider.setRectSize(n(t,t)),this.collider.setRectPos(this.curPos),this.collider.updateGridInfo(!0),this.collider.isCircleCollider=!0},s.resetCollider=function(){this.collider&&(this.collider.clearGridInfo(),this.collider.removeFromManager(),this.collider=null)},s.checkMove=function(t,e,i){this.collider&&this.collider.checkMoveCollision(t,e,i)},s.checkCollsion=function(){this.collider&&this.collider.checkPosByGroup(this.curPos,this._colGroup,this.onCheckColliderCb.bind(this))},s.onCheckColliderCb=function(t){var e=0;for(var i in t){var s=t[i];switch(+i){case y.Enemy:for(var n=0;n<s.length;n++){var r=s[n],o=v.getColilderByColId(r).targetCmp;if(o&&o.hp>0){e=o.atk,o.byHit(o.hp),this.byHit(e);break}}}}},s.updateCollider=function(t){this.checkCollsion()},s.lateUpdateCollider=function(t){this.collider&&this.collider.lateUpdate(t)},s.onAtk=function(){var t=h[this.curWeapon],e=this._rotVec.y-1.57;switch(this.curWeapon){case l.WeaponType.Shotgun:for(var i=0;i<this.shotBulletRot.length;i++){var s=.01745*this.shotBulletRot[i];this.tmpV.set(1,0,0),r.rotateY(this.tmpV,this.tmpV,r.ZERO,e+s),this.tmpV.multiplyScalar(t.bulletSpd),this.tmpP.set(this.curPos).add3f(0,.5,0),this.atkData.pos.set(this.tmpP),this.atkData.lineVec.set(this.tmpV),this.atkData.rotSpd.set(r.ZERO),this.atkData.atkRate=this.atkRate,u.emit(p.EffectEvents.showMergeEffect,t.bullet,this.atkData)}break;case l.WeaponType.Grenades:this.tmpV.set(1,0,0),r.rotateY(this.tmpV,this.tmpV,r.ZERO,e),this.tmpV.multiplyScalar(t.bulletSpd),this.tmpP.set(this.curPos).add3f(0,.5,0),this.atkData.pos.set(this.tmpP),this.atkData.lineVec.set(this.tmpV),this.atkData.rotSpd.set(r.ZERO),this.atkData.atkRate=this.atkRate,u.emit(p.EffectEvents.showObjs,l.ThrowBullets.grenadesThrow,this.atkData);break;default:this.tmpV.set(1,0,0),r.rotateY(this.tmpV,this.tmpV,r.ZERO,e),this.tmpV.multiplyScalar(t.bulletSpd),this.tmpP.set(this.curPos).add3f(0,.5,0),this.atkData.pos.set(this.tmpP),this.atkData.lineVec.set(this.tmpV),this.atkData.rotSpd.set(r.ZERO),this.atkData.atkRate=this.atkRate,u.emit(p.EffectEvents.showMergeEffect,t.bullet,this.atkData)}},s.byHit=function(t){this.hp<=0||(this.modfiyMsCmp.byHit(),this.hp-=t,this.hp<=0&&(this.hp=0,this.resetCollider(),this.changeState(_.Death)))},s.playAtkAnim=function(t,e){void 0===e&&(e=!0),this.isStand=t;var i=t?l.PlayerClip.standShoot:l.PlayerClip.shootBack;i=t?this.curWeapon==l.WeaponType.Grenades?l.PlayerClip.throwStand:l.PlayerClip.standShoot:this.curWeapon==l.WeaponType.Grenades?l.PlayerClip.throwBack:l.PlayerClip.shootBack;var s=h[this.curWeapon].atkSpd;this.roleAnim.playAnim(i,!0,e,s)},s.setStateData=function(){this._stateRecs[_.Idle]=new C(this),this._stateRecs[_.Move]=new b(this),this._stateRecs[_.Pass]=new S(this),this._stateRecs[_.Death]=new M(this),this._stateRecs[_.StandShoot]=new E(this),this._stateRecs[_.Win]=new T(this),this.changeState(c.Game.isGameRun?_.Move:_.Idle),setTimeout((function(){}),0)},s.resetState=function(){for(var t in this._stateRecs)this._stateRecs[t].offEvents(),this._stateRecs[t].reset();this._stateRecs={},this._curState=null,this._preState=null},s.changeState=function(t,e,i){void 0===i&&(i=!1),(this._curState!==t||i)&&(this._stateRecs[this._curState]&&this._stateRecs[this._curState].exit(),this._stateRecs[t]&&(this._preState=this._curState,this._curState=t,this._stateRecs[this._curState].enter(e)))},s.updateState=function(t){this._stateRecs[this._curState]&&this._stateRecs[this._curState].update(t)},i}(g))||D),i._RF.pop()}}})),System.register("chunks:///_virtual/RoleAnim.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalTmpData.ts","./Tools.ts","./BasicSkeleAnim.ts"],(function(t){var e,i,s,n,r,o;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator},function(t){n=t.GlobalTmpData},function(t){r=t.default},function(t){o=t.BasicSkeleAnim}],execute:function(){var a;i._RF.push({},"d196cKbk95GWbYsu/zZRUyd","RoleAnim",void 0);var h=s.ccclass;s.property,t("RoleAnim",h("RoleAnim")(a=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).role=null,e}e(i,t);var s=i.prototype;return s.onEvents=function(){this.anim.onAtk=this.onAtk.bind(this)},s.offEvents=function(){this.anim.onAtk=null},s.init=function(e){t.prototype.init.call(this),this.role=e},s.reset=function(){t.prototype.reset.call(this),r.clearObj(this)},s.onAtk=function(){n.Game.isPause||this.role.onAtk()},i}(o))||a),i._RF.pop()}}})),System.register("chunks:///_virtual/RoleGiant.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./StorageSystem.ts","./BasicModifyMesh.ts","./Role.ts"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.Vec3},function(t){r=t.GlobalConfig},function(t){o=t.StorageSystem},function(t){a=t.BasicModifyMesh},function(t){h=t.Role}],execute:function(){var l;i._RF.push({},"9c1f4KgFY5AFZZ0V4dkyTxH","RoleGiant",void 0);var c=s.ccclass;s.property,t("RoleGiant",c("RoleGiant")(l=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).shieldModifyCmp=null,e.modfiyMsCmp=null,e}e(i,t);var s=i.prototype;return s.init=function(e,i,s,n,r){t.prototype.init.call(this,e,i,s,n,r),this.shieldModifyCmp=this.node.getChildByName("shield").getComponent(a),this.shieldModifyCmp.setData()},s.setGiantLv=function(t){if(this.isGiant){this.curGiantLv=t,this.modfiyMsCmp.msrC.node.active=!0,this.modfiyMsCmp.msrB.node.active=!1,2==this.curGiantLv&&(this.modfiyMsCmp.msrB.node.active=!0),this.modfiyMsCmp.msrA.node.active=!1,this.shieldModifyCmp.node.active=!1,3==this.curGiantLv&&(this.modfiyMsCmp.msrA.node.active=!0,this.shieldModifyCmp.node.active=!0);var e=o.getData().levelAssets.curLv,i=Math.round(100*e/10)/100+1,s=r.Player;this.hp=s.giantHp*i,this.atkRate=s.giantAtkRate*i}},s.updateTransData=function(e){t.prototype.updateTransData.call(this,e),this.shieldModifyCmp&&this.shieldModifyCmp.node.active&&(this.tmpP.set(this.shieldModifyCmp.node.position).multiplyScalar(this.curScale),n.rotateY(this.tmpP,this.tmpP,n.ZERO,this._curRadianY),this.tmpP.add(this.curPos),this.shieldModifyCmp.setTransData(this.tmpP,this._curRadianY,this.curScale),this.shieldModifyCmp.updateColor(e))},i}(h))||l),i._RF.pop()}}})),System.register("chunks:///_virtual/RoleHand.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalPool.ts","./ModifyPosRotMesh.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Node,h=t.v3,l=t.quat,c=t.Tween,u=t.Vec3,p=t.tween,f=t.Component},function(t){m=t.WeaponCfg},function(t){d=t.default},function(t){y=t.ModifyPosRotMesh}],execute:function(){var v,g,P,R,_;r._RF.push({},"392b793xh5PkZRIXhMHN8E/","RoleHand",void 0);var C=o.ccclass,b=o.property,S=(t("RoleHand",(v=C("RoleHand"),g=b(a),v((_=e((R=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,s(e,"hand",_,n(e)),e._parent=null,e.curWeapon=null,e.curType=null,e.weaponMsr=null,e.followPos=null,e.followRot=null,e.roleScale=1,e._scaleAnim=h(),e.tmpR=h(),e.tmpR2=h(),e.tmpP=h(),e.tmpP2=h(),e.tmpQ=l(),e}i(e,t);var r=e.prototype;return r.init=function(t,e,i,s){this._parent=t,this.followPos=e,this.followRot=i,this.roleScale=s},r.reset=function(){d.put(this.curWeapon),c.stopAllByTarget(this._scaleAnim),this.curType=null,this.weaponMsr=null,this.curWeapon=null,this.followPos=null,this.followRot=null},r.setWeapon=function(t){if(this.curType!=t){var e=m[t].perfab;d.put(this.curWeapon),this.curWeapon=d.get(e),this.curWeapon.setPosition(u.ZERO),this.curWeapon.eulerAngles=u.ZERO,this.curWeapon.parent=this._parent,this.weaponMsr=this.curWeapon.getComponent(y),this.curType=t,this.showAnim(),this.setWeaponData();var i=this.hand.children[0];i||((i=new a).parent=this.hand);var s=S[m[this.curType].perfab];i.setPosition(s.p),i.eulerAngles=s.r,i.setScale(s.s,s.s,s.s)}},r.showAnim=function(){c.stopAllByTarget(this._scaleAnim),this._scaleAnim.set(0,0,0),p(this._scaleAnim).to(.2,{x:1},{easing:"backOut"}).start()},r.updateAnim=function(t){this.setWeaponData()},r.setWeaponData=function(){if(this.weaponMsr&&this.followPos){var t=S[m[this.curType].perfab];this.hand.children[0]&&(this.tmpP.set(this.hand.children[0].worldPosition),u.rotateY(this.tmpP,this.tmpP,u.ZERO,this.followRot.y),this.tmpP.add(this.followPos),this.tmpQ.set(this.hand.children[0].worldRotation),this.tmpQ.getEulerAngles(this.tmpR),this.tmpR.add(t.r),this.tmpR.multiplyScalar(.01745),this.tmpR.y+=this.followRot.y),this.weaponMsr.setTransData(this.tmpP,this.tmpR,t.s*this.roleScale*this._scaleAnim.x)}},e}(f)).prototype,"hand",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=R))||P)),t("RoleHandCfg",{Pistol:{p:h(.06,.214,-.01),r:h(-70.233,-97.281,30.254),s:1.5},Shotgun:{p:h(.06,.214,-.01),r:h(-70.233,-97.281,30.254),s:1.2},FireGun:{p:h(.003,.378,-.131),r:h(-70.233,-97.281,30.254),s:1.2},MachineGun:{p:h(.06,.214,-.01),r:h(-70.233,-97.281,30.254),s:1.2},Grenades:{p:h(.066,.132,.129),r:h(-70.233,-97.281,30.254),s:1}}));r._RF.pop()}}})),System.register("chunks:///_virtual/RoleLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventTypes.ts","./AudioEnum.ts","./AudioSystem.ts","./StorageSystem.ts","./UIEnum.ts","./UISystem.ts","./GlobalPool.ts","./BasicLayer.ts","./HorizonTouch.ts","./Enemy.ts","./EnemyBomb.ts","./Role.ts","./RoleGiant.ts","./RoleStates.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g,P,R,_,C,b,S;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v3,r=t.clamp,o=t.Vec3},function(t){a=t.GlobalConfig,h=t.WeaponCfg},function(t){l=t.GlobalEnum},function(t){c=t.GlobalTmpData},function(t){u=t.EventTypes},function(t){p=t.AudioEnum},function(t){f=t.AudioSystem},function(t){m=t.StorageSystem},function(t){d=t.UIEnum},function(t){y=t.UISystem},function(t){v=t.default},function(t){g=t.BasicLayer},function(t){P=t.HorizonTouch},function(t){R=t.Enemy},function(t){_=t.EnemyBomb},function(t){C=t.Role},function(t){b=t.RoleGiant},function(t){S=t.RoleStateType}],execute:function(){var M;i._RF.push({},"70845iMlIdKoJmuI8GeWlDZ","RoleLayer",void 0);var E=s.ccclass;s.property,t("RoleLayer",E("RoleLayer")(M=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).touchObj=null,e.pathWidth=.5*a.RoadWidth,e.followPos=c.Player.wpos,e.pathLineVec=n(),e.pathIndex=0,e.pathSubIndex=0,e.isRotPath=!1,e.isPathEnd=!1,e.isEndMark=!1,e.tmpP=n(),e.tmpO=n(),e.tmpV=n(),e.tmpC=n(),e.cameraPos=n(0,0,0),e.homeCameraPos=n(0,0,12),e.cameraRot=n(-45,0,0),e.initCameraRot=n(-45,0,0),e.homeCameraRot=n(-30,0,0),e.cameraOffset=n(0,18,18),e.homeCameraOffset=n(0,10,10),e.curCameraOffset=n(),e.cameraAddOffset=n(),e.cameraTurnOffset=n(),e.cameraEndOffset=n(),e.tmpR=n(),e.curRot=n(),e.isCloseCamera=!1,e.allRoles={},e.roleSumCount=0,e.normalRoleNum=0,e.curWeapon=l.WeaponType.Pistol,e.isRoleAllStand=!1,e._offsetCd=1,e._curOffsetTime=0,e._isOffsetReady=!1,e.allEnemys={},e.delayCreateRecs=[],e.isEnemyAllDeath=!1,e.tmpPrePre=n(),e.tmpPre=n(),e.tmpNex=n(),e.lerp0=n(),e.lerp1=n(),e.lerp2=n(),e.hasDelayCreate=!1,e.delayCurt=0,e.delayCd=.016,e.delayCreateNum=1,e._prefabRecs={},e._preMaxCfg={player:50,enemyNormal:100,enemyGiant:100,enemyBomb:100,enemyNinja:100,enemyBoss:100},e.createCurt=0,e.createCd=.05,e.symbolArr=["+","-","x","/"],e._audioCdMin=.1,e._curAudioCd=0,e._audioTime=0,e.intervalId=null,e.tmpData={p:n(),s:1},e}e(i,t);var s=i.prototype;return s.init=function(){this.initTouch()},s.onEvents=function(){this.on(u.GameEvents.GameRun,this.onGameRun,this),this.on(u.EnemyEvents.CreateEnemys,this.onCreateEnemys,this),this.on(u.RoleEvents.SetWeapon,this.onSetWeapon,this),this.on(u.RoleEvents.Death,this.onRoleDeath,this),this.on(u.RoleEvents.AddRoles,this.onAddRoles,this),this.on(u.RoleEvents.LvupGaint,this.onLvupGaint,this),this.on(u.CurLevelEvents.ShowHomeCamera,this.onShowHomeCamera,this),this.on(u.RoleEvents.Resurgence,this.onResurgence,this),this.on(u.RoleEvents.CanceResurgence,this.onCanceResurgence,this)},s.setData=function(t){this.setRoles(t),this.setEnemys(t),this.setRoleCenter(t),this.setCameraPos(),this.setPreCreateData(t)},s.reset=function(){this.resetRoles(),this.resetEnemys(),this.resetTouch(),this.resetRoleCenter(),this.resetCameraPos(),this.resetWinEffects()},s.customUpdate=function(t){this.updateTouch(t),this.updateRoleCenter(t),this.updateRoles(t),this.updateEnemys(t),this.updateCameraPos(t),this.updateCreateData(t),this.updateAudio(t)},s.customLateUpdate=function(t){this.lateUpdateRoles(t),this.lateUpdateEnemys(t)},s.initTouch=function(){this.touchObj=new P(n(),-this.pathWidth,this.pathWidth)},s.resetTouch=function(){this.touchObj.reset()},s.updateTouch=function(t){if(c.Game.isGameRun){this.touchObj.update(t);var e=c.Player.formation;this.touchObj.fitMaxX=this.pathWidth-r(e.maxX,0,this.pathWidth),this.touchObj.fitMinX=-this.pathWidth-r(e.minX,-this.pathWidth,0)}},s.setRoleCenter=function(t){this.pathIndex=0,this.pathSubIndex=0},s.resetRoleCenter=function(){this.isPathEnd=!1,this.isEndMark=!1,this.isRotPath=!1,this.pathLineVec.set(0,0,0),this.followPos.set(0,0,0),c.Player.wrotY=0,c.Player.offset=n(),c.Player.lineVec.set(0)},s.updateRoleCenter=function(t){this.calPathLineVec(),this.checkEndMark(),this.moveFollowPos(t)},s.calPathLineVec=function(){if(!this.isPathEnd){var t=c.PathInfo[this.pathIndex];if(!t||0==t.path.length)return this.pathFinished(),void(this.isPathEnd=!0);var e=t.path[this.pathSubIndex],i=r(0,this.pathSubIndex+1,t.path.length-1),s=t.path[i],n=this.tmpP.set(e).subtract(s).lengthSqr();if(this.tmpP.set(this.followPos).subtract(e),this.tmpP.lengthSqr()>=n){if(this.pathSubIndex++,this.pathSubIndex>=t.path.length-1&&(this.pathIndex++,this.pathSubIndex=0,t=c.PathInfo[this.pathIndex],console.log("# path : ",this.pathIndex)),!t||0==t.path.length)return this.pathFinished(),this.isPathEnd=!0,void console.log("Path End");e=t.path[this.pathSubIndex],i=r(0,this.pathSubIndex+1,t.path.length-1),s=t.path[i]}if(Math.abs(e.x-s.x)>.01&&Math.abs(e.z-s.z)>.01){var h=r(this.pathSubIndex-1,0,t.path.length-1),l=1.5705;t.path[h].x==e.x?(this.tmpC.set(s.x,0,e.z),l*=e.x<s.x?-1:1):(this.tmpC.set(e.x,0,s.z),l*=e.x>s.x?-1:1),this.tmpV.set(this.tmpC).subtract(this.followPos).normalize(),o.rotateY(this.tmpV,this.tmpV,o.ZERO,l),this.pathLineVec.set(this.tmpV).multiplyScalar(a.Player.moveSpd),this.isRotPath=!0}else this.isRotPath=!1,this.pathLineVec.set(s).subtract(e).normalize().multiplyScalar(a.Player.moveSpd);c.Player.lineVec.set(this.pathLineVec)}},s.checkEndMark=function(){if(!this.isEndMark){var t=c.PathInfo,e=c.Player;if(this.pathIndex>=t.length-1&&e.endMarkPos.z<=e.formation.maxZ+e.wpos.z){this.isEndMark=!0;var i={num:Object.keys(this.allRoles).length,outPaths:[],outFormation:[]};this.emit(u.CurLevelEvents.GetEndPathInfo,i);var s=0;for(var r in this.allRoles){var o=this.allRoles[r];o&&o.node.active&&o.hp>0&&function(){var t=[];t.push(n(o.curPos)),i.outPaths.forEach((function(e){t.push(n(e))})),t.push(n(i.outFormation[s])),o.changeState(S.Pass,{endPath:t,endRecIndex:s}),c.endFormationRec[s]={p:i.outFormation[s],role:o},s++}()}}}},s.pathFinished=function(){this.isPathEnd},s.moveFollowPos=function(t){this.isPathEnd||(t*=c.Game.isGameRun?1:0,this.tmpP.set(this.pathLineVec).multiplyScalar(t),this.followPos.add(this.tmpP),this.isPathEnd||(c.Player.wrotY=Math.atan2(-this.pathLineVec.z,this.pathLineVec.x),o.rotateY(this.tmpV,this.pathLineVec,o.ZERO,1.5703),this.tmpV.normalize().multiplyScalar(this.touchObj.ctrlPos.x),c.Player.offset.set(this.tmpV)))},s.setCameraPos=function(){this.isCloseCamera=!1,a.ShowDebugCamera?(this.cameraPos.x=this.followPos.x,this.cameraPos.z=this.followPos.z,this.cameraPos.y=a.DebugCameraHeight):(this.cameraPos.set(this.followPos),this.cameraRot.set(this.initCameraRot)),this.curCameraOffset.set(this.cameraOffset),this.curRot.set(0,0,0),this.cameraAddOffset.set(0,0,0),this.cameraTurnOffset.set(this.cameraOffset).normalize().multiplyScalar(15),this.cameraEndOffset.set(this.cameraOffset).normalize().multiplyScalar(10),this.emit(u.CameraEvents.SetFollowPos,this.cameraPos),this.emit(u.CameraEvents.SetCameraSelfOffset,this.curCameraOffset)},s.resetCameraPos=function(){},s.updateCameraPos=function(t){if(a.ShowDebugCamera)return this.cameraPos.x=this.followPos.x,void(this.cameraPos.z=this.followPos.z);if(this.tmpP.set(this.followPos),this.isCloseCamera&&(this.tmpP.z+=this.homeCameraPos.z),this.cameraPos.set(this.tmpP),this.isPathEnd)c.Game.isGameRun&&(this.cameraAddOffset.lerp(this.cameraEndOffset,.03*t*60),this.tmpP.set(this.cameraOffset).add(this.cameraAddOffset),this.curCameraOffset.lerp(this.tmpP,.1*t*60),this.emit(u.CameraEvents.SetCameraSelfOffset,this.curCameraOffset));else{var e=c.Player.wrotY+1.5703;this.curRot.y+=.2*(e-this.curRot.y)*t*60,this.cameraRot.y=57.3*this.curRot.y;var i=this.isCloseCamera?this.homeCameraRot.x:this.initCameraRot.x;this.curRot.x+=.15*(i-this.curRot.x)*t*60,this.cameraRot.x=this.curRot.x,this.emit(u.CameraEvents.SetCameraSelfRot,this.cameraRot),this.tmpP.set(0,0,0),this.isRotPath&&this.tmpP.set(this.cameraTurnOffset),this.cameraAddOffset.lerp(this.tmpP,.03*t*60),this.tmpP.set(this.isCloseCamera?this.homeCameraOffset:this.cameraOffset),this.tmpP.add(this.cameraAddOffset),o.rotateY(this.tmpP,this.tmpP,o.ZERO,this.curRot.y),c.Game.isGameRun?this.curCameraOffset.set(this.tmpP):this.curCameraOffset.lerp(this.tmpP,.1*t*60),this.emit(u.CameraEvents.SetCameraSelfOffset,this.curCameraOffset)}},s.setRoles=function(t){this.roleSumCount=0,this.normalRoleNum=0;var e=m.getData().userAssets;this.curWeapon=e.chooseWeapon;var i=e.props.GiantLv-1,s=Math.floor(i/3),n=i%3,r=0!=n,o=e.props.RoleNumLv;this.createRoles(o),this.createRoles(s,!0,3),r&&this.createRoles(1,!0,n)},s.resetRoles=function(){for(var t in this.allRoles)this.allRoles[t].reset();this.allRoles={},this.roleSumCount=0,this.normalRoleNum=0,this._isOffsetReady=!0,this.isRoleAllStand=!1},s.createRoles=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=1);var s=a.Formation.length;if(this.roleSumCount>=s)console.warn("玩家已达最大数量:",s);else{for(var r=n(),h=n(this.followPos).add(c.Player.offset),l=e?"playerGiant":"player",u=0;u<t;u++){if(this.roleSumCount>=s){console.warn("玩家已达最大数量:",s);break}var p=v.get(l);p.setPosition(o.ZERO),p.parent=this.node;var f=a.Formation[this.roleSumCount];r.set(f.x*a.Scale2DTo3D,0,-f.y*a.Scale2DTo3D).multiplyScalar(a.FormationScale);var m=e?new b:new C;m.init(p,h,r,this.pathLineVec,e),m.setWeapon(this.curWeapon),e&&m.setGiantLv(i),this.allRoles[p.uuid]=m,this.roleSumCount++,e||this.normalRoleNum++}c.normalRoleNum=this.normalRoleNum}},s.reduceNormalRoles=function(t){var e=0;for(var i in this.allRoles){if(e>=t)break;var s=this.allRoles[i];s&&s.node&&s.node.active&&s._curState!=S.Death&&!s.isGiant&&(s.byHit(s.hp),e++)}},s.updateOffset=function(t){this._isOffsetReady||(this._curOffsetTime+=t,this._curOffsetTime>=this._offsetCd&&(this._curOffsetTime=0,this._isOffsetReady=!0))},s.updateRoles=function(t){this.isRoleAllStand=this.isEndMark,this.updateOffset(t);var e=!1;this._isOffsetReady&&(this._isOffsetReady=!1,e=!0);var i=a.Formation,s=0,n=c.Player.formation;for(var r in n.minX=9999,n.minZ=9999,n.maxX=-9999,n.maxZ=-9999,this.allRoles){var o=this.allRoles[r];if(o.node&&o.node.active&&o._curState!=S.Death){if(o._curState!=S.StandShoot&&(this.isRoleAllStand=!1),e&&o._curState!=S.Pass){var h=i[s];this.tmpP.set(h.x,h.y,h.z),this.tmpP.set(h.x*a.Scale2DTo3D,0,-h.y*a.Scale2DTo3D),this.tmpP.multiplyScalar(a.FormationScale),o.setOffset(this.tmpP)}this.tmpP.set(o.offset),n.maxX=Math.max(this.tmpP.x,n.maxX),n.minX=Math.min(this.tmpP.x,n.minX),n.maxZ=Math.max(this.tmpP.z,n.maxZ),n.minZ=Math.min(this.tmpP.z,n.minZ),o.update(t),s++}else v.put(o.node),o.reset(),delete this.allRoles[r]}c.normalRoleNum=this.roleSumCount,c.Player.isPathEnd=this.isPathEnd},s.lateUpdateRoles=function(t){for(var e in this.allRoles){var i=this.allRoles[e];i.node&&i.node.active?i.lateUpdate(t):(i.reset(),delete this.allRoles[e])}},s.setEnemys=function(t){this.isEnemyAllDeath=!1,this.hasDelayCreate=!1},s.resetEnemys=function(){for(var t in this.allEnemys)this.allEnemys[t].reset();this.allEnemys={},this.delayCreateRecs=[]},s.getEnemyCenterPath=function(t,e,i){for(var s=[],a=0;a<e.length;a++){var h=e[a];s.push(n(h))}for(var l=c.PathInfo,u=t+1;u<l.length;u++)for(var p=l[u],f=1;f<p.path.length;f++){var m=p.path[f];s.push(n(m))}this.tmpV.set(s[1]).subtract(s[0]).normalize().multiplyScalar(5);for(var d=0;d<s.length;d++)if(this.tmpPre.set(s[d]),o.round(this.tmpPre,this.tmpPre),d>1&&d<s.length-1)if(this.tmpNex.set(s[d+1]),o.round(this.tmpNex,this.tmpNex),this.tmpPre.x!=this.tmpNex.x&&this.tmpPre.z!=this.tmpNex.z){this.tmpPrePre.set(s[d-1]),this.tmpV.set(this.tmpPre).subtract(this.tmpPrePre).normalize().multiplyScalar(5),this.tmpC.set(this.tmpPre).add(this.tmpV),this.lerp0.set(this.tmpPre),this.lerp1.set(this.tmpC),this.lerp2.set(this.lerp0);for(var y=1;y<20;y++){var v=r(y/20,.1,.99);this.lerp0.lerp(this.tmpC,v),this.lerp1.lerp(this.tmpNex,v),this.lerp2.set(this.lerp0).lerp(this.lerp1,v),i.push(n(this.lerp2))}}else i.push(n(this.tmpPre));else i.push(n(this.tmpPre))},s.getEnemySinglePath=function(t,e,i){for(var s=0;s<t.length;s++)this.tmpPre.set(t[s]),this.tmpP.set(this.tmpPre).add(e),i.push(n(this.tmpP))},s.createEnemys=function(t){var e=[];this.getEnemyCenterPath(t.initPathIndex,t.initPath,e),this.delayCreateRecs.push({centerPath:e,type:t.type,num:t.count})},s.delayCreateEnemy=function(t){if(this.delayCurt+=t,this.delayCurt>=this.delayCd){this.delayCurt=0;var e=a.EnemyCfg.creatSize;this.hasDelayCreate=!1;for(var i=this.delayCreateRecs.length-1;i>=0;i--){var s=this.delayCreateRecs[i];if(s.num>0){var n=s.num>this.delayCreateNum?this.delayCreateNum:s.num;s.num-=this.delayCreateNum;for(var r=l.EnemyPrefabs[l.EnemyType[s.type]],h=0;h<n;h++){this.tmpP.set(s.centerPath[0]);var c=(2*Math.random()-1)*e.x,u=(2*Math.random()-1)*e.y;this.tmpO.set(c,0,u);var p=[];this.getEnemySinglePath(s.centerPath,this.tmpO,p);var f=v.get(r);f.setPosition(o.ZERO),f.parent=this.node;var m=void 0;switch(s.type){case l.EnemyType.Bomb:m=new _;break;default:m=new R}m.init(f,s.type,p),this.allEnemys[f.uuid]=m}this.hasDelayCreate=!0}else this.delayCreateRecs.splice(i,1)}}},s.updateEnemys=function(t){for(var e in this.allEnemys){var i=this.allEnemys[e];i.node&&i.node.active?i.update(t):(i.reset(),delete this.allEnemys[e])}this.delayCreateEnemy(t),c.EnemyNum=Object.keys(this.allEnemys).length,this.checkEndPathEnemyNum(t)},s.lateUpdateEnemys=function(t){for(var e in this.allEnemys){var i=this.allEnemys[e];i.node&&i.node.active?i.lateUpdate(t):(i.reset(),delete this.allEnemys[e])}},s.checkEndPathEnemyNum=function(t){if(this.isRoleAllStand&&!this.isEnemyAllDeath&&!this.hasDelayCreate){for(var e in this.isEnemyAllDeath=!0,this.allEnemys){var i=this.allEnemys[e];i&&i.curPos.z<=this.followPos.z+15&&(this.isEnemyAllDeath=!1)}this.isEnemyAllDeath&&this.onEnemyAllDeath()}},s.onEnemyAllDeath=function(){this.emit(u.GameEvents.GameOver,!0),this.showWinEffects()},s.killAllEnemys=function(){for(var t in this.allEnemys){var e=this.allEnemys[t];e&&e.byHit(e.hp)}},s.setPreCreateData=function(t){for(var e=0;e<t.enemy.length;e++){var i=t.enemy[e];if(i){var s=i[1],n=l.EnemyPrefabs[l.EnemyType[s]];this._prefabRecs[n]||(this._prefabRecs[n]=0)}}},s.updateCreateData=function(t){if(this.createCurt+=t,this.createCurt>=this.createCd)for(var e in this.createCurt=0,this._prefabRecs)if(this._preMaxCfg[e]&&this._prefabRecs[e]<this._preMaxCfg[e]){var i=v.get(e);v.put(i),this._prefabRecs[e]++}},s.onResurgence=function(){this.setRoles(),this.createRoles(10,!1),this.killAllEnemys(),this.emit(u.GameEvents.GameResume)},s.onCanceResurgence=function(){this.emit(u.GameEvents.GameOver,!1)},s.onShowHomeCamera=function(t){this.isCloseCamera=t},s.onGameRun=function(){for(var t in this.allRoles){var e=this.allRoles[t];e&&e._curState==S.Idle&&e.changeState(S.Move)}this.isCloseCamera=!1},s.onLvupGaint=function(){var t=!1;for(var e in this.allRoles){var i=this.allRoles[e];if(i&&i.isGiant&&i.node.active&&i._curState!=S.Death&&i.curGiantLv<3){i.setGiantLv(i.curGiantLv+1),t=!0;break}}t||this.createRoles(1,!0,1)},s.onAddRoles=function(t,e){if(!(this.roleSumCount<=0)){var i=e;switch(t){case l.IncreaseType.symbol_Add:this.createRoles(e,!1),f.playEffect(p.addRole);break;case l.IncreaseType.symbol_Reduce:this.reduceNormalRoles(e);break;case l.IncreaseType.symbol_Multip:e=e<1?1:e,i=this.normalRoleNum*(e-1),this.createRoles(i,!1),f.playEffect(p.addRole);break;case l.IncreaseType.symbol_Division:i=Math.ceil(this.normalRoleNum/e),this.reduceNormalRoles(i)}console.log(this.symbolArr[t],e)}},s.onRoleDeath=function(t){var e=this;this.allRoles[t]&&(this.roleSumCount--,this.allRoles[t].isGiant||this.normalRoleNum--),0==this.roleSumCount&&setTimeout((function(){e.isRoleAllStand?e.emit(u.GameEvents.GameOver,!1):(e.emit(u.GameEvents.GamePause),y.showUI(d.ResurgenceUI))}),1e3)},s.onCreateEnemys=function(t){this.createEnemys(t)},s.onSetWeapon=function(t){for(var e in this.curWeapon=t,this.allRoles){var i=this.allRoles[e];i&&i.setWeapon(t)}},s.updateAudio=function(t){if(c.Game.isGameRun&&0!=this.roleSumCount){this._audioTime+=t;var e=h[this.curWeapon].atkSpd;if(this._curAudioCd=r(1/(this.roleSumCount*e),this._audioCdMin,10),this._audioTime>=this._curAudioCd)switch(this._audioTime=0,this.curWeapon){case l.WeaponType.FireGun:f.playEffect(p.FireGun);break;case l.WeaponType.Shotgun:f.playEffect(p.shotGun);break;case l.WeaponType.MachineGun:f.playEffect(p.MachineGun);break;case l.WeaponType.Pistol:f.playEffect(p.Pistol)}}},s.resetWinEffects=function(){clearInterval(this.intervalId)},s.showWinEffects=function(){},s.showEffect=function(){var t=n(c.Player.wpos);t.z-=5;for(var e=Math.floor(3*Math.random())+3,i=0;i<e;i++)this.tmpData.p.set(t),this.tmpData.p.x+=4*(2*Math.random()-1),this.tmpData.p.z+=4*(2*Math.random()-1),this.tmpData.s=2*Math.random()+1,this.tmpData.p.y+=4*Math.random()+1,this.emit(u.EffectEvents.showObjs,l.Effect3dType.fireWork,this.tmpData)},i}(g))||M),i._RF.pop()}}})),System.register("chunks:///_virtual/RoleStates.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalEnum.ts","./EventManager.ts","./EventTypes.ts","./BasicState.ts"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,n=t.v3},function(t){r=t.GlobalEnum},function(t){o=t.default},function(t){a=t.EventTypes},function(t){h=t.BasicState}],execute:function(){var l;t("RoleStateType",void 0),i._RF.push({},"bb727XER9dDG6linQyQ0QYw","RoleStates",void 0),s.ccclass,s.property,function(t){t[t.Idle=0]="Idle",t[t.Move=1]="Move",t[t.Pass=2]="Pass",t[t.StandShoot=3]="StandShoot",t[t.Death=4]="Death",t[t.Win=5]="Win"}(l||(l=t("RoleStateType",{}))),t("RoleIdleState",function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).offsetDirec=n(),e}e(i,t);var s=i.prototype;return s.enter=function(t){this.cmp.roleAnim.playAnim(r.PlayerClip.idle,!0),this.cmp.curPos.add(this.cmp.offset),this.cmp.updateTransData(0)},s.update=function(t){this.cmp.move(t),this.cmp.lineVec.set(0,0,1),this.cmp.rotation(t)},i}(h)),t("RoleMoveState",function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var s=i.prototype;return s.enter=function(t){this.cmp.playAtkAnim(!1)},s.update=function(t){this.cmp.move(t),this.cmp.rotation(t)},i}(h)),t("RolePassState",function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).endPath=null,e.endIndex=0,e.isMoveEnd=!1,e.endRecIndex=0,e.tmpP=n(),e}e(i,t);var s=i.prototype;return s.enter=function(t){this.endPath=t.endPath,this.endRecIndex=t.endRecIndex,this.endIndex=0,this.isMoveEnd=!1},s.update=function(t){this.calPathDirec(t),this.isMoveEnd&&this.onMoveFinished()},s.calPathDirec=function(t){if(!this.isMoveEnd){var e=this.endPath[this.endIndex],i=this.endIndex+1;if(i<=this.endPath.length-1){var s=this.endPath[i],n=this.tmpP.set(e).subtract(s).lengthSqr();if(this.tmpP.set(this.cmp.curPos).subtract(e),this.tmpP.lengthSqr()>=n){if(this.endIndex++,(i=this.endIndex+1)>this.endPath.length-1)return this.isMoveEnd=!0,void this.cmp.lineVec.set(0,0,0);e=this.endPath[this.endIndex],s=this.endPath[i]}this.cmp.lineVec.set(s).subtract(e).normalize().multiplyScalar(this.cmp.moveSpd)}this.tmpP.set(this.cmp.lineVec).multiplyScalar(t),this.cmp.curPos.add(this.tmpP)}},s.onMoveFinished=function(){this.cmp.changeState(l.StandShoot)},s.exit=function(){},i}(h)),t("RoleStandShootState",function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.enter=function(t){this.cmp.playAtkAnim(!0)},i}(h)),t("RoleDeathState",function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.enter=function(t){var e=n(this.cmp.curPos);e.y+=.5,o.emit(a.EffectEvents.showMergeEffect,r.MergeEffectType.MergeRoleDeath,{p:e}),o.emit(a.RoleEvents.Death,this.cmp.node.uuid)},i}(h)),t("RoleWinState",function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.enter=function(t){},i}(h)),i._RF.pop()}}})),System.register("chunks:///_virtual/Spininess.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./CollisionManager.ts","./BasicProp.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Node,l=t.v3,c=t.Tween,u=t.tween},function(t){p=t.TrapCfg},function(t){f=t.GlobalEnum},function(t){m=t.ColliderGroup,d=t.CollisionManager},function(t){y=t.BasicProp}],execute:function(){var v,g,P,R,_,C,b;r._RF.push({},"919ed80OudHr5q6i/jNQxHy","Spininess",void 0);var S=o.ccclass,M=o.property;t("Spininess",(v=S("Spininess"),g=M({type:a(f.TrapType)}),P=M(h),v((C=e((_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).cldGroup=m.PlayerTrigger,s(e,"trapType",C,n(e)),s(e,"moveTarget",b,n(e)),e.posAnim=l(),e.isRuning=!1,e}i(e,t);var r=e.prototype;return r.setData=function(e){t.prototype.setData.call(this,e)},r.reset=function(){this.resetAnim(),t.prototype.reset.call(this)},r.customUpdate=function(e){t.prototype.customUpdate.call(this,e),this.updateAnim(e)},r.show=function(){t.prototype.show.call(this),this.isRuning||this.runAnim()},r.hide=function(){t.prototype.hide.call(this),this.isRuning&&this.resetAnim()},r.runAnim=function(){var t=this;this.isRuning=!0,c.stopAllByTarget(this.posAnim),this.posAnim.set(0,-1,0),this.moveTarget.setPosition(this.posAnim),u(this.posAnim).repeatForever(u(this.posAnim).to(.4,{y:0},{easing:"backOut"}).call((function(){t.checkCollistion()})).to(.4,{y:-1}).delay(.6)).start()},r.resetAnim=function(){this.isRuning=!1,c.stopAllByTarget(this.posAnim)},r.updateAnim=function(t){this.moveTarget&&this.moveTarget.setPosition(this.posAnim)},r.updateCollider=function(t){},r.onCheckColliderCb=function(t){var e=p[this.trapType];for(var i in t)for(var s=t[i],n=0;n<s.length;n++){var r=s[n],o=d.getColilderByColId(r).targetCmp;o&&o.byHit(e.atk)}},e}(y)).prototype,"trapType",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return f.TrapType.Spininess}}),b=e(_.prototype,"moveTarget",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=_))||R)),r._RF.pop()}}})),System.register("chunks:///_virtual/TrailLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventTypes.ts","./ColorLog.ts","./GlobalPool.ts","./BasicLayer.ts","./TrailMesh.ts"],(function(t){var e,i,s,n,r,o,a,h;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator},function(t){n=t.EventTypes},function(t){r=t.clog},function(t){o=t.default},function(t){a=t.BasicLayer},function(t){h=t.TrailMesh}],execute:function(){var l;i._RF.push({},"b63cevQVDFOg6uDStOAq6LH","TrailLayer",void 0);var c=s.ccclass;s.property,t("TrailLayer",c("TrailLayer")(l=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).meshRecs={},e.trailCfg={0:{trailLen:3,scale:.7,spd:.1,name:" "}},e}e(i,t);var s=i.prototype;return s.init=function(){},s.onEvents=function(){this.on(n.EffectEvents.ShowTrail,this.onShowTrail,this),this.on(n.EffectEvents.HideTrail,this.onHideTrail,this)},s.setData=function(t){},s.reset=function(){o.putAllChildren(this.node),this.meshRecs={}},s.customUpdate=function(t){for(var e in this.meshRecs)for(var i=this.meshRecs[e],s=0;s<i.length;s++){var n=i[s];n&&n.node.active&&n.customUpdate(t)}},s.customLateUpdate=function(t){},s.createTrailMesh=function(t){this.meshRecs[t]||(this.meshRecs[t]=[]);var e=this.trailCfg[t],i={mergeNum:Math.floor(h.MAX_PARAM_LEN/e.trailLen),trailLen:e.trailLen,scale:e.scale},s=o.get("trailMergeMesh",i);s.parent=this.node;var n=s.getComponent(h);return this.meshRecs[t].push(n),r.warn("#TrailMesh:"+Object.keys(this.meshRecs).length),n},s.onShowTrail=function(t){var e=null;if(this.meshRecs[t.trailType])for(var i=this.meshRecs[t.trailType],s=0;s<i.length;s++){var n=i[s];if(n&&!n.isFull){e=n,n.node.active=!0;break}}e||(e=this.createTrailMesh(t.trailType));var r=this.trailCfg[t.trailType].spd;e.showTrail(t.followPos,t.colorType,r)},s.onHideTrail=function(t){if(this.meshRecs[t.trailType])for(var e=this.meshRecs[t.trailType],i=0;i<e.length;i++){var s=e[i];for(var n in s.trailRecs){var r=s.trailRecs[n];if(r.followPos==t.followPos){r.setReuse();break}}}},i}(a))||l),i._RF.pop()}}})),System.register("chunks:///_virtual/TrailMesh.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BasicComponet.ts","./TrailRec.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.MeshRenderer,h=t.v3,l=t.gfx,c=t.utils,u=t.v4},function(t){p=t.BasicComponet},function(t){f=t.TrailRec}],execute:function(){var m,d,y,v,g,P;r._RF.push({},"b9b787NPElOeKGPiGEYzbyk","TrailMesh",void 0);var R=o.ccclass,_=o.property;o.executeInEditMode,t("TrailMesh",(m=R("TrailMesh"),d=_(a),m(((P=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).mergeNum=20,e.trailLen=3,s(e,"msr",g,n(e)),e.meshData=null,e.trailRecs={},e.isFull=!1,e.useCount=0,e.bs=h(1,1,1),e.scale=1,e.pass=null,e.uniformTrans=void 0,e.handleTrans=0,e.transDirty=!1,e.handleRotate=0,e.uniformRotate=void 0,e.rotateDirty=!1,e}i(e,t);var r=e.prototype;return r.onEnable=function(){},r.initSub=function(){this.initMats()},r.onEvents=function(){},r.resetSub=function(){this.trailRecs={},this.useCount=0,this.isFull=!1,this.resetTrailRecs(),this.resetMat()},r.setData=function(t){this.mergeNum=t.mergeNum,this.trailLen=t.trailLen,this.scale=t.scale,this.createMesh()},r.customUpdate=function(t){this.updateTrail(t),this.updateMat(t)},r.resetTrailRecs=function(){for(var t in this.trailRecs)this.trailRecs[t].reset()},r.updateTrail=function(t){for(var e in this.trailRecs){var i=this.trailRecs[e];if(i.isUsed){i.update(t);for(var s=0;s<i.posLen;s++){var n=i.posArr[s],r=s+i.trailId*i.posLen;this.setTrailAllParams(r,n.x,1,n.z,i.rotArr[s].x)}}}},r.showTrail=function(t,e,i){var s=null;for(var n in this.trailRecs){var r=this.trailRecs[n];if(!r.isUsed){s=r;break}}s.setActive(e,t,i),this.useCount++,this.useCount>=this.mergeNum&&(this.isFull=!0)},r.onUnuseTrail=function(t){this.useCount--,this.isFull=!1;for(var e=0;e<t.posLen;e++){var i=t.posArr[e],s=e+t.trailId*t.posLen;this.setTrailAllParams(s,i.x,0,i.z,t.rotArr[e].x)}},r.createMesh=function(){var t=this;this.meshData={positions:[],normals:[],uvs:[],indices:[],customAttributes:[{attr:{name:"a_animData",format:l.Format.RGBA32F,isNormalized:!1,stream:0,isInstanced:!1,location:0,customOffset:0},values:[]}]},h();for(var e=this.node.worldPosition,i=0,s=0;s<this.mergeNum;s++){i=s*(this.trailLen+1),this.createMeshData(i,this.meshData,e,this.trailLen);var n=new f(s,this.trailLen,this);this.trailRecs[s]=n}setTimeout((function(){t.msr.mesh=c.createMesh(t.meshData)}),0)},r.createMeshData=function(t,e,i,s){for(var n=.5*this.bs.x*this.scale,r=i.x,o=i.y,a=i.z,h=1/s,l=0;l<s;l++){var c=e.positions.length/3,u=0*l+a;e.positions.push(r-n,o,u-0,r+n,o,u-0,r+n,o,u+0,r-n,o,u+0),e.normals.push(0,1,0,0,1,0,0,1,0,0,1,0),e.uvs.push(0,h*l,1,h*l,1,h*(l+1),0,h*(l+1)),e.indices.push(c+0,c+3,c+2,c+2,c+1,c+0);var p=t+l,f=.5;e.customAttributes[0].values.push(p,f,0,0,p,f,0,0,p+1,f,0,0,p+1,f,0,0)}},r.initMats=function(){var t=this.msr.getMaterialInstance(0);this.pass=t.passes[0],this.handleTrans=this.pass.getHandle("transData"),this.uniformTrans=[],this.uniformRotate=[];for(var i=e.MAX_PARAM_LEN,s=0;s<i;s++)this.uniformTrans.push(u(0,0,0,0));this.transDirty=!0,this.applyTrans(),this.rotateDirty=!0,this.applyRotate()},r.resetMat=function(){for(var t=0;t<this.uniformTrans.length;t++)this.uniformTrans[t].set(0,0,0,0);this.transDirty=!0,this.applyTrans(),this.rotateDirty=!0,this.applyRotate()},r.updateMat=function(t){this.applyTrans()},r.setTrailAllParams=function(t,e,i,s,n){!this.uniformTrans[t]||this.uniformTrans[t].x==e&&this.uniformTrans[t].y==i&&this.uniformTrans[t].z==s&&this.uniformTrans[t].w==n||(this.uniformTrans[t].x=e,this.uniformTrans[t].y=i,this.uniformTrans[t].z=s,this.uniformTrans[t].w=n,this.transDirty=!0)},r.setTrailPos=function(t,e,i){!this.uniformTrans[t]||this.uniformTrans[t].x==e&&this.uniformTrans[t].z==i||(this.uniformTrans[t].x=e,this.uniformTrans[t].z=i,this.transDirty=!0)},r.setTrailScale=function(t,e){this.uniformTrans[t]&&this.uniformTrans[t].w!=e&&(this.uniformTrans[t].w=e,this.transDirty=!0)},r.setTrailColor=function(t,e){this.uniformTrans[t]&&this.uniformTrans[t].y!=e&&(this.uniformTrans[t].y=e,this.transDirty=!0)},r.setTrailRotate=function(t,e){this.uniformTrans[t]&&this.uniformTrans[t].w!=e&&(this.uniformTrans[t].w=e,this.rotateDirty=!0)},r.applyTrans=function(){this.transDirty&&(this.pass&&this.pass.setUniformArray(this.handleTrans,this.uniformTrans),this.transDirty=!1)},r.applyRotate=function(){},e}(p)).MAX_PARAM_LEN=210,g=e((v=P).prototype,"msr",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=v))||y)),r._RF.pop()}}})),System.register("chunks:///_virtual/TrailRec.ts",["cc"],(function(t){var e,i,s,n,r;return{setters:[function(t){e=t.cclegacy,i=t.Vec3,s=t.Vec4,n=t.v3,r=t.v4}],execute:function(){e._RF.push({},"6f361RB5+xIOI3hF4VzOc6q","TrailRec",void 0),t("TrailRec",function(){function t(t,e,i){this.trailId=0,this.colorType=0,this.posLen=0,this.posArr=[],this.rotArr=[],this.spd=.1,this.followPos=null,this.isUsed=!1,this.msCmp=null,this.tmpPos=n(),this.subPos=n(),this.curDirec=n(),this.msCmp=i,this.posLen=e+1;for(var s=0;s<this.posLen;s++)this.posArr.push(n()),this.rotArr.push(r());this.trailId=t}var e=t.prototype;return e.reset=function(){this.isUsed=!1,this.followPos=null;for(var t=0;t<this.posArr.length;t++)this.posArr[t].set(i.ZERO);for(var e=0;e<this.rotArr.length;e++)this.rotArr[e].set(s.ZERO);this.colorType=0},e.setActive=function(t,e,i){void 0!==i&&i>0&&(this.spd=i),this.colorType=t||0,this.isUsed=!0,this.followPos=e;for(var s=0;s<this.posLen;s++)this.posArr[s].set(e),this.rotArr[s].set(0)},e.setReuse=function(){this.reset(),this.msCmp.onUnuseTrail(this)},e.update=function(t){if(this.isUsed)if(this.followPos.y<0)this.setReuse();else{this.tmpPos.set(this.followPos);for(var e=0;e<this.posArr.length;e++){var s=this.posArr[e];0==e?(s.set(this.tmpPos),i.subtract(this.subPos,this.posArr[e+1],this.posArr[e])):(s.lerp(this.tmpPos,this.spd),this.posArr[e+1]?i.subtract(this.subPos,this.posArr[e+1],this.posArr[e-1]):i.subtract(this.subPos,this.posArr[e],this.posArr[e-1])),this.rotArr[e].x=Math.atan2(this.subPos.y,this.subPos.x)-1.57,this.tmpPos.set(s)}}},t}()),e._RF.pop()}}})),System.register("chunks:///_virtual/UpperAirNail.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./BasicCollider.ts","./CollisionManager.ts","./BasicProp.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.Node,l=t.v3},function(t){c=t.TrapCfg},function(t){u=t.GlobalEnum},function(t){p=t.BasicCollider},function(t){f=t.ColliderGroup,m=t.CollisionTools,d=t.CollisionManager},function(t){y=t.BasicProp}],execute:function(){var v,g,P,R,_,C,b,S,M;r._RF.push({},"6b893MLqTFILICjNMZKaKEw","UpperAirNail",void 0);var E=o.ccclass,T=o.property;t("UpperAirNail",(v=E("UpperAirNail"),g=T({type:a(u.TrapType)}),P=T(h),R=T(h),v((b=e((C=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).cldGroup=f.PlayerTrigger,s(e,"trapType",b,n(e)),s(e,"moveTargets",S,n(e)),s(e,"pushBtn",M,n(e)),e.initPosArr=null,e._isAnimFinish=!1,e._animRecs=null,e._gravity=-10,e._animTime=0,e.tmpP=l(),e.isTriggerUsed=!1,e.radius=1.2,e.checkGroup=[f.Enemy],e.checkRes=void 0,e}i(e,t);var r=e.prototype;return r.initSub=function(){this.initAnim()},r.setData=function(e){t.prototype.setData.call(this,e)},r.reset=function(){this.resetAnim(),t.prototype.reset.call(this)},r.customUpdate=function(e){t.prototype.customUpdate.call(this,e),this.updateAnim(e)},r.initAnim=function(){this.pushBtn.setPosition(0,.2,0),this.initPosArr=[];for(var t=0;t<this.moveTargets.children.length;t++){var e=this.moveTargets.children[t];this.initPosArr.push(l(e.position))}},r.showAnim=function(){this.pushBtn.setPosition(0,0,0),this._isAnimFinish=!1,this._animTime=0,this._animRecs=[];for(var t=0;t<this.moveTargets.children.length;t++){var e=this.moveTargets.children[t];this._animRecs.push({node:e,p:l(this.initPosArr[t]),v:l(0,-3,0),delay:.1})}},r.resetAnim=function(){for(var t=0;t<this.initPosArr.length;t++){var e=this.initPosArr[t];this.moveTargets.children[t].setPosition(e)}if(this._animRecs)for(var i=0;i<this._animRecs.length;i++){var s=this._animRecs[i];s.node=null,s.p=null,s.v=null}this._animRecs=null,this.pushBtn.setPosition(0,.2,0),this._animTime=0},r.updateAnim=function(t){if(this._animRecs){this._animTime+=t;for(var e=this._animRecs.length-1;e>=0;e--){var i=this._animRecs[e];this._animTime>=i.delay&&(i.v.y+=this._gravity*t,this.tmpP.set(i.v).multiplyScalar(t),i.p.add(this.tmpP),i.node.setPosition(i.p),i.p.y<=.1&&(i.p.y=.1,i.node.setPosition(i.p),this.checkColByPos(i.node.worldPosition),this._animRecs.splice(e,1)))}}},r.setCollider=function(){this.pos.set(this.pushBtn.worldPosition),this.collider=new p(this.cldGroup,this,!0),this.collider.setRectSize(this.cldSize),this.collider.setRectPos(this.pos),this.collider.updateGridInfo(!0),this.collider.isCircleCollider=this.isCircleCollider},r.resetCollider=function(){t.prototype.resetCollider.call(this),this.isTriggerUsed=!1},r.checkCollistion=function(){this.isTriggerUsed||this.collider&&this.collider.checkPosFast(this.pos,this.onTriggerEnter.bind(this))},r.onTriggerEnter=function(){this.isTriggerUsed=!0,this.showAnim()},r.checkColByPos=function(t){if(this.checkRes={},m.getCollInfoByPos(t,this.radius,this.checkRes,this.checkGroup)){var e=c[this.trapType],i=this.radius*this.radius;for(var s in this.checkRes)for(var n=this.checkRes[s],r=0;r<n.length;r++){var o=n[r],a=d.getColilderByColId(o).targetCmp;a&&this.tmpP.set(t).subtract(a.curPos).lengthSqr()<=i&&a.byHit(e.atk)}}},e}(y)).prototype,"trapType",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.TrapType.ElectricSaw}}),S=e(C.prototype,"moveTargets",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(C.prototype,"pushBtn",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=C))||_)),r._RF.pop()}}})),System.register("chunks:///_virtual/WeaponProp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalConfig.ts","./GlobalEnum.ts","./GlobalTmpData.ts","./EventManager.ts","./EventTypes.ts","./GlobalPool.ts","./CollisionManager.ts","./BasicProp.ts","./ModifyPosRotMesh.ts"],(function(t){var e,i,s,n,r,o,a,h,l,c,u,p,f,m,d,y,v,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,a=t.Enum,h=t.v3},function(t){l=t.GlobalConfig,c=t.WeaponCfg},function(t){u=t.GlobalEnum},function(t){p=t.GlobalTmpData},function(t){f=t.default},function(t){m=t.EventTypes},function(t){d=t.default},function(t){y=t.ColliderGroup},function(t){v=t.BasicProp},function(t){g=t.ModifyPosRotMesh}],execute:function(){var P,R,_,C,b;r._RF.push({},"c5b0cvG9rpFlbLn0L33XU5H","WeaponProp",void 0);var S=o.ccclass,M=o.property;t("WeaponProp",(P=S("WeaponProp"),R=M({type:a(u.TrapType)}),P((b=e((C=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).cldGroup=y.PlayerTrigger,s(e,"trapType",b,n(e)),e.effect=null,e.curPos=h(),e.rot=h(),e.curScale=1,e.weaponType=0,e.weaponId=-1,e.weapon=null,e.tmpR=h(),e.isTriggerUsed=!1,e.tmpP=h(),e.checkRadius=l.Player.checkRadius,e}i(e,t);var r=e.prototype;return r.initSub=function(){this.initAnim()},r.onEvents=function(){this.on(m.CurLevelEvents.HideWeaponProp,this.onHideWeaponProp,this)},r.setData=function(t){this.curPos.set(t.p),t.r.getEulerAngles(this.rot),this.weaponType=t.d.weaponType,this.weaponId=t.d.weaponId,this.node.parent=t.parent,this.node.setPosition(t.p),this.node.eulerAngles=this.rot,this.setCollider(),this.weapon&&d.put(this.weapon.node);var e=d.get(u.WeaponType[this.weaponType]);e.parent=t.parent,this.weapon=e.getComponent(g),this.curScale=c[this.weaponType].propScale,this.setTransData(),this.effect||(this.effect=d.get("Effect_IS_buff_prop_001"),this.effect.setPosition(h(0,.1,0)),this.effect.setParent(this.node))},r.reset=function(){this.weapon&&d.put(this.weapon.node),this.weapon=null,this.resetAnim(),t.prototype.reset.call(this)},r.customUpdate=function(e){t.prototype.customUpdate.call(this,e),this.updateAnim(e),this.setTransData()},r.setTransData=function(){this.tmpR.set(this.rot).multiplyScalar(.01745),this.curPos.y=.5,this.weapon&&this.weapon.setTransData(this.curPos,this.tmpR,this.curScale)},r.initAnim=function(){},r.resetAnim=function(){},r.updateAnim=function(t){this.rot.y+=-180*t,this.isTriggerUsed&&d.put(this.node)},r.onHideWeaponProp=function(t){this.weaponId!=t||this.isTriggerUsed||(this.isTriggerUsed=!0)},r.setCollider=function(){},r.resetCollider=function(){t.prototype.resetCollider.call(this),this.isTriggerUsed=!1},r.checkCollistion=function(){this.isTriggerUsed||this.tmpP.set(p.Player.wpos).add(p.Player.offset).subtract(this.curPos).lengthSqr()<this.checkRadius*this.checkRadius&&this.onTriggerEnter()},r.onTriggerEnter=function(){switch(this.isTriggerUsed=!0,this.weaponType){case u.WeaponType.Drone:this.emit(m.CurLevelEvents.CreateDrones);break;default:this.emit(m.RoleEvents.SetWeapon,this.weaponType)}f.emit(m.CurLevelEvents.HideWeaponProp,this.weaponId);var t=h(p.Player.wpos).add(p.Player.offset);f.emit(m.EffectEvents.showParticleEffect,u.Effect3dType.Effect_IS_buff_get_001,{p:t})},e}(v)).prototype,"trapType",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.TrapType.ElectricSaw}}),_=C))||_)),r._RF.pop()}}})),t="virtual:///prerequisite-imports/Game",e="chunks:///_virtual/Game",System.register(t,[e],(function(t,e){return{setters:[function(e){var i={};for(var s in e)"default"!==s&&"__esModule"!==s&&(i[s]=e[s]);t(i)}],execute:function(){}}})); 
 			}); 	require("subpackages/Game/game.js");
 	